{"platform":{"name":"gcp","release":"google-apis-core-v0.11.3","target_id":"90bf7c08-ae54-5aee-bff9-374858a32d4c"},"profiles":[{"name":"inspec-gcp-cis-benchmark","version":"4.0.0-0","sha256":"52dafaf05b275f0abee17be065ab15c7ad70a13a4fda0ce496fa7b6e6e700eb5","title":"InSpec GCP CIS 4.0 Benchmark","maintainer":"Google Cloud Platform","summary":"Inspec Google Cloud Platform Center for Internet Security Benchmark v4.0 Profile","license":"Apache-2.0","copyright":"(c) 2022, Google, Inc.","copyright_email":"copyright@google.com","supports":[{"platform":"gcp"}],"attributes":[{"name":"gcp_project_id","options":{"type":"String","required":true,"value":"lab-prod-461912"}},{"name":"cis_version","options":{"type":"String","value":"4.0"}},{"name":"cis_url","options":{"type":"String","value":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/"}},{"name":"sa_key_older_than_seconds","options":{"type":"Numeric","value":7776000}},{"name":"kms_rotation_period_seconds","options":{"type":"Numeric","value":7776000}},{"name":"gcp_gke_locations","options":{"type":"Array","value":[""]}},{"name":"gce_zones","options":{"type":"Array","value":[""]}},{"name":"log_min_messages","options":{"type":"String","value":"ERROR"}},{"name":"log_min_error_statement","options":{"type":"String","value":"ERROR"}},{"name":"log_error_verbosity","options":{"type":"String","value":"DEFAULT"}},{"name":"log_statement","options":{"type":"String","value":"ddl"}},{"name":"log_hostname","options":{"type":"String","value":"off"}},{"name":"user_connections","options":{"type":"String","value":"0"}},{"name":"supported_confidential_vm_types","options":{"value":"(?-mix:^(n2d|c2d|n3d))"}}],"depends":[{"name":"inspec-gcp","url":"https://github.com/inspec/inspec-gcp/archive/v1.11.135.tar.gz","status":"loaded"}],"groups":[{"id":"controls/1.01-iam.rb","controls":["cis-gcp-1.1-iam"],"title":"Ensure that corporate login credentials are used"},{"id":"controls/1.02-iam.rb","controls":["cis-gcp-1.2-iam"],"title":"Ensure that multi-factor authentication is enabled for all non-service accounts"},{"id":"controls/1.03-iam.rb","controls":["cis-gcp-1.3-iam"],"title":"Ensure that Security Key Enforcement is enabled for all admin accounts"},{"id":"controls/1.04-iam.rb","controls":["cis-gcp-1.4-iam"],"title":"Ensure that there are only GCP-managed service account keys for each service account"},{"id":"controls/1.05-iam.rb","controls":["cis-gcp-1.5-iam"],"title":"Ensure that ServiceAccount has no Admin privileges."},{"id":"controls/1.06-iam.rb","controls":["cis-gcp-1.6-iam"],"title":"Ensure that IAM users are not assigned Service Account User role at project level"},{"id":"controls/1.07-iam.rb","controls":["cis-gcp-1.7-iam"],"title":"Ensure user-managed/external keys for service accounts are rotated every 90 days or less"},{"id":"controls/1.08-iam.rb","controls":["cis-gcp-1.8-iam"],"title":"Ensure that Separation of duties is enforced while assigning service account related roles to users"},{"id":"controls/1.09-iam.rb","controls":["cis-gcp-1.9-iam"],"title":"Ensure that Cloud KMS cryptokeys are not anonymously or publicly accessible"},{"id":"controls/1.10-iam.rb","controls":["cis-gcp-1.10-iam"],"title":"Ensure KMS Encryption Keys Are Rotated Within a Period of 90 Days"},{"id":"controls/1.11-iam.rb","controls":["cis-gcp-1.11-iam"],"title":"Ensure that Separation of duties is enforced while assigning KMS related roles to users"},{"id":"controls/1.12-iam.rb","controls":["cis-gcp-1.12-iam"],"title":"Ensure API Keys Only Exist for Active Services"},{"id":"controls/1.13-iam.rb","controls":["cis-gcp-1.13-iam"],"title":"Ensure API Keys Are Restricted To Use by Only Specified Hosts and Apps"},{"id":"controls/1.14-iam.rb","controls":["cis-gcp-1.14-iam"],"title":"Ensure API Keys Are Restricted to Only APIs That Application Needs Access"},{"id":"controls/1.15-iam.rb","controls":["cis-gcp-1.15-iam"],"title":"Ensure API Keys Are Rotated Every 90 Days"},{"id":"controls/1.16-iam.rb","controls":["cis-gcp-1.16-iam"],"title":"Ensure Essential Contacts is Configured for Organization"},{"id":"controls/1.17-iam.rb","controls":["cis-gcp-1.17-iam"],"title":"Ensure Secrets are Not Stored in Cloud Functions Environment Variables by Using Secret Manager"},{"id":"controls/2.01-logging.rb","controls":["cis-gcp-2.1-logging"],"title":"Ensure That Cloud Audit Logging Is Configured Properly"},{"id":"controls/2.02-logging.rb","controls":["cis-gcp-2.2-logging"],"title":"Ensure that sinks are configured for all Log entries"},{"id":"controls/2.03-logging.rb","controls":["cis-gcp-2.3-logging"],"title":"Ensure That Retention Policies on Cloud Storage Buckets Used for Exporting Logs Are Configured Using Bucket Lock"},{"id":"controls/2.04-logging.rb","controls":["cis-gcp-2.4-logging"],"title":"Ensure Log Metric Filter and Alerts Exist for Project Ownership Assignments/Changes"},{"id":"controls/2.05-logging.rb","controls":["cis-gcp-2.5-logging"],"title":"Ensure That the Log Metric Filter and Alerts Exist for Audit Configuration Changes"},{"id":"controls/2.06-logging.rb","controls":["cis-gcp-2.6-logging"],"title":"Ensure log metric filter and alerts exists for Custom Role changes"},{"id":"controls/2.07-logging.rb","controls":["cis-gcp-2.7-logging"],"title":"Ensure That the Log Metric Filter and Alerts Exist for VPC Network Firewall Rule Changes"},{"id":"controls/2.08-logging.rb","controls":["cis-gcp-2.8-logging"],"title":"Ensure That the Log Metric Filter and Alerts Exist for VPC Network Route Changes"},{"id":"controls/2.09-logging.rb","controls":["cis-gcp-2.9-logging"],"title":"Ensure That the Log Metric Filter and Alerts Exist for VPC Network Changes"},{"id":"controls/2.10-logging.rb","controls":["cis-gcp-2.10-logging"],"title":"Ensure That the Log Metric Filter and Alerts Exist for Cloud Storage IAM Permission Changes"},{"id":"controls/2.11-logging.rb","controls":["cis-gcp-2.11-logging"],"title":"Ensure That the Log Metric Filter and Alerts Exist for SQL Instance Configuration Changes"},{"id":"controls/2.12-logging.rb","controls":["cis-gcp-2.12-logging"],"title":"Ensure That Cloud DNS Logging Is Enabled for All VPC Networks"},{"id":"controls/2.13-logging.rb","controls":["cis-gcp-2.13-logging"],"title":"Ensure Cloud Asset Inventory Is Enabled"},{"id":"controls/2.14-logging.rb","controls":["cis-gcp-2.14-logging"],"title":"Ensure 'Access Transparency' is 'Enabled'"},{"id":"controls/2.15-logging.rb","controls":["cis-gcp-2.15-logging"],"title":"Ensure 'Access Approval' is 'Enabled'"},{"id":"controls/2.16-logging.rb","controls":["cis-gcp-2.16-logging"],"title":"Ensure Logging is enabled for HTTP(S) Load Balancer"},{"id":"controls/3.01-networking.rb","controls":["cis-gcp-3.1-networking"],"title":"Ensure That the Default Network Does Not Exist in a Project"},{"id":"controls/3.02-networking.rb","controls":["cis-gcp-3.2-networking"],"title":"Ensure Legacy Networks Do Not Exist for Older Projects"},{"id":"controls/3.03-networking.rb","controls":["cis-gcp-3.3-networking"],"title":"Ensure that DNSSEC is enabled for Cloud DNS"},{"id":"controls/3.04-networking.rb","controls":["cis-gcp-3.4-networking"],"title":"Ensure that RSASHA1 is not used for key-signing key in Cloud DNS DNSSEC"},{"id":"controls/3.05-networking.rb","controls":["cis-gcp-3.5-networking"],"title":"Ensure That RSASHA1 Is Not Used for the Zone-Signing Key in Cloud DNS DNSSEC"},{"id":"controls/3.06-networking.rb","controls":["cis-gcp-3.6-networking"],"title":"Ensure that SSH access is restricted from the internet"},{"id":"controls/3.07-networking.rb","controls":["cis-gcp-3.7-networking"],"title":"Ensure that RDP access is restricted from the internet"},{"id":"controls/3.08-networking.rb","controls":["cis-gcp-3.8-networking"],"title":"Ensure that VPC Flow Logs is Enabled for Every Subnet in a VPC Network"},{"id":"controls/3.09-networking.rb","controls":["cis-gcp-3.9-networking"],"title":"Ensure No HTTPS or SSL Proxy Load Balancers Permit SSL Policies With Weak Cipher Suites"},{"id":"controls/3.10-networking.rb","controls":["cis-gcp-3.10-networking"],"title":"Use Identity Aware Proxy (IAP) to Ensure Only Traffic From Google IP Addresses are Allowed"},{"id":"controls/4.01-vms.rb","controls":["cis-gcp-4.1-vms"],"title":" Ensure that instances are not configured to use the default service account "},{"id":"controls/4.02-vms.rb","controls":["cis-gcp-4.2-vms"],"title":"Ensure that instances are not configured to use the default service account with full access to all Cloud APIs"},{"id":"controls/4.03-vms.rb","controls":["cis-gcp-4.3-vms"],"title":"Ensure 'Block Project-wide SSH keys' is enabled for VM instances"},{"id":"controls/4.04-vms.rb","controls":["cis-gcp-4.4-vms"],"title":"Ensure oslogin is enabled for a Project"},{"id":"controls/4.05-vms.rb","controls":["cis-gcp-4.5-vms"],"title":"Ensure 'Enable connecting to serial ports' is not enabled for VM Instance"},{"id":"controls/4.06-vms.rb","controls":["cis-gcp-4.6-vms"],"title":"Ensure that IP forwarding is not enabled on Instances"},{"id":"controls/4.07-vms.rb","controls":["cis-gcp-4.7-vms"],"title":"Ensure VM disks for critical VMs are encrypted with CustomerSupplied Encryption Keys (CSEK)"},{"id":"controls/4.08-vms.rb","controls":["cis-gcp-4.8-vms"],"title":"Ensure Compute instances are launched with Shielded VM enabled"},{"id":"controls/4.09-vms.rb","controls":["cis-gcp-4.09-vms"],"title":"Ensure That Compute Instances Do Not Have Public IP Addresses (Automated)"},{"id":"controls/4.10-vms.rb","controls":["cis-gcp-4.10-vms"],"title":"Ensure That App Engine Applications Enforce HTTPS Connections (Manual)"},{"id":"controls/4.11-vms.rb","controls":["cis-gcp-4.11-vms"],"title":"Ensure That Compute Instances Have Confidential Computing Enabled (Automated)"},{"id":"controls/4.12-vms.rb","controls":["cis-gcp-4.12-vms"],"title":"Ensure the Latest Operating System Updates Are Installed On Your Virtual Machines in All Projects (Manual)"},{"id":"controls/5.01-storage.rb","controls":["cis-gcp-5.1-storage"],"title":"Ensure that Cloud Storage bucket is not anonymously or publicly accessible"},{"id":"controls/5.02-storage.rb","controls":["cis-gcp-5.2-storage"],"title":"Ensure that Cloud Storage buckets have uniform bucket-level access enabled"},{"id":"controls/6.01-db.rb","controls":["cis-gcp-6.1.1-db","cis-gcp-6.1.2-db","cis-gcp-6.1.3-db"],"title":"Ensure that MySql database instances are secure."},{"id":"controls/6.02-db.rb","controls":["cis-gcp-6.2.1-db","cis-gcp-6.2.2-db","cis-gcp-6.2.3-db","cis-gcp-6.2.4-db","cis-gcp-6.2.5-db","cis-gcp-6.2.6-db","cis-gcp-6.2.7-db","cis-gcp-6.2.8-db"],"title":"Ensure that Cloud SQL database Instances are secure"},{"id":"controls/6.03-db.rb","controls":["cis-gcp-6.3.1-db","cis-gcp-6.3.2-db","cis-gcp-6.3.3-db","cis-gcp-6.3.4-db","cis-gcp-6.3.5-db","cis-gcp-6.3.6-db","cis-gcp-6.3.7-db"],"title":"Ensure that Cloud SQL Server database Instances are secure"},{"id":"controls/6.04-db.rb","controls":["cis-gcp-6.4-db"],"title":"Ensure That the Cloud SQL Database Instance Requires All Incoming Connections To Use SSL"},{"id":"controls/6.05-db.rb","controls":["cis-gcp-6.5-db"],"title":"Ensure That Cloud SQL Database Instances Do Not Implicitly Whitelist All Public IP Addresses"},{"id":"controls/6.06-db.rb","controls":["cis-gcp-6.6-db"],"title":"Ensure That Cloud SQL Database Instances Do Not Have Public IPs"},{"id":"controls/6.07-db.rb","controls":["cis-gcp-6.7-db"],"title":"Ensure That Cloud SQL Database Instances Are Configured With Automated Backups"},{"id":"controls/7.01-bq.rb","controls":["cis-gcp-7.1-storage"],"title":"Ensure That BigQuery datasets are not anonymously or publicly accessible"},{"id":"controls/7.02-bq.rb","controls":["cis-gcp-7.2-storage"],"title":"Ensure that all BigQuery tables are encrypted with customer-managed encryption key (CMEK)"},{"id":"controls/7.03-bq.rb","controls":["cis-gcp-7.3-storage"],"title":"Ensure that a default customer-managed encryption key (CMEK) is specified for all BigQuery data sets"},{"id":"controls/7.04-bq.rb","controls":["cis-gcp-7.4-storage"],"title":"Ensure all data in BigQuery has been classified"},{"id":"controls/8.01-dp.rb","controls":["cis-gcp-8.1-dataproc"],"title":"Ensure that Dataproc Cluster is encrypted using Customer-Managed Encryption Key"}],"controls":[{"id":"cis-gcp-1.1-iam","title":"[IAM] Ensure that corporate login credentials are used","desc":"Use corporate login credentials instead of personal accounts, such as Gmail accounts.","descriptions":[{"label":"default","data":"Use corporate login credentials instead of personal accounts, such as Gmail accounts."},{"label":"rationale","data":"It is recommended fully-managed corporate Google accounts be used for increased visibility, auditing, and controlling access to Cloud Platform resources. Email accounts based outside of the user's organization, such as personal accounts, should not be used for business purposes."}],"impact":0.7,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/docs/enterprise/best-practices-for-enterprise-organizations#use_corporate_login_credentials","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"1.1","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'high'\n\n  title \"[#{control_abbrev.upcase}] Ensure that corporate login credentials are used\"\n\n  desc 'Use corporate login credentials instead of personal accounts, such as Gmail accounts.'\n  desc 'rationale', \"It is recommended fully-managed corporate Google accounts be used for increased visibility, auditing, and controlling access to Cloud Platform resources. Email accounts based outside of the user's organization, such as personal accounts, should not be used for business purposes.\"\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-2']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/docs/enterprise/best-practices-for-enterprise-organizations#use_corporate_login_credentials'\n\n  # determine the organization's email domain\n  case google_project(project: gcp_project_id).parent.type\n  when 'organization'\n    org_domain = google_organization(name: \"organizations/#{google_project(project: gcp_project_id).parent.id}\").display_name\n  when 'folder'\n    parent = 'folder'\n    folder_id = google_project(project: gcp_project_id).parent.id\n    while parent == 'folder'\n      if google_resourcemanager_folder(name: \"folders/#{folder_id}\").parent.include?('folders')\n        folder_id = google_resourcemanager_folder(name: \"folders/#{folder_id}\").parent.sub('folders/', '')\n      else\n        parent = 'organization'\n        org_domain = google_organization(name: google_resourcemanager_folder(name: \"folders/#{folder_id}\").parent.to_s).display_name\n      end\n    end\n  end\n\n  iam_bindings_cache.iam_binding_roles.each do |role|\n    iam_bindings_cache.iam_bindings[role].members.each do |member|\n      next if member.to_s.end_with?('.gserviceaccount.com')\n      describe \"[#{gcp_project_id}] [Role:#{role}] Its member #{member}\" do\n        subject { member.to_s }\n        it { should match(/@#{org_domain}/) }\n      end\n    end\n  end\nend\n","source_location":{"line":25,"ref":"./controls/1.01-iam.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"Control Source Code Error ./controls/1.01-iam.rb:25 ","run_time":0.000193956,"start_time":"2025-06-06T12:19:49+00:00","message":"Bad response: #<Net::HTTPForbidden:0x0000ffffacbfbf60>","exception":"RuntimeError","backtrace":["/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.8.24/lib/inspec/rule.rb:64:in `block (2 levels) in initialize'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/example.rb:263:in `instance_exec'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/example.rb:263:in `block in run'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/example.rb:511:in `block in with_around_and_singleton_context_hooks'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/example.rb:468:in `block in with_around_example_hooks'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/hooks.rb:486:in `block in run'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/hooks.rb:624:in `run_around_example_hooks_for'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/hooks.rb:486:in `run'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/example.rb:468:in `with_around_example_hooks'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/example.rb:511:in `with_around_and_singleton_context_hooks'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/example.rb:259:in `run'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/example_group.rb:646:in `block in run_examples'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/example_group.rb:642:in `map'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/example_group.rb:642:in `run_examples'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/example_group.rb:607:in `run'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/example_group.rb:608:in `block in run'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/example_group.rb:608:in `map'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/example_group.rb:608:in `run'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/runner.rb:121:in `block (3 levels) in run_specs'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/runner.rb:121:in `map'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/runner.rb:121:in `block (2 levels) in run_specs'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/configuration.rb:2097:in `with_suite_hooks'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/runner.rb:116:in `block in run_specs'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/reporter.rb:74:in `report'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.13.2/lib/rspec/core/runner.rb:115:in `run_specs'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.8.24/lib/inspec/runner_rspec.rb:97:in `run'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.8.24/lib/inspec/runner.rb:241:in `run_tests'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.8.24/lib/inspec/runner.rb:194:in `run'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.8.24/lib/inspec/cli.rb:410:in `block in exec'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.8.24/lib/inspec/feature/runner.rb:24:in `with_feature'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.8.24/lib/inspec/feature.rb:6:in `with_feature'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.8.24/lib/inspec/cli.rb:395:in `exec'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor/command.rb:27:in `run'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor/invocation.rb:127:in `invoke_command'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor.rb:392:in `dispatch'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor/base.rb:485:in `start'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.8.24/lib/inspec/base_cli.rb:40:in `start'","/opt/cinc-auditor/embedded/lib/ruby/gems/3.1.0/gems/cinc-auditor-bin-6.8.24/bin/cinc-auditor:12:in `<top (required)>'","/opt/cinc-auditor/bin/cinc-auditor:290:in `load'","/opt/cinc-auditor/bin/cinc-auditor:290:in `<main>'"],"resource_class":"Object","resource_params":"[]","resource_id":"./controls/1.01-iam.rb:25"}]},{"id":"cis-gcp-1.2-iam","title":"[IAM] Ensure that multi-factor authentication is enabled for all non-service accounts","desc":"Setup multi-factor authentication for Google Cloud Platform accounts.","descriptions":[{"label":"default","data":"Setup multi-factor authentication for Google Cloud Platform accounts."},{"label":"rationale","data":"Multi-factor authentication requires more than one mechanism to authenticate a user. This secures user logins from attackers exploiting stolen or weak credentials."},{"label":"notes","data":"This control generally requires manual verification because InSpec does not directly query user MFA status from Cloud Identity or Google Workspace. Verification steps are provided in the references."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/solutions/securing-gcp-account-u2f","ref":"GCP Docs"},{"url":"https://support.google.com/accounts/answer/185839","ref":"GCP Docs"}],"tags":{"cis_scored":false,"cis_level":1,"cis_gcp":"1.2","cis_version":"4.0","project":"lab-prod-461912","nist":["IA-2"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n  title \"[#{control_abbrev.upcase}] Ensure that multi-factor authentication is enabled for all non-service accounts\"\n  desc 'Setup multi-factor authentication for Google Cloud Platform accounts.'\n  desc 'rationale', 'Multi-factor authentication requires more than one mechanism to authenticate a user. This secures user logins from attackers exploiting stolen or weak credentials.'\n  desc 'notes', 'This control generally requires manual verification because InSpec does not directly query user MFA status from Cloud Identity or Google Workspace. Verification steps are provided in the references.'\n\n  tag cis_scored: false # Keep this as false\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['IA-2']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/solutions/securing-gcp-account-u2f'\n  ref 'GCP Docs', url: 'https://support.google.com/accounts/answer/185839'\n\n  describe 'This control is not scored' do\n    skip 'This control is not scored'\n  end\nend\n","source_location":{"line":25,"ref":"./controls/1.02-iam.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This control is not scored","run_time":1.5416e-05,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"This control is not scored","resource_class":"Object","resource_params":"[]","resource_id":"This control is not scored"}]},{"id":"cis-gcp-1.3-iam","title":"[IAM] Ensure that Security Key Enforcement is enabled for all admin accounts","desc":"Setup Security Key Enforcement for Google Cloud Platform admin accounts.","descriptions":[{"label":"default","data":"Setup Security Key Enforcement for Google Cloud Platform admin accounts."},{"label":"rationale","data":"Google Cloud Platform users with Organization Administrator roles have the highest level of privilege in the organization. These accounts should be protected with the strongest form of two-factor authentication: Security Key Enforcement. Ensure that admins use Security Keys to log in instead of weaker second factors like SMS or one-time passwords (OTP). Security Keys are actual physical keys used to access Google Organization Administrator Accounts. They send an encrypted signature rather than a code, ensuring that logins cannot be phished."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/security-key/","ref":"GCP Docs"},{"url":"https://gsuite.google.com/learn-more/key_for_working_smarter_faster_and_more_securely.html","ref":"GCP Docs"}],"tags":{"cis_scored":false,"cis_level":2,"cis_gcp":"1.3","cis_version":"4.0","project":"lab-prod-461912","nist":["IA-2"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n  title \"[#{control_abbrev.upcase}] Ensure that Security Key Enforcement is enabled for all admin accounts\"\n  desc 'Setup Security Key Enforcement for Google Cloud Platform admin accounts.'\n  desc 'rationale', 'Google Cloud Platform users with Organization Administrator roles have the highest level of privilege in the organization. These accounts should be protected with the strongest form of two-factor authentication: Security Key Enforcement. Ensure that admins use Security Keys to log in instead of weaker second factors like SMS or one-time passwords (OTP). Security Keys are actual physical keys used to access Google Organization Administrator Accounts. They send an encrypted signature rather than a code, ensuring that logins cannot be phished.'\n\n  tag cis_scored: false\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['IA-2']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/security-key/'\n  ref 'GCP Docs', url: 'https://gsuite.google.com/learn-more/key_for_working_smarter_faster_and_more_securely.html'\n\n  describe 'This control is not scored' do\n    skip 'This control is not scored'\n  end\nend\n","source_location":{"line":23,"ref":"./controls/1.03-iam.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This control is not scored","run_time":2.25e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"This control is not scored","resource_class":"Object","resource_params":"[]","resource_id":"This control is not scored"}]},{"id":"cis-gcp-1.4-iam","title":"[IAM] Ensure that there are only GCP-managed service account keys for each service account","desc":"User managed service account should not have user managed keys.","descriptions":[{"label":"default","data":"User managed service account should not have user managed keys."},{"label":"rationale","data":"Anyone who has access to the keys will be able to access resources through the service account. GCP-managed keys are used by Cloud Platform services such as App Engine and Compute Engine. These keys cannot be downloaded. Google will keep the keys and automatically rotate them on an approximately weekly basis. User-managed keys are created, downloadable, and managed by users. They expire 10 years from creation.  For user-managed keys, user have to take ownership of key management activities which includes: - Key storage - Key distribution - Key revocation - Key rotation - Protecting the keys from unauthorized users - Key recovery  Even after owners precaution, keys can be easily leaked by common development malpractices like checking keys into the source code or leaving them in Downloads directory, or accidentally leaving them on support blogs/channels.  It is recommended to prevent use of User-managed service account keys."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/iam/docs/understanding-service-accounts#managing_service_account_keys","ref":"GCP Docs"},{"url":"https://cloud.google.com/resource-manager/docs/organization-policy/restricting-service-accounts","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"1.4","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure that there are only GCP-managed service account keys for each service account\"\n  desc 'User managed service account should not have user managed keys.'\n  desc 'rationale', 'Anyone who has access to the keys will be able to access resources through the service account. GCP-managed keys are used by Cloud Platform services such as App Engine and Compute Engine. These keys cannot be downloaded. Google will keep the keys and automatically rotate them on an approximately weekly basis. User-managed keys are created, downloadable, and managed by users. They expire 10 years from creation.  For user-managed keys, user have to take ownership of key management activities which includes: - Key storage - Key distribution - Key revocation - Key rotation - Protecting the keys from unauthorized users - Key recovery  Even after owners precaution, keys can be easily leaked by common development malpractices like checking keys into the source code or leaving them in Downloads directory, or accidentally leaving them on support blogs/channels.  It is recommended to prevent use of User-managed service account keys.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-2']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/iam/docs/understanding-service-accounts#managing_service_account_keys'\n  ref 'GCP Docs', url: 'https://cloud.google.com/resource-manager/docs/organization-policy/restricting-service-accounts'\n\n  # Use google_service_accounts instead of the custom cache.\n  google_service_accounts(project: gcp_project_id).service_account_emails.each do |service_account|\n    # Use google_service_account_keys to get key types directly.\n    keys = google_service_account_keys(project: gcp_project_id, service_account: service_account)\n\n    describe \"[#{gcp_project_id}] Service Account: #{service_account}\" do\n      subject { keys }\n      it 'should not have user-managed keys' do\n        expect(keys.key_types).to_not include('USER_MANAGED')\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/1.04-iam.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"[lab-prod-461912] Service Account: 726686280170-compute@developer.gserviceaccount.com should not have user-managed keys","run_time":0.002317892,"start_time":"2025-06-06T12:19:49+00:00","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] Service Account: 726686280170-compute@developer.gserviceaccount.com"},{"status":"failed","code_desc":"[lab-prod-461912] Service Account: inspec@lab-prod-461912.iam.gserviceaccount.com should not have user-managed keys","run_time":0.026321552,"start_time":"2025-06-06T12:19:49+00:00","message":"expected [\"SYSTEM_MANAGED\", \"USER_MANAGED\"] not to include \"USER_MANAGED\"","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] Service Account: inspec@lab-prod-461912.iam.gserviceaccount.com"}]},{"id":"cis-gcp-1.5-iam","title":"[IAM] Ensure that ServiceAccount has no Admin privileges.","desc":"A service account is a special Google account that belongs to an application or a VM, instead of to an individual end-user. The application uses the service account to call the service's Google API so that users aren't directly involved. It's recommended not to use admin access for ServiceAccount.","descriptions":[{"label":"default","data":"A service account is a special Google account that belongs to an application or a VM, instead of to an individual end-user. The application uses the service account to call the service's Google API so that users aren't directly involved. It's recommended not to use admin access for ServiceAccount."},{"label":"rationale","data":"Service accounts represent service-level security of the Resources (application or a VM) which can be determined by the roles assigned to it. Enrolling ServiceAccount with Admin rights gives full access to an assigned application or a VM. A ServiceAccount Access holder can perform critical actions like delete, update change settings, etc. without user intervention. For this reason, it's recommended that service accounts not have Admin rights."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sdk/gcloud/reference/iam/service-accounts/","ref":"GCP Docs"},{"url":"https://cloud.google.com/iam/docs/understanding-roles","ref":"GCP Docs"},{"url":"https://cloud.google.com/iam/docs/understanding-service-accounts","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"1.5","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure that ServiceAccount has no Admin privileges.\"\n\n  desc \"A service account is a special Google account that belongs to an application or a VM, instead of to an individual end-user. The application uses the service account to call the service's Google API so that users aren't directly involved. It's recommended not to use admin access for ServiceAccount.\"\n  desc 'rationale', \"Service accounts represent service-level security of the Resources (application or a VM) which can be determined by the roles assigned to it. Enrolling ServiceAccount with Admin rights gives full access to an assigned application or a VM. A ServiceAccount Access holder can perform critical actions like delete, update change settings, etc. without user intervention. For this reason, it's recommended that service accounts not have Admin rights.\"\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-2']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sdk/gcloud/reference/iam/service-accounts/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/iam/docs/understanding-roles'\n  ref 'GCP Docs', url: 'https://cloud.google.com/iam/docs/understanding-service-accounts'\n\n  iam_bindings_cache.iam_bindings.keys.grep(/admin/i).each do |role|\n    role_bindings = iam_bindings_cache.iam_bindings[role]\n    if role_bindings.members.nil?\n      impact 'none'\n      describe \"[#{gcp_project_id}] Role bindings for role [#{role}] do not contain any members. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] role bindings for role [#{role}] do not contain any members.\"\n      end\n    else\n      describe \"[#{gcp_project_id}] Admin role [#{role}]\" do\n        subject { role_bindings }\n        its('members') { should_not include(/@[a-z][a-z0-9|-]{4,28}[a-z].iam.gserviceaccount.com/) }\n      end\n    end\n  end\n\n  iam_bindings_cache.iam_bindings.keys.grep(%r{roles/editor}).each do |role|\n    members_in_scope = []\n    iam_bindings_cache.iam_bindings[role].members.each do |member|\n      next if member.include? '@containerregistry.iam.gserviceaccount.com'\n      members_in_scope.push(member)\n    end\n    describe \"[#{gcp_project_id}] Project Editor Role\" do\n      subject { members_in_scope }\n      it { should_not include(/@[a-z][a-z0-9|-]{4,28}[a-z].iam.gserviceaccount.com/) }\n    end\n  end\n\n  iam_bindings_cache.iam_bindings.keys.grep(%r{roles/owner}).each do |role|\n    describe \"[#{gcp_project_id}] Project Owner Role\" do\n      subject { iam_bindings_cache.iam_bindings[role] }\n      its('members') { should_not include(/@[a-z][a-z0-9|-]{4,28}[a-z].iam.gserviceaccount.com/) }\n    end\n  end\nend\n","source_location":{"line":25,"ref":"./controls/1.05-iam.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"[lab-prod-461912] Project Editor Role is expected not to include /@[a-z][a-z0-9|-]{4,28}[a-z].iam.gserviceaccount.com/","run_time":0.000114083,"start_time":"2025-06-06T12:19:49+00:00","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] Project Editor Role"},{"status":"passed","code_desc":"[lab-prod-461912] Project Owner Role members is expected not to include /@[a-z][a-z0-9|-]{4,28}[a-z].iam.gserviceaccount.com/","run_time":8.4249e-05,"start_time":"2025-06-06T12:19:49+00:00","resource_class":"Object","resource_params":"[]","resource_id":"members"}]},{"id":"cis-gcp-1.6-iam","title":"[IAM] Ensure that IAM users are not assigned Service Account User role at project level","desc":"It is recommended to assign the Service Account User (iam.serviceAccountUser) and Service Account Token Creator (iam.serviceAccountTokenCreator) roles to a user for a specific service account rather than assigning the role to a user at project level.","descriptions":[{"label":"default","data":"It is recommended to assign the Service Account User (iam.serviceAccountUser) and Service Account Token Creator (iam.serviceAccountTokenCreator) roles to a user for a specific service account rather than assigning the role to a user at project level."},{"label":"rationale","data":"A service account is a special Google account that belongs to an application or a virtual machine (VM), instead of to an individual end-user. Application/VM-Instance uses the service account to call the service's Google API so that users aren't directly involved. In addition to being an identity, a service account is a resource that has IAM policies attached to it. These policies determine who can use the service account.\n\n  Users with IAM roles to update the App Engine and Compute Engine instances (such as App Engine Deployer or Compute Instance Admin) can effectively run code as the service accounts used to run these instances, and indirectly gain access to all the resources for which the service accounts have access. Similarly, SSH access to a Compute Engine instance may also provide the ability to execute code as that instance/Service account.\n\n  Based on business needs, there could be multiple user-managed service accounts configured for a project. Granting the iam.serviceAccountUser or iam.serviceAccountTokenCreator roles to a user for a project gives the user access to all service accounts in the project, including service accounts that may be created in the future. This can result in elevation of privileges by using service accounts and corresponding Compute Engine instances.\n\n  In order to implement least privileges best practices, IAM users should not be assigned the Service Account User or Service Account Token Creator roles at the project level. Instead, these roles should be assigned to a user for a specific service account, giving that user access to the service account. The Service Account User allows a user to bind a service account to a long-running job service, whereas the Service Account Token Creator role allows a user to directly impersonate (or assert) the identity of a service account."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/iam/docs/service-accounts","ref":"GCP Docs"},{"url":"https://cloud.google.com/iam/docs/granting-roles-to-service-accounts","ref":"GCP Docs"},{"url":"https://cloud.google.com/iam/docs/understanding-roles","ref":"GCP Docs"},{"url":"https://cloud.google.com/iam/docs/granting-changing-revoking-access","ref":"GCP Docs"},{"url":"https://console.cloud.google.com/iam-admin/iam","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"1.6","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2","AC-3"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure that IAM users are not assigned Service Account User role at project level\"\n\n  desc 'It is recommended to assign the Service Account User (iam.serviceAccountUser) and Service Account Token Creator (iam.serviceAccountTokenCreator) roles to a user for a specific service account rather than assigning the role to a user at project level.'\n  desc 'rationale', \"A service account is a special Google account that belongs to an application or a virtual machine (VM), instead of to an individual end-user. Application/VM-Instance uses the service account to call the service's Google API so that users aren't directly involved. In addition to being an identity, a service account is a resource that has IAM policies attached to it. These policies determine who can use the service account.\n\n  Users with IAM roles to update the App Engine and Compute Engine instances (such as App Engine Deployer or Compute Instance Admin) can effectively run code as the service accounts used to run these instances, and indirectly gain access to all the resources for which the service accounts have access. Similarly, SSH access to a Compute Engine instance may also provide the ability to execute code as that instance/Service account.\n\n  Based on business needs, there could be multiple user-managed service accounts configured for a project. Granting the iam.serviceAccountUser or iam.serviceAccountTokenCreator roles to a user for a project gives the user access to all service accounts in the project, including service accounts that may be created in the future. This can result in elevation of privileges by using service accounts and corresponding Compute Engine instances.\n\n  In order to implement least privileges best practices, IAM users should not be assigned the Service Account User or Service Account Token Creator roles at the project level. Instead, these roles should be assigned to a user for a specific service account, giving that user access to the service account. The Service Account User allows a user to bind a service account to a long-running job service, whereas the Service Account Token Creator role allows a user to directly impersonate (or assert) the identity of a service account.\"\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[AC-2 AC-3]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/iam/docs/service-accounts'\n  ref 'GCP Docs', url: 'https://cloud.google.com/iam/docs/granting-roles-to-service-accounts'\n  ref 'GCP Docs', url: 'https://cloud.google.com/iam/docs/understanding-roles'\n  ref 'GCP Docs', url: 'https://cloud.google.com/iam/docs/granting-changing-revoking-access'\n  ref 'GCP Docs', url: 'https://console.cloud.google.com/iam-admin/iam'\n\n  describe \"[#{gcp_project_id}] A project-level binding of ServiceAccountUser\" do\n    subject { iam_bindings_cache.iam_bindings['roles/iam.serviceAccountUser'] }\n    it { should eq nil }\n  end\nend\n","source_location":{"line":25,"ref":"./controls/1.06-iam.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"[lab-prod-461912] A project-level binding of ServiceAccountUser is expected to eq nil","run_time":0.001167113,"start_time":"2025-06-06T12:19:49+00:00","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] A project-level binding of ServiceAccountUser"}]},{"id":"cis-gcp-1.7-iam","title":"[IAM] Ensure user-managed/external keys for service accounts are rotated every 90 days or less","desc":"Service Account keys consist of a key ID (Private_key_Id) and Private key, which are used to sign programmatic requests users make to Google cloud services accessible to that particular service account. It is recommended that all Service Account keys are regularly rotated.","descriptions":[{"label":"default","data":"Service Account keys consist of a key ID (Private_key_Id) and Private key, which are used to sign programmatic requests users make to Google cloud services accessible to that particular service account. It is recommended that all Service Account keys are regularly rotated."},{"label":"rationale","data":"Rotating Service Account keys will reduce the window of opportunity for an access key that is associated with a compromised or terminated account to be used. Service Account keys should be rotated to ensure that data cannot be accessed with an old key that might have been lost, cracked, or stolen.\n\n  Each service account is associated with a key pair managed by Google Cloud Platform (GCP). It is used for service-to-service authentication within GCP. Google rotates the keys daily.\n\n  GCP provides the option to create one or more user-managed (also called external key pairs) key pairs for use from outside GCP (for example, for use with Application Default Credentials). When a new key pair is created, the user is required to download the private key (which is not retained by Google). With external keys, users are responsible for keeping the private key secure and other management operations such as key rotation. External keys can be managed by the IAM API, gcloud command-line tool, or the Service Accounts page in the Google Cloud Platform Console. GCP facilitates up to 10 external service account keys per service account to facilitate key rotation."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/iam/docs/understanding-service-accounts#managing_service_account_keys","ref":"GCP Docs"},{"url":"https://cloud.google.com/sdk/gcloud/reference/iam/service-accounts/keys/list","ref":"GCP Docs"},{"url":"https://cloud.google.com/iam/docs/service-accounts","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"1.7","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure user-managed/external keys for service accounts are rotated every 90 days or less\"\n\n  desc 'Service Account keys consist of a key ID (Private_key_Id) and Private key, which are used to sign programmatic requests users make to Google cloud services accessible to that particular service account. It is recommended that all Service Account keys are regularly rotated.'\n  desc 'rationale', \"Rotating Service Account keys will reduce the window of opportunity for an access key that is associated with a compromised or terminated account to be used. Service Account keys should be rotated to ensure that data cannot be accessed with an old key that might have been lost, cracked, or stolen.\n\n  Each service account is associated with a key pair managed by Google Cloud Platform (GCP). It is used for service-to-service authentication within GCP. Google rotates the keys daily.\n\n  GCP provides the option to create one or more user-managed (also called external key pairs) key pairs for use from outside GCP (for example, for use with Application Default Credentials). When a new key pair is created, the user is required to download the private key (which is not retained by Google). With external keys, users are responsible for keeping the private key secure and other management operations such as key rotation. External keys can be managed by the IAM API, gcloud command-line tool, or the Service Accounts page in the Google Cloud Platform Console. GCP facilitates up to 10 external service account keys per service account to facilitate key rotation.\"\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-2']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/iam/docs/understanding-service-accounts#managing_service_account_keys'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sdk/gcloud/reference/iam/service-accounts/keys/list'\n  ref 'GCP Docs', url: 'https://cloud.google.com/iam/docs/service-accounts'\n\n  service_account_cache.service_account_emails.each do |sa_email|\n    if service_account_cache.service_account_keys[sa_email].key_names.count > 1\n      impact 'medium'\n      describe \"[#{gcp_project_id}] ServiceAccount Keys for #{sa_email} older than #{sa_key_older_than_seconds} seconds\" do\n        subject { service_account_cache.service_account_keys[sa_email].where { (Time.now - sa_key_older_than_seconds > valid_after_time) } }\n        it { should_not exist }\n      end\n    else\n      describe \"[#{gcp_project_id}] ServiceAccount [#{sa_email}] does not have user-managed keys. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] ServiceAccount [#{sa_email}] does not have user-managed keys.\"\n      end\n    end\n  end\nend\n","source_location":{"line":26,"ref":"./controls/1.07-iam.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] ServiceAccount [726686280170-compute@developer.gserviceaccount.com] does not have user-managed keys. This test is Not Applicable.","run_time":2.208e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] ServiceAccount [726686280170-compute@developer.gserviceaccount.com] does not have user-managed keys.","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] ServiceAccount [726686280170-compute@developer.gserviceaccount.com] does not have user-managed keys. This test is Not Applicable."},{"status":"passed","code_desc":"[lab-prod-461912] ServiceAccount Keys for inspec@lab-prod-461912.iam.gserviceaccount.com older than 7776000 seconds is expected not to exist","run_time":0.000742117,"start_time":"2025-06-06T12:19:49+00:00","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] ServiceAccount Keys for inspec@lab-prod-461912.iam.gserviceaccount.com older than 7776000 seconds"}]},{"id":"cis-gcp-1.8-iam","title":"[IAM] Ensure that Separation of duties is enforced while assigning service account related roles to users","desc":"It is recommended that the principle of 'Separation of Duties' is enforced while assigning service-account related roles to users.","descriptions":[{"label":"default","data":"It is recommended that the principle of 'Separation of Duties' is enforced while assigning service-account related roles to users."},{"label":"rationale","data":"The built-in/predefined IAM role Service Account admin allows the user/identity to create, delete, and manage service account(s). The built-in/predefined IAM role Service Account User allows the user/identity (with adequate privileges on Compute and App Engine) to assign service account(s) to Apps/Compute Instances.\n\n  Separation of duties is the concept of ensuring that one individual does not have all necessary permissions to be able to complete a malicious action. In Cloud IAM - service accounts, this could be an action such as using a service account to access resources that user should not normally have access to.\n  Separation of duties is a business control typically used in larger organizations, meant to help avoid security or privacy incidents and errors. It is considered best practice.\n\n  No user should have Service Account Admin and Service Account User roles assigned at the same time."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/iam/docs/service-accounts","ref":"GCP Docs"},{"url":"https://cloud.google.com/iam/docs/understanding-roles","ref":"GCP Docs"},{"url":"https://cloud.google.com/iam/docs/granting-roles-to-service-accounts","ref":"GCP Docs"}],"tags":{"cis_scored":false,"cis_level":2,"cis_gcp":"1.8","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2","AC-3"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure that Separation of duties is enforced while assigning service account related roles to users\"\n\n  desc \"It is recommended that the principle of 'Separation of Duties' is enforced while assigning service-account related roles to users.\"\n  desc 'rationale', \"The built-in/predefined IAM role Service Account admin allows the user/identity to create, delete, and manage service account(s). The built-in/predefined IAM role Service Account User allows the user/identity (with adequate privileges on Compute and App Engine) to assign service account(s) to Apps/Compute Instances.\n\n  Separation of duties is the concept of ensuring that one individual does not have all necessary permissions to be able to complete a malicious action. In Cloud IAM - service accounts, this could be an action such as using a service account to access resources that user should not normally have access to.\n  Separation of duties is a business control typically used in larger organizations, meant to help avoid security or privacy incidents and errors. It is considered best practice.\n\n  No user should have Service Account Admin and Service Account User roles assigned at the same time.\"\n\n  tag cis_scored: false\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[AC-2 AC-3]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/iam/docs/service-accounts'\n  ref 'GCP Docs', url: 'https://cloud.google.com/iam/docs/understanding-roles'\n  ref 'GCP Docs', url: 'https://cloud.google.com/iam/docs/granting-roles-to-service-accounts'\n\n  sa_admins = iam_bindings_cache.iam_bindings['roles/iam.serviceAccountAdmin']\n  if sa_admins.nil? || sa_admins.members.count.zero?\n    describe \"[#{gcp_project_id}] does not contain users with roles/serviceAccountAdmin. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not contain users with roles/serviceAccountAdmin\"\n    end\n  elsif iam_bindings_cache.iam_bindings['roles/iam.serviceAccountUser'].nil?\n    describe \"[#{gcp_project_id}] does not contain users with roles/serviceAccountUser. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not contain users with roles/serviceAccountUser\"\n    end\n  else\n    impact 'medium'\n    describe \"[#{gcp_project_id}] roles/serviceAccountUser\" do\n      subject { iam_bindings_cache.iam_bindings['roles/iam.serviceAccountUser'] }\n      sa_admins.members.each do |sa_admin|\n        its('members.to_s') { should_not match sa_admin }\n      end\n    end\n  end\nend\n","source_location":{"line":25,"ref":"./controls/1.08-iam.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not contain users with roles/serviceAccountAdmin. This test is Not Applicable.","run_time":2.167e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain users with roles/serviceAccountAdmin","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain users with roles/serviceAccountAdmin. This test is Not Applicable."}]},{"id":"cis-gcp-1.9-iam","title":"[IAM] Ensure that Cloud KMS cryptokeys are not anonymously or publicly accessible","desc":"It is recommended that the IAM policy on Cloud KMS cryptokeys should restrict anonymous and/or public access.","descriptions":[{"label":"default","data":"It is recommended that the IAM policy on Cloud KMS cryptokeys should restrict anonymous and/or public access."},{"label":"rationale","data":"Granting permissions to allUsers or allAuthenticatedUsers allows anyone to access the dataset. Such access might not be desirable if sensitive data is stored at the location. In this case, ensure that anonymous and/or public access to a Cloud KMS cryptokey is not allowed."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sdk/gcloud/reference/kms/keys/remove-iam-policy-binding","ref":"GCP Docs"},{"url":"https://cloud.google.com/sdk/gcloud/reference/kms/keys/set-iam-policy","ref":"GCP Docs"},{"url":"https://cloud.google.com/sdk/gcloud/reference/kms/keys/get-iam-policy","ref":"GCP Docs"},{"url":"https://cloud.google.com/kms/docs/object-hierarchy#key_resource_id","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"1.9","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-3"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure that Cloud KMS cryptokeys are not anonymously or publicly accessible\"\n\n  desc 'It is recommended that the IAM policy on Cloud KMS cryptokeys should restrict anonymous and/or public access.'\n\n  desc 'rationale', 'Granting permissions to allUsers or allAuthenticatedUsers allows anyone to access the dataset. Such access might not be desirable if sensitive data is stored at the location. In this case, ensure that anonymous and/or public access to a Cloud KMS cryptokey is not allowed.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-3']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sdk/gcloud/reference/kms/keys/remove-iam-policy-binding'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sdk/gcloud/reference/kms/keys/set-iam-policy'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sdk/gcloud/reference/kms/keys/get-iam-policy'\n  ref 'GCP Docs', url: 'https://cloud.google.com/kms/docs/object-hierarchy#key_resource_id'\n\n  # Get all \"normal\" regions and add dual/multi regions\n  locations = google_compute_regions(project: gcp_project_id).region_names\n  locations << 'global' << 'asia' << 'europe' << 'us' << 'eur4' << 'nam4'\n  kms_cache = KMSKeyCache(project: gcp_project_id, locations: locations)\n\n  # Ensure that keys aren't publicly accessible\n  locations.each do |location|\n    if kms_cache.kms_key_ring_names[location].empty?\n      describe \"[#{gcp_project_id}] does not contain any key rings in [#{location}]. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] does not contain any key rings in [#{location}]\"\n      end\n    else\n      kms_cache.kms_key_ring_names[location].each do |keyring|\n        if kms_cache.kms_crypto_keys[location][keyring].empty?\n          describe \"[#{gcp_project_id}] key ring [#{keyring}] does not contain any cryptographic keys. This test is Not Applicable.\" do\n            skip \"[#{gcp_project_id}] key ring [#{keyring}] does not contain any cryptographic keys\"\n          end\n        else\n          kms_cache.kms_crypto_keys[location][keyring].each do |keyname|\n            if google_kms_crypto_key_iam_policy(project: gcp_project_id, location: location, key_ring_name: keyring, crypto_key_name: keyname).bindings.nil?\n              describe \"[#{gcp_project_id}] key ring [#{keyring}] key [#{keyname}] does not have any IAM bindings. This test is Not Applicable.\" do\n                skip \"[#{gcp_project_id}] key ring [#{keyring}] key [#{keyname}] does not have any IAM bindings\"\n              end\n            else\n              impact 'medium'\n              google_kms_crypto_key_iam_policy(project: gcp_project_id, location: location, key_ring_name: keyring, crypto_key_name: keyname).bindings.each do |binding|\n                describe binding do\n                  its('members') { should_not include 'allUsers' }\n                  its('members') { should_not include 'allAuthenticatedUsers' }\n                end\n              end\n            end\n          end\n        end\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/1.09-iam.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [africa-south1]. This test is Not Applicable.","run_time":1.5e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [africa-south1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [africa-south1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia-east1]. This test is Not Applicable.","run_time":1.833e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia-east1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia-east1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia-east2]. This test is Not Applicable.","run_time":1.334e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia-east2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia-east2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia-northeast1]. This test is Not Applicable.","run_time":1.208e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia-northeast1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia-northeast1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia-northeast2]. This test is Not Applicable.","run_time":1.208e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia-northeast2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia-northeast2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia-northeast3]. This test is Not Applicable.","run_time":1.25e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia-northeast3]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia-northeast3]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia-south1]. This test is Not Applicable.","run_time":1.25e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia-south1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia-south1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia-south2]. This test is Not Applicable.","run_time":1.375e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia-south2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia-south2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia-southeast1]. This test is Not Applicable.","run_time":1.25e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia-southeast1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia-southeast1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia-southeast2]. This test is Not Applicable.","run_time":1.208e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia-southeast2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia-southeast2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [australia-southeast1]. This test is Not Applicable.","run_time":1.25e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [australia-southeast1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [australia-southeast1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [australia-southeast2]. This test is Not Applicable.","run_time":1.667e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [australia-southeast2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [australia-southeast2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-central2]. This test is Not Applicable.","run_time":1.375e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-central2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-central2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-north1]. This test is Not Applicable.","run_time":1.5e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-north1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-north1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-north2]. This test is Not Applicable.","run_time":1.709e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-north2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-north2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-southwest1]. This test is Not Applicable.","run_time":1.167e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-southwest1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-southwest1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-west1]. This test is Not Applicable.","run_time":1.5e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-west1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-west1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-west10]. This test is Not Applicable.","run_time":1.208e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-west10]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-west10]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-west12]. This test is Not Applicable.","run_time":1.292e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-west12]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-west12]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-west2]. This test is Not Applicable.","run_time":1.584e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-west2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-west2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-west3]. This test is Not Applicable.","run_time":1.333e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-west3]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-west3]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-west4]. This test is Not Applicable.","run_time":1.167e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-west4]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-west4]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-west6]. This test is Not Applicable.","run_time":1.167e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-west6]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-west6]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-west8]. This test is Not Applicable.","run_time":1.5e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-west8]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-west8]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-west9]. This test is Not Applicable.","run_time":1.208e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-west9]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-west9]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [me-central1]. This test is Not Applicable.","run_time":1.375e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [me-central1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [me-central1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [me-central2]. This test is Not Applicable.","run_time":1.458e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [me-central2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [me-central2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [me-west1]. This test is Not Applicable.","run_time":1.25e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [me-west1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [me-west1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [northamerica-northeast1]. This test is Not Applicable.","run_time":1.416e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [northamerica-northeast1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [northamerica-northeast1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [northamerica-northeast2]. This test is Not Applicable.","run_time":1.333e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [northamerica-northeast2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [northamerica-northeast2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [northamerica-south1]. This test is Not Applicable.","run_time":1.917e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [northamerica-south1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [northamerica-south1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [southamerica-east1]. This test is Not Applicable.","run_time":1.25e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [southamerica-east1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [southamerica-east1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [southamerica-west1]. This test is Not Applicable.","run_time":1.375e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [southamerica-west1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [southamerica-west1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us-central1]. This test is Not Applicable.","run_time":1.459e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us-central1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us-central1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us-east1]. This test is Not Applicable.","run_time":1.25e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us-east1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us-east1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us-east4]. This test is Not Applicable.","run_time":1.667e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us-east4]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us-east4]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us-east5]. This test is Not Applicable.","run_time":1.75e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us-east5]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us-east5]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us-south1]. This test is Not Applicable.","run_time":1.292e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us-south1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us-south1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us-west1]. This test is Not Applicable.","run_time":1.375e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us-west1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us-west1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us-west2]. This test is Not Applicable.","run_time":1.291e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us-west2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us-west2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us-west3]. This test is Not Applicable.","run_time":1.208e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us-west3]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us-west3]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us-west4]. This test is Not Applicable.","run_time":1.375e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us-west4]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us-west4]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [global]. This test is Not Applicable.","run_time":1.208e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [global]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [global]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia]. This test is Not Applicable.","run_time":1.167e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe]. This test is Not Applicable.","run_time":1.25e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us]. This test is Not Applicable.","run_time":1.209e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [eur4]. This test is Not Applicable.","run_time":1.333e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [eur4]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [eur4]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [nam4]. This test is Not Applicable.","run_time":1.209e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [nam4]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [nam4]. This test is Not Applicable."}]},{"id":"cis-gcp-1.10-iam","title":"[IAM] Ensure KMS Encryption Keys Are Rotated Within a Period of 90 Days","desc":"Google Cloud Key Management Service stores cryptographic keys in a hierarchical structure designed for useful and elegant access control management.\n\n  The format for the rotation schedule depends on the client library that is used. For the gcloud command-line tool, the next rotation time must be in ISO or RFC3339 format, and the rotation period must be in the form INTEGER[UNIT], where units can be one of seconds (s), minutes (m), hours (h) or days (d).","descriptions":[{"label":"default","data":"Google Cloud Key Management Service stores cryptographic keys in a hierarchical structure designed for useful and elegant access control management.\n\n  The format for the rotation schedule depends on the client library that is used. For the gcloud command-line tool, the next rotation time must be in ISO or RFC3339 format, and the rotation period must be in the form INTEGER[UNIT], where units can be one of seconds (s), minutes (m), hours (h) or days (d)."},{"label":"rationale","data":"Set a key rotation period and starting time. A key can be created with a specified rotation period, which is the time between when new key versions are generated automatically. A key can also be created with a specified next rotation time. A key is a named object representing a cryptographic key used for a specific purpose. The key material, the actual bits used for encryption, can change over time as new key versions are created.\n\n  A key is used to protect some corpus of data. A collection of files could be encrypted with the same key and people with decrypt permissions on that key would be able to decrypt those files. Therefore, it's necessary to make sure the rotation period is set to a specific time."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/kms/docs/key-rotation#frequency_of_key_rotation","ref":"GCP Docs"},{"url":"https://cloud.google.com/kms/docs/re-encrypt-data","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"1.10","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure KMS Encryption Keys Are Rotated Within a Period of 90 Days\"\n\n  desc \"Google Cloud Key Management Service stores cryptographic keys in a hierarchical structure designed for useful and elegant access control management.\n\n  The format for the rotation schedule depends on the client library that is used. For the gcloud command-line tool, the next rotation time must be in ISO or RFC3339 format, and the rotation period must be in the form INTEGER[UNIT], where units can be one of seconds (s), minutes (m), hours (h) or days (d).\"\n\n  desc 'rationale', \"Set a key rotation period and starting time. A key can be created with a specified rotation period, which is the time between when new key versions are generated automatically. A key can also be created with a specified next rotation time. A key is a named object representing a cryptographic key used for a specific purpose. The key material, the actual bits used for encryption, can change over time as new key versions are created.\n\n  A key is used to protect some corpus of data. A collection of files could be encrypted with the same key and people with decrypt permissions on that key would be able to decrypt those files. Therefore, it's necessary to make sure the rotation period is set to a specific time.\"\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-2']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/kms/docs/key-rotation#frequency_of_key_rotation'\n  ref 'GCP Docs', url: 'https://cloud.google.com/kms/docs/re-encrypt-data'\n\n  # Get all \"normal\" regions and add dual/multi regions\n  locations = google_compute_regions(project: gcp_project_id).region_names\n  locations << 'global' << 'asia' << 'europe' << 'us' << 'eur4' << 'nam4'\n\n  kms_cache = KMSKeyCache(project: gcp_project_id, locations: locations)\n\n  # Ensure KMS keys autorotate 90d or less\n  locations.each do |location|\n    if kms_cache.kms_key_ring_names[location].empty?\n      describe \"[#{gcp_project_id}] does not contain any key rings in [#{location}]. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] does not contain any key rings in [#{location}]\"\n      end\n    else\n      kms_cache.kms_key_ring_names[location].each do |keyring|\n        if kms_cache.kms_crypto_keys[location][keyring].empty?\n          describe \"[#{gcp_project_id}] key ring [#{keyring}] does not contain any cryptographic keys. This test is Not Applicable.\" do\n            skip \"[#{gcp_project_id}] key ring [#{keyring}] does not contain any cryptographic keys\"\n          end\n        else\n          kms_cache.kms_crypto_keys[location][keyring].each do |keyname|\n            key = google_kms_crypto_key(project: gcp_project_id, location: location, key_ring_name: keyring, name: keyname)\n            next unless key.purpose == 'ENCRYPT_DECRYPT' && key.primary_state == 'ENABLED'\n            impact 'medium'\n            describe \"[#{gcp_project_id}] #{key.crypto_key_name}\" do\n              subject { key }\n              its('rotation_period') { should_not eq nil }\n              unless key.rotation_period.nil?\n                rotation_period_int = key.rotation_period.delete_suffix('s').to_i\n                it \"should have a lower or equal rotation period than #{kms_rotation_period_seconds}\" do\n                  expect(rotation_period_int).to be <= kms_rotation_period_seconds\n                end\n                its('next_rotation_time') { should be <= (Time.now + kms_rotation_period_seconds) }\n              end\n            end\n          end\n        end\n      end\n    end\n  end\nend\n","source_location":{"line":24,"ref":"./controls/1.10-iam.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [africa-south1]. This test is Not Applicable.","run_time":1.584e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [africa-south1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [africa-south1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia-east1]. This test is Not Applicable.","run_time":1.625e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia-east1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia-east1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia-east2]. This test is Not Applicable.","run_time":1.208e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia-east2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia-east2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia-northeast1]. This test is Not Applicable.","run_time":1.292e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia-northeast1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia-northeast1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia-northeast2]. This test is Not Applicable.","run_time":1.375e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia-northeast2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia-northeast2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia-northeast3]. This test is Not Applicable.","run_time":1.375e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia-northeast3]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia-northeast3]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia-south1]. This test is Not Applicable.","run_time":1.5e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia-south1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia-south1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia-south2]. This test is Not Applicable.","run_time":1.209e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia-south2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia-south2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia-southeast1]. This test is Not Applicable.","run_time":1.25e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia-southeast1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia-southeast1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia-southeast2]. This test is Not Applicable.","run_time":1.375e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia-southeast2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia-southeast2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [australia-southeast1]. This test is Not Applicable.","run_time":1.167e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [australia-southeast1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [australia-southeast1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [australia-southeast2]. This test is Not Applicable.","run_time":1.208e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [australia-southeast2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [australia-southeast2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-central2]. This test is Not Applicable.","run_time":1.167e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-central2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-central2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-north1]. This test is Not Applicable.","run_time":1.125e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-north1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-north1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-north2]. This test is Not Applicable.","run_time":1.292e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-north2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-north2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-southwest1]. This test is Not Applicable.","run_time":1.166e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-southwest1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-southwest1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-west1]. This test is Not Applicable.","run_time":1.167e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-west1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-west1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-west10]. This test is Not Applicable.","run_time":1.458e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-west10]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-west10]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-west12]. This test is Not Applicable.","run_time":1.333e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-west12]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-west12]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-west2]. This test is Not Applicable.","run_time":1.166e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-west2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-west2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-west3]. This test is Not Applicable.","run_time":1.333e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-west3]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-west3]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-west4]. This test is Not Applicable.","run_time":1.709e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-west4]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-west4]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-west6]. This test is Not Applicable.","run_time":1.166e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-west6]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-west6]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-west8]. This test is Not Applicable.","run_time":1.25e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-west8]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-west8]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe-west9]. This test is Not Applicable.","run_time":1.209e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe-west9]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe-west9]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [me-central1]. This test is Not Applicable.","run_time":1.541e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [me-central1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [me-central1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [me-central2]. This test is Not Applicable.","run_time":1.416e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [me-central2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [me-central2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [me-west1]. This test is Not Applicable.","run_time":1.166e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [me-west1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [me-west1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [northamerica-northeast1]. This test is Not Applicable.","run_time":1.166e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [northamerica-northeast1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [northamerica-northeast1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [northamerica-northeast2]. This test is Not Applicable.","run_time":1.375e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [northamerica-northeast2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [northamerica-northeast2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [northamerica-south1]. This test is Not Applicable.","run_time":1.459e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [northamerica-south1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [northamerica-south1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [southamerica-east1]. This test is Not Applicable.","run_time":1.291e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [southamerica-east1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [southamerica-east1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [southamerica-west1]. This test is Not Applicable.","run_time":1.208e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [southamerica-west1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [southamerica-west1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us-central1]. This test is Not Applicable.","run_time":1.5e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us-central1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us-central1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us-east1]. This test is Not Applicable.","run_time":1.208e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us-east1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us-east1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us-east4]. This test is Not Applicable.","run_time":1.416e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us-east4]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us-east4]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us-east5]. This test is Not Applicable.","run_time":1.334e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us-east5]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us-east5]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us-south1]. This test is Not Applicable.","run_time":1.167e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us-south1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us-south1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us-west1]. This test is Not Applicable.","run_time":1.209e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us-west1]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us-west1]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us-west2]. This test is Not Applicable.","run_time":1.334e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us-west2]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us-west2]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us-west3]. This test is Not Applicable.","run_time":1.5e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us-west3]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us-west3]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us-west4]. This test is Not Applicable.","run_time":1.125e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us-west4]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us-west4]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [global]. This test is Not Applicable.","run_time":1.084e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [global]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [global]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [asia]. This test is Not Applicable.","run_time":1.125e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [asia]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [asia]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [europe]. This test is Not Applicable.","run_time":1.333e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [europe]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [europe]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [us]. This test is Not Applicable.","run_time":1.167e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [us]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [us]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [eur4]. This test is Not Applicable.","run_time":1.541e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [eur4]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [eur4]. This test is Not Applicable."},{"status":"skipped","code_desc":"[lab-prod-461912] does not contain any key rings in [nam4]. This test is Not Applicable.","run_time":1.333e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not contain any key rings in [nam4]","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not contain any key rings in [nam4]. This test is Not Applicable."}]},{"id":"cis-gcp-1.11-iam","title":"[IAM] Ensure that Separation of duties is enforced while assigning KMS related roles to users","desc":"It is recommended that the principle of 'Separation of Duties' is enforced while assigning KMS related roles to users.","descriptions":[{"label":"default","data":"It is recommended that the principle of 'Separation of Duties' is enforced while assigning KMS related roles to users."},{"label":"rationale","data":"The built-in/predefined IAM role Cloud KMS Admin allows the user/identity to create, delete, and manage service account(s). The built-in/predefined IAM role Cloud KMS CryptoKey Encrypter/Decrypter allows the user/identity (with adequate privileges on concerned resources) to encrypt and decrypt data at rest using an encryption key(s).\n\n  The built-in/predefined IAM role Cloud KMS CryptoKey Encrypter allows the user/identity (with adequate privileges on concerned resources) to encrypt data at rest using an encryption key(s). The built-in/predefined IAM role Cloud KMS CryptoKey Decrypter allows the user/identity (with adequate privileges on concerned resources) to decrypt data at rest using an encryption key(s).\n\n  Separation of duties is the concept of ensuring that one individual does not have all necessary permissions to be able to complete a malicious action. In Cloud KMS, this could be an action such as using a key to access and decrypt data a user should not normally have access to. Separation of duties is a business control typically used in larger organizations, meant to help avoid security or privacy incidents and errors. It is considered best practice.\n\n  No user(s) should have Cloud KMS Admin and any of the Cloud KMS CryptoKey Encrypter/Decrypter, Cloud KMS CryptoKey Encrypter, Cloud KMS CryptoKey Decrypter roles assigned at the same time."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/kms/docs/separation-of-duties","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"1.11","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2","AC-3","AC-6"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure that Separation of duties is enforced while assigning KMS related roles to users\"\n\n  desc \"It is recommended that the principle of 'Separation of Duties' is enforced while assigning KMS related roles to users.\"\n\n  desc 'rationale', \"The built-in/predefined IAM role Cloud KMS Admin allows the user/identity to create, delete, and manage service account(s). The built-in/predefined IAM role Cloud KMS CryptoKey Encrypter/Decrypter allows the user/identity (with adequate privileges on concerned resources) to encrypt and decrypt data at rest using an encryption key(s).\n\n  The built-in/predefined IAM role Cloud KMS CryptoKey Encrypter allows the user/identity (with adequate privileges on concerned resources) to encrypt data at rest using an encryption key(s). The built-in/predefined IAM role Cloud KMS CryptoKey Decrypter allows the user/identity (with adequate privileges on concerned resources) to decrypt data at rest using an encryption key(s).\n\n  Separation of duties is the concept of ensuring that one individual does not have all necessary permissions to be able to complete a malicious action. In Cloud KMS, this could be an action such as using a key to access and decrypt data a user should not normally have access to. Separation of duties is a business control typically used in larger organizations, meant to help avoid security or privacy incidents and errors. It is considered best practice.\n\n  No user(s) should have Cloud KMS Admin and any of the Cloud KMS CryptoKey Encrypter/Decrypter, Cloud KMS CryptoKey Encrypter, Cloud KMS CryptoKey Decrypter roles assigned at the same time.\"\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[AC-2 AC-3 AC-6]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/kms/docs/separation-of-duties'\n\n  kms_admins = google_project_iam_binding(project: gcp_project_id, role: 'roles/cloudkms.admin')\n\n  if kms_admins.members.nil? || kms_admins.members.count.zero?\n    impact 'none'\n    describe \"[#{gcp_project_id}] does not have users with roles/CloudKMSAdmin. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have users with roles/CloudKMSAdmin\"\n    end\n  else\n    describe \"[#{gcp_project_id}] roles/cloudkms.cryptoKeyEncrypter\" do\n      subject { google_project_iam_binding(project: gcp_project_id, role: 'roles/cloudkms.cryptoKeyEncrypter') }\n      kms_admins.members.each do |kms_admin|\n        its('members.to_s') { should_not match kms_admin }\n      end\n    end\n    describe \"[#{gcp_project_id}] roles/cloudkms.cryptoKeyDecrypter\" do\n      subject { google_project_iam_binding(project: gcp_project_id, role: 'roles/cloudkms.cryptoKeyDecrypter') }\n      kms_admins.members.each do |kms_admin|\n        its('members.to_s') { should_not match kms_admin }\n      end\n    end\n    describe \"[#{gcp_project_id}] roles/cloudkms.cryptoKeyEncrypterDecrypter\" do\n      subject { google_project_iam_binding(project: gcp_project_id, role: 'roles/cloudkms.cryptoKeyEncrypterDecrypter') }\n      kms_admins.members.each do |kms_admin|\n        its('members.to_s') { should_not match kms_admin }\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/1.11-iam.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have users with roles/CloudKMSAdmin. This test is Not Applicable.","run_time":1.208e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"[lab-prod-461912] does not have users with roles/CloudKMSAdmin","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have users with roles/CloudKMSAdmin. This test is Not Applicable."}]},{"id":"cis-gcp-1.12-iam","title":"[IAM] Ensure API Keys Only Exist for Active Services","desc":"API Keys should only be used for services in cases where other authentication methods are unavailable. Unused keys with their permissions in tact may still exist within a project. Keys are insecure because they can be viewed publicly, such as from within a browser, or they can be accessed on a device where the key resides. It is recommended to use standard authentication flow instead.","descriptions":[{"label":"default","data":"API Keys should only be used for services in cases where other authentication methods are unavailable. Unused keys with their permissions in tact may still exist within a project. Keys are insecure because they can be viewed publicly, such as from within a browser, or they can be accessed on a device where the key resides. It is recommended to use standard authentication flow instead."},{"label":"rationale","data":"To avoid the security risk in using API keys, it is recommended to use standard authentication flow instead. Security risks involved in using API-Keys appear below:\n  - API keys are simple encrypted strings\n  - API keys do not identify the user or the application making the API request\n  - API keys are typically accessible to clients, making it easy to discover and steal an API key"}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/docs/authentication/api-keys","ref":"GCP Docs"},{"url":"https://cloud.google.com/sdk/gcloud/reference/services/api-keys/list","ref":"GCP Docs"},{"url":"https://cloud.google.com/docs/authentication","ref":"GCP Docs"},{"url":"https://cloud.google.com/sdk/gcloud/reference/services/api-keys/delete","ref":"GCP Docs"}],"tags":{"cis_scored":false,"cis_level":2,"cis_gcp":"1.12","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure API Keys Only Exist for Active Services\"\n\n  desc 'API Keys should only be used for services in cases where other authentication methods are unavailable. Unused keys with their permissions in tact may still exist within a project. Keys are insecure because they can be viewed publicly, such as from within a browser, or they can be accessed on a device where the key resides. It is recommended to use standard authentication flow instead.'\n  desc 'rationale', \"To avoid the security risk in using API keys, it is recommended to use standard authentication flow instead. Security risks involved in using API-Keys appear below:\n  - API keys are simple encrypted strings\n  - API keys do not identify the user or the application making the API request\n  - API keys are typically accessible to clients, making it easy to discover and steal an API key\"\n\n  tag cis_scored: false\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-2']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/docs/authentication/api-keys'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sdk/gcloud/reference/services/api-keys/list'\n  ref 'GCP Docs', url: 'https://cloud.google.com/docs/authentication'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sdk/gcloud/reference/services/api-keys/delete'\n  describe 'This control is not scored' do\n    skip 'This control is not scored'\n  end\nend\n","source_location":{"line":23,"ref":"./controls/1.12-iam.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This control is not scored","run_time":1.625e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"This control is not scored","resource_class":"Object","resource_params":"[]","resource_id":"This control is not scored"}]},{"id":"cis-gcp-1.13-iam","title":"[IAM] Ensure API Keys Are Restricted To Use by Only Specified Hosts and Apps","desc":"API Keys should only be used for services in cases where other authentication methods are unavailable. In this case, unrestricted keys are insecure because they can be viewed publicly, such as from within a browser, or they can be accessed on a device where the key resides. It is recommended to restrict API key usage to trusted hosts, HTTP referrers and apps. It is recommended to use the more secure standard authentication flow instead.","descriptions":[{"label":"default","data":"API Keys should only be used for services in cases where other authentication methods are unavailable. In this case, unrestricted keys are insecure because they can be viewed publicly, such as from within a browser, or they can be accessed on a device where the key resides. It is recommended to restrict API key usage to trusted hosts, HTTP referrers and apps. It is recommended to use the more secure standard authentication flow instead."},{"label":"rationale","data":"Security risks involved in using API-Keys appear below:\n- API keys are simple encrypted strings\n- API keys do not identify the user or the application making the API request\n- API keys are typically accessible to clients, making it easy to discover and steal an API key\nIn light of these potential risks, Google recommends using the standard authentication flow instead of API keys. However, there are limited cases where API keys are more appropriate. For example, if there is a mobile application that needs to use the Google Cloud Translation API, but doesn't otherwise need a backend server, API keys are the simplest way to authenticate to that API.\nIn order to reduce attack vectors, API-Keys can be restricted only to trusted hosts, HTTP referrers and applications."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/docs/authentication/api-keys","ref":"GCP Docs"},{"url":"https://cloud.google.com/sdk/gcloud/reference/services/api-keys/list","ref":"GCP Docs"},{"url":"https://cloud.google.com/sdk/gcloud/reference/services/api-keys/update","ref":"GCP Docs"}],"tags":{"cis_scored":false,"cis_level":2,"cis_gcp":"1.13","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure API Keys Are Restricted To Use by Only Specified Hosts and Apps\"\n\n  desc 'API Keys should only be used for services in cases where other authentication methods are unavailable. In this case, unrestricted keys are insecure because they can be viewed publicly, such as from within a browser, or they can be accessed on a device where the key resides. It is recommended to restrict API key usage to trusted hosts, HTTP referrers and apps. It is recommended to use the more secure standard authentication flow instead.'\n  desc 'rationale', \"Security risks involved in using API-Keys appear below:\n- API keys are simple encrypted strings\n- API keys do not identify the user or the application making the API request\n- API keys are typically accessible to clients, making it easy to discover and steal an API key\nIn light of these potential risks, Google recommends using the standard authentication flow instead of API keys. However, there are limited cases where API keys are more appropriate. For example, if there is a mobile application that needs to use the Google Cloud Translation API, but doesn't otherwise need a backend server, API keys are the simplest way to authenticate to that API.\nIn order to reduce attack vectors, API-Keys can be restricted only to trusted hosts, HTTP referrers and applications.\"\n\n  tag cis_scored: false\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-2']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/docs/authentication/api-keys'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sdk/gcloud/reference/services/api-keys/list'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sdk/gcloud/reference/services/api-keys/update'\n\n  describe 'This control is not scored' do\n    skip 'This control is not scored'\n  end\nend\n","source_location":{"line":23,"ref":"./controls/1.13-iam.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This control is not scored","run_time":1.25e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"This control is not scored","resource_class":"Object","resource_params":"[]","resource_id":"This control is not scored"}]},{"id":"cis-gcp-1.14-iam","title":"[IAM] Ensure API keys are restricted to only APIs that application needs access","desc":"API keys are insecure because they can be viewed publicly, such as from within a browser, or they can be accessed on a device where the key resides. It is recommended to restrict API keys to use (call) only APIs required by an application.","descriptions":[{"label":"default","data":"API keys are insecure because they can be viewed publicly, such as from within a browser, or they can be accessed on a device where the key resides. It is recommended to restrict API keys to use (call) only APIs required by an application."},{"label":"rationale","data":"Security risks involved in using API-Keys are below:\n\n- API keys are a simple encrypted strings\n- API keys do not identify the user or the application making the API request\n- API keys are typically accessible to clients, making it easy to discover and steal an API key\n\nBecause of this Google recommend using the standard authentication flow instead.  However, there are limited cases where API keys are more appropriate. For example, if there is a mobile application that needs to use the Google Cloud Translation API, but doesn't otherwise need a back-end server, API keys are the simplest way to authenticate to that API.\n\nIn order to reduce attack surface by providing least privileges, API-Keys can be\nrestricted to use (call) only APIs required by an application."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/docs/authentication/api-keys","ref":"GCP Docs"},{"url":"https://cloud.google.com/apis/docs/overview","ref":"GCP Docs"}],"tags":{"cis_scored":false,"cis_level":2,"cis_gcp":"1.14","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure API keys are restricted to only APIs that application needs access\"\n\n  desc 'API keys are insecure because they can be viewed publicly, such as from within a browser, or they can be accessed on a device where the key resides. It is recommended to restrict API keys to use (call) only APIs required by an application.'\n  desc 'rationale', \"Security risks involved in using API-Keys are below:\n\n- API keys are a simple encrypted strings\n- API keys do not identify the user or the application making the API request\n- API keys are typically accessible to clients, making it easy to discover and steal an API key\n\nBecause of this Google recommend using the standard authentication flow instead.  However, there are limited cases where API keys are more appropriate. For example, if there is a mobile application that needs to use the Google Cloud Translation API, but doesn't otherwise need a back-end server, API keys are the simplest way to authenticate to that API.\n\nIn order to reduce attack surface by providing least privileges, API-Keys can be\nrestricted to use (call) only APIs required by an application.\"\n\n  tag cis_scored: false\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-2']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/docs/authentication/api-keys'\n  ref 'GCP Docs', url: 'https://cloud.google.com/apis/docs/overview'\n\n  describe 'This control is not scored' do\n    skip 'This control is not scored'\n  end\nend\n","source_location":{"line":23,"ref":"./controls/1.14-iam.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This control is not scored","run_time":1.167e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"This control is not scored","resource_class":"Object","resource_params":"[]","resource_id":"This control is not scored"}]},{"id":"cis-gcp-1.15-iam","title":"[IAM] Ensure API keys are rotated every 90 days","desc":"API Keys should only be used for services in cases where other authentication methods are unavailable. If they are in use it is recommended to rotate API keys every 90 days.","descriptions":[{"label":"default","data":"API Keys should only be used for services in cases where other authentication methods are unavailable. If they are in use it is recommended to rotate API keys every 90 days."},{"label":"rationale","data":"Security risks involved in using API-Keys are listed below:\n  - API keys are simple encrypted strings\n  - API keys do not identify the user or the application making the API request\n  - API keys are typically accessible to clients, making it easy to discover and steal an API key\n\n  Because of these potential risks, Google recommends using the standard authentication flow instead of API Keys. However, there are limited cases where API keys are more appropriate. For example, if there is a mobile application that needs to use the Google Cloud Translation API, but doesn't otherwise need a backend server, API keys are the simplest way to authenticate to that API.\n\n  Once a key is stolen, it has no expiration, meaning it may be used indefinitely unless the project owner revokes or regenerates the key. Rotating API keys will reduce the window of opportunity for an access key that is associated with a compromised or terminated account to be used.\n\n  API keys should be rotated to ensure that data cannot be accessed with an old key that might have been lost, cracked, or stolen."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"}],"tags":{"cis_scored":false,"cis_level":2,"cis_gcp":"1.15","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure API keys are rotated every 90 days\"\n\n  desc 'API Keys should only be used for services in cases where other authentication methods are unavailable. If they are in use it is recommended to rotate API keys every 90 days.'\n  desc 'rationale', \"Security risks involved in using API-Keys are listed below:\n  - API keys are simple encrypted strings\n  - API keys do not identify the user or the application making the API request\n  - API keys are typically accessible to clients, making it easy to discover and steal an API key\n\n  Because of these potential risks, Google recommends using the standard authentication flow instead of API Keys. However, there are limited cases where API keys are more appropriate. For example, if there is a mobile application that needs to use the Google Cloud Translation API, but doesn't otherwise need a backend server, API keys are the simplest way to authenticate to that API.\n\n  Once a key is stolen, it has no expiration, meaning it may be used indefinitely unless the project owner revokes or regenerates the key. Rotating API keys will reduce the window of opportunity for an access key that is associated with a compromised or terminated account to be used.\n\n  API keys should be rotated to ensure that data cannot be accessed with an old key that might have been lost, cracked, or stolen.\"\n\n  tag cis_scored: false\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-2']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n\n  describe 'This control is not scored' do\n    skip 'This control is not scored'\n  end\nend\n","source_location":{"line":23,"ref":"./controls/1.15-iam.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This control is not scored","run_time":1.458e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"This control is not scored","resource_class":"Object","resource_params":"[]","resource_id":"This control is not scored"}]},{"id":"cis-gcp-1.16-iam","title":"[IAM] Ensure Essential Contacts is Configured for Organization","desc":"It is recommended that Essential Contacts is configured to designate email addresses for Google Cloud services to notify of important technical or security information.","descriptions":[{"label":"default","data":"It is recommended that Essential Contacts is configured to designate email addresses for Google Cloud services to notify of important technical or security information."},{"label":"rationale","data":"Many Google Cloud services, such as Cloud Billing, send out notifications to share important information with Google Cloud users. By default, these notifications are sent to members with certain Identity and Access Management (IAM) roles. With Essential Contacts, you can customize who receives notifications by providing your own list of contacts."}],"impact":0.1,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/resource-manager/docs/managing-notification-contacts","ref":"GCP Docs"}],"tags":{"cis_scored":false,"cis_level":1,"cis_gcp":"1.16","cis_version":"4.0","project":"lab-prod-461912","nist":["CP-2"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'low'\n  title \"[#{control_abbrev.upcase}] Ensure Essential Contacts is Configured for Organization\"\n  desc 'It is recommended that Essential Contacts is configured to designate email addresses for Google Cloud services to notify of important technical or security information.'\n  desc 'rationale', 'Many Google Cloud services, such as Cloud Billing, send out notifications to share important information with Google Cloud users. By default, these notifications are sent to members with certain Identity and Access Management (IAM) roles. With Essential Contacts, you can customize who receives notifications by providing your own list of contacts.'\n\n  tag cis_scored: false\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['CP-2']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/resource-manager/docs/managing-notification-contacts'\n  describe 'This control is not scored' do\n    skip 'This control is not scored'\n  end\nend\n","source_location":{"line":23,"ref":"./controls/1.16-iam.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This control is not scored","run_time":1.25e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"This control is not scored","resource_class":"Object","resource_params":"[]","resource_id":"This control is not scored"}]},{"id":"cis-gcp-1.17-iam","title":"[IAM] Ensure Secrets are Not Stored in Cloud Functions Environment Variables by Using Secret Manager","desc":"Google Cloud Functions allow you to host serverless code that is executed when an event is triggered, without the requiring the management a host operating system. These functions can also store environment variables to be used by the code that may contain authentication or other information that needs to remain confidential.","descriptions":[{"label":"default","data":"Google Cloud Functions allow you to host serverless code that is executed when an event is triggered, without the requiring the management a host operating system. These functions can also store environment variables to be used by the code that may contain authentication or other information that needs to remain confidential."},{"label":"rationale","data":"It is recommended to use the Secret Manager, because environment variables are stored unencrypted, and accessible for all users who have access to the code."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/functions/docs/configuring/env-var#managing_secrets","ref":"GCP Docs"},{"url":"https://cloud.google.com/secret-manager/docs/overview","ref":"GCP Docs"}],"tags":{"cis_scored":false,"cis_level":1,"cis_gcp":"1.17","cis_version":"4.0","project":"lab-prod-461912","nist":["SC-28"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n  title \"[#{control_abbrev.upcase}] Ensure Secrets are Not Stored in Cloud Functions Environment Variables by Using Secret Manager\"\n  desc 'Google Cloud Functions allow you to host serverless code that is executed when an event is triggered, without the requiring the management a host operating system. These functions can also store environment variables to be used by the code that may contain authentication or other information that needs to remain confidential.'\n  desc 'rationale', 'It is recommended to use the Secret Manager, because environment variables are stored unencrypted, and accessible for all users who have access to the code.'\n\n  tag cis_scored: false\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['SC-28']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/functions/docs/configuring/env-var#managing_secrets'\n  ref 'GCP Docs', url: 'https://cloud.google.com/secret-manager/docs/overview'\n  describe 'This control is not scored' do\n    skip 'This control is not scored'\n  end\nend\n","source_location":{"line":23,"ref":"./controls/1.17-iam.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This control is not scored","run_time":1.458e-06,"start_time":"2025-06-06T12:19:49+00:00","resource":"","skip_message":"This control is not scored","resource_class":"Object","resource_params":"[]","resource_id":"This control is not scored"}]},{"id":"cis-gcp-2.1-logging","title":"[LOGGING] Ensure That Cloud Audit Logging Is Configured Properly","desc":"It is recommended that Cloud Audit Logging is configured to track all admin activities and read, write access to user data.","descriptions":[{"label":"default","data":"It is recommended that Cloud Audit Logging is configured to track all admin activities and read, write access to user data."},{"label":"rationale","data":"Cloud Audit Logging maintains two audit logs for each project and organization: Admin Activity\nnd Data Access.\n\n1. Admin Activity logs contain log entries for API calls or other administrative actions that modify the configurati\nn or metadata of resources. Admin Activity audit logs are enabled for all services and cannot be configured.\n2. Data Access audit logs record API calls that create, modify, or read user-provided data. These are disabled by de\nault and should be enabled.  There are three kinds of Data Access audit log information:\n   - Admin read: Records operations that read metadata or configuration information. Admin Activity audit logs recor\n writes of metadata and configuration information which cannot be disabled.\n   - Data read: Records operations that read user-provided data.\n   - Data write: Records operations that write user-provided data.\n\nIt is recommended to have effective default audit config configured in such a way that:\n1. logtype is set to DATA_READ (to logs user activity tracking) and DATA_WRITES (to log changes/tampering to user data)\n2. audit config is enabled for all the services supported by Data Access audit logs feature\n3. Logs should be captured for all users. i.e. there are no exempted users in any of the audit config section. This will ensure overriding audit config will not contradict the requirement."}],"impact":0.1,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/logging/docs/audit/","ref":"GCP Docs"},{"url":"https://cloud.google.com/logging/docs/audit/configure-data-access","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"2.1","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-6","AU-12"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'low'\n\n  title \"[#{control_abbrev.upcase}] Ensure That Cloud Audit Logging Is Configured Properly\"\n\n  desc 'It is recommended that Cloud Audit Logging is configured to track all admin activities and read, write access to user data.'\n  desc 'rationale', \"Cloud Audit Logging maintains two audit logs for each project and organization: Admin Activity\nnd Data Access.\n\n1. Admin Activity logs contain log entries for API calls or other administrative actions that modify the configurati\nn or metadata of resources. Admin Activity audit logs are enabled for all services and cannot be configured.\n2. Data Access audit logs record API calls that create, modify, or read user-provided data. These are disabled by de\nault and should be enabled.  There are three kinds of Data Access audit log information:\n   - Admin read: Records operations that read metadata or configuration information. Admin Activity audit logs recor\n writes of metadata and configuration information which cannot be disabled.\n   - Data read: Records operations that read user-provided data.\n   - Data write: Records operations that write user-provided data.\n\nIt is recommended to have effective default audit config configured in such a way that:\n1. logtype is set to DATA_READ (to logs user activity tracking) and DATA_WRITES (to log changes/tampering to user data)\n2. audit config is enabled for all the services supported by Data Access audit logs feature\n3. Logs should be captured for all users. i.e. there are no exempted users in any of the audit config section. This will ensure overriding audit config will not contradict the requirement.\"\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[AU-6 AU-12]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/audit/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/audit/configure-data-access'\n\n  describe google_project_logging_audit_config(project: gcp_project_id) do\n    its('default_types') { should include 'DATA_READ' }\n    its('default_types') { should include 'DATA_WRITE' }\n    it { should_not have_default_exempted_members }\n  end\nend\n","source_location":{"line":23,"ref":"./controls/2.01-logging.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Logging Audit Config For lab-prod-461912 is expected not to have default exempted members","run_time":0.00584623,"start_time":"2025-06-06T12:19:49+00:00","resource_class":"google_project_logging_audit_config","resource_params":"[{:project=>\"lab-prod-461912\"}]","resource_id":""},{"status":"failed","code_desc":"Logging Audit Config For lab-prod-461912 default_types is expected to include \"DATA_READ\"","run_time":9.2207e-05,"start_time":"2025-06-06T12:19:49+00:00","message":"expected [] to include \"DATA_READ\"","resource_class":"google_project_logging_audit_config","resource_params":"[{:project=>\"lab-prod-461912\"}]","resource_id":""},{"status":"failed","code_desc":"Logging Audit Config For lab-prod-461912 default_types is expected to include \"DATA_WRITE\"","run_time":6.2166e-05,"start_time":"2025-06-06T12:19:49+00:00","message":"expected [] to include \"DATA_WRITE\"","resource_class":"google_project_logging_audit_config","resource_params":"[{:project=>\"lab-prod-461912\"}]","resource_id":""}]},{"id":"cis-gcp-2.2-logging","title":"[LOGGING] Ensure that sinks are configured for all Log entries","desc":"It is recommended to create a sink that will export copies of all the log entries. This can help aggregate logs from multiple projects and export them to a Security Information and Event Management (SIEM).","descriptions":[{"label":"default","data":"It is recommended to create a sink that will export copies of all the log entries. This can help aggregate logs from multiple projects and export them to a Security Information and Event Management (SIEM)."},{"label":"rationale","data":"Log entries are held in Cloud Logging. To aggregate logs, export them to a SIEM. To keep them longer, it is recommended to set up a log sink. Exporting involves writing a filter that selects the log entries to export, and choosing a destination in Cloud Storage, BigQuery, or Cloud Pub/Sub. The filter and destination are held in an object called a sink. To ensure all log entries are exported to sinks, ensure that there is no filter configured for a sink. Sinks can be created in projects, organizations, folders, and billing accounts."}],"impact":0.1,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/logging/docs/reference/tools/gcloud-logging","ref":"GCP Docs"},{"url":"https://cloud.google.com/logging/quotas","ref":"GCP Docs"},{"url":"https://cloud.google.com/logging/docs/export/","ref":"GCP Docs"},{"url":"https://cloud.google.com/logging/docs/export/using_exported_logs","ref":"GCP Docs"},{"url":"https://cloud.google.com/logging/docs/export/configure_export_v2","ref":"GCP Docs"},{"url":"https://cloud.google.com/logging/docs/export/aggregated_exports","ref":"GCP Docs"},{"url":"https://cloud.google.com/sdk/gcloud/reference/beta/logging/sinks/list","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"2.2","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-4","AU-12"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'low'\n\n  title \"[#{control_abbrev.upcase}] Ensure that sinks are configured for all Log entries\"\n\n  desc 'It is recommended to create a sink that will export copies of all the log entries. This can help aggregate logs from multiple projects and export them to a Security Information and Event Management (SIEM).'\n  desc 'rationale', 'Log entries are held in Cloud Logging. To aggregate logs, export them to a SIEM. To keep them longer, it is recommended to set up a log sink. Exporting involves writing a filter that selects the log entries to export, and choosing a destination in Cloud Storage, BigQuery, or Cloud Pub/Sub. The filter and destination are held in an object called a sink. To ensure all log entries are exported to sinks, ensure that there is no filter configured for a sink. Sinks can be created in projects, organizations, folders, and billing accounts.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[AU-4 AU-12]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/reference/tools/gcloud-logging'\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/quotas'\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/export/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/export/using_exported_logs'\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/export/configure_export_v2'\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/export/aggregated_exports'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sdk/gcloud/reference/beta/logging/sinks/list'\n\n  empty_filter_sinks = []\n  google_logging_project_sinks(project: gcp_project_id).names.each do |sink_name|\n    empty_filter_sinks.push(sink_name) if google_logging_project_sink(project: gcp_project_id,\n                                                                      name: sink_name).filter.nil?\n  end\n  describe \"[#{gcp_project_id}] Project level Log sink with an empty filter\" do\n    subject { empty_filter_sinks }\n    it 'is expected to exist' do\n      expect(empty_filter_sinks.count).to be_positive\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/2.02-logging.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"[lab-prod-461912] Project level Log sink with an empty filter is expected to exist","run_time":0.002765595,"start_time":"2025-06-06T12:19:49+00:00","message":"expected `0.positive?` to be truthy, got false","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] Project level Log sink with an empty filter"}]},{"id":"cis-gcp-2.3-logging","title":"[LOGGING] Ensure That Retention Policies on Cloud Storage Buckets Used for Exporting Logs Are Configured Using Bucket Lock","desc":"Enabling retention policies on log buckets will protect logs stored in cloud storage buckets from being overwritten or accidentally deleted. It is recommended to set up retention policies and configure Bucket Lock on all storage buckets that are used as log sinks.","descriptions":[{"label":"default","data":"Enabling retention policies on log buckets will protect logs stored in cloud storage buckets from being overwritten or accidentally deleted. It is recommended to set up retention policies and configure Bucket Lock on all storage buckets that are used as log sinks."},{"label":"rationale","data":"Logs can be exported by creating one or more sinks that include a log filter and a destination. As Cloud Logging receives new log entries, they are compared against each sink. If a log entry matches a sink's filter, then a copy of the log entry is written to the destination.\n\n  Sinks can be configured to export logs in storage buckets. It is recommended to configure a data retention policy for these cloud storage buckets and to lock the data retention policy; thus permanently preventing the policy from being reduced or removed. This way, if the system is ever compromised by an attacker or a malicious insider who wants to cover their tracks, the activity logs are definitely preserved for forensics and security investigations."}],"impact":0.1,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/storage/docs/bucket-lock","ref":"GCP Docs"},{"url":"https://cloud.google.com/storage/docs/using-bucket-lock","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"2.3","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-6"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'low'\n\n  title \"[#{control_abbrev.upcase}] Ensure That Retention Policies on Cloud Storage Buckets Used for Exporting Logs Are Configured Using Bucket Lock\"\n\n  desc 'Enabling retention policies on log buckets will protect logs stored in cloud storage buckets from being overwritten or accidentally deleted. It is recommended to set up retention policies and configure Bucket Lock on all storage buckets that are used as log sinks.'\n  desc 'rationale', \"Logs can be exported by creating one or more sinks that include a log filter and a destination. As Cloud Logging receives new log entries, they are compared against each sink. If a log entry matches a sink's filter, then a copy of the log entry is written to the destination.\n\n  Sinks can be configured to export logs in storage buckets. It is recommended to configure a data retention policy for these cloud storage buckets and to lock the data retention policy; thus permanently preventing the policy from being reduced or removed. This way, if the system is ever compromised by an attacker or a malicious insider who wants to cover their tracks, the activity logs are definitely preserved for forensics and security investigations.\"\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AU-6']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/storage/docs/bucket-lock'\n  ref 'GCP Docs', url: 'https://cloud.google.com/storage/docs/using-bucket-lock'\n\n  if google_logging_project_sinks(project: gcp_project_id).where(destination: /storage.googleapis.com/).destinations.empty?\n    describe \"[#{gcp_project_id}] does not have logging sinks configured.\" do\n      subject { google_logging_project_sinks(project: gcp_project_id).where(destination: /storage.googleapis.com/).destinations }\n      it { should_not be_empty }\n    end\n  else\n    google_logging_project_sinks(project: gcp_project_id).where(destination: /storage.googleapis.com/).destinations.each do |sink|\n      bucket = sink.split('/').last\n      describe \"[#{gcp_project_id}] Logging bucket #{bucket} retention policy Bucket Lock status\" do\n        subject { google_storage_bucket(name: bucket).retention_policy }\n        its('is_locked') { should be true }\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/2.03-logging.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"[lab-prod-461912] does not have logging sinks configured. is expected not to be empty","run_time":0.37972912,"start_time":"2025-06-06T12:19:49+00:00","message":"expected `[].empty?` to be falsey, got true","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have logging sinks configured."}]},{"id":"cis-gcp-2.4-logging","title":"[LOGGING] Ensure Log Metric Filter and Alerts Exist for Project Ownership Assignments/Changes","desc":"In order to prevent unnecessary project ownership assignments to users/service-accounts and further misuses of projects and resources, all roles/Owner assignments should be monitored.\n\n  Members (users/Service-Accounts) with role assignment to primitive role roles/owner are Project Owners.\n\n  Project Owner has all the privileges on a project it belongs to. These can be summarized as below:\n\n  - All viewer permissions on All GCP Services part within the project\n  - Permissions for actions that modify state of All GCP Services within the\n  project\n  - Manage roles and permissions for a project and all resources within the\n  project\n  - Set up billing for a project\n\n  Granting owner role to a member (user/Service-Account) will allow members to modify the IAM policy. Therefore grant the owner role only if the member has a legitimate purpose to manage the IAM policy. This is because as project IAM policy contains sensitive access control data and having a minimal set of users manage it will simplify any auditing that you may have to do.","descriptions":[{"label":"default","data":"In order to prevent unnecessary project ownership assignments to users/service-accounts and further misuses of projects and resources, all roles/Owner assignments should be monitored.\n\n  Members (users/Service-Accounts) with role assignment to primitive role roles/owner are Project Owners.\n\n  Project Owner has all the privileges on a project it belongs to. These can be summarized as below:\n\n  - All viewer permissions on All GCP Services part within the project\n  - Permissions for actions that modify state of All GCP Services within the\n  project\n  - Manage roles and permissions for a project and all resources within the\n  project\n  - Set up billing for a project\n\n  Granting owner role to a member (user/Service-Account) will allow members to modify the IAM policy. Therefore grant the owner role only if the member has a legitimate purpose to manage the IAM policy. This is because as project IAM policy contains sensitive access control data and having a minimal set of users manage it will simplify any auditing that you may have to do."},{"label":"rationale","data":"Project Ownership Having highest level of privileges on a project, to avoid misuse of project resources project ownership assignment/change actions mentioned should be monitored and alerted to concerned recipients.\n\n- Sending project ownership Invites\n- Acceptance/Rejection of project ownership invite by user\n- Adding `roleowner` to a user/service-account\n- Removing a user/Service account from `roleowner`"}],"impact":0.1,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/logging/docs/logs-based-metrics/","ref":"GCP Docs"},{"url":"https://cloud.google.com/monitoring/custom-metrics/","ref":"GCP Docs"},{"url":"https://cloud.google.com/monitoring/alerts/","ref":"GCP Docs"},{"url":"https://cloud.google.com/logging/docs/reference/tools/gcloud-logging","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"2.4","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-12"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'low'\n\n  title \"[#{control_abbrev.upcase}] Ensure Log Metric Filter and Alerts Exist for Project Ownership Assignments/Changes\"\n\n  desc \"In order to prevent unnecessary project ownership assignments to users/service-accounts and further misuses of projects and resources, all roles/Owner assignments should be monitored.\n\n  Members (users/Service-Accounts) with role assignment to primitive role roles/owner are Project Owners.\n\n  Project Owner has all the privileges on a project it belongs to. These can be summarized as below:\n\n  - All viewer permissions on All GCP Services part within the project\n  - Permissions for actions that modify state of All GCP Services within the\n  project\n  - Manage roles and permissions for a project and all resources within the\n  project\n  - Set up billing for a project\n\n  Granting owner role to a member (user/Service-Account) will allow members to modify the IAM policy. Therefore grant the owner role only if the member has a legitimate purpose to manage the IAM policy. This is because as project IAM policy contains sensitive access control data and having a minimal set of users manage it will simplify any auditing that you may have to do.\"\n  desc 'rationale', \"Project Ownership Having highest level of privileges on a project, to avoid misuse of project resources project ownership assignment/change actions mentioned should be monitored and alerted to concerned recipients.\n\n- Sending project ownership Invites\n- Acceptance/Rejection of project ownership invite by user\n- Adding `role\\owner` to a user/service-account\n- Removing a user/Service account from `role\\owner`\"\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AU-12']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/logs-based-metrics/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/monitoring/custom-metrics/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/monitoring/alerts/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/reference/tools/gcloud-logging'\n\n  log_filter = 'resource.type=audited_resource AND (protoPayload.serviceName=\"cloudresourcemanager.googleapis.com\") AND (ProjectOwnership OR projectOwnerInvitee) OR (protoPayload.serviceData.policyDelta.bindingDeltas.action=\"REMOVE\" AND protoPayload.serviceData.policyDelta.bindingDeltas.role=\"roles/owner\") OR (protoPayload.serviceData.policyDelta.bindingDeltas.action=\"ADD\" AND protoPayload.serviceData.policyDelta.bindingDeltas.role=\"roles/owner\")'\n  describe \"[#{gcp_project_id}] Project Ownership changes filter\" do\n    subject { google_project_metrics(project: gcp_project_id).where(metric_filter: log_filter) }\n    it { should exist }\n  end\n\n  google_project_metrics(project: gcp_project_id).where(metric_filter: log_filter).metric_types.each do |metrictype|\n    describe.one do\n      filter = \"metric.type=\\\"#{metrictype}\\\" resource.type=\\\"audited_resource\\\"\"\n      google_project_alert_policies(project: gcp_project_id).where(policy_enabled_state: true).policy_names.each do |policy|\n        condition = google_project_alert_policy_condition(policy: policy, filter: filter)\n        describe \"[#{gcp_project_id}] Project Ownership changes alert policy\" do\n          subject { condition }\n          it { should exist }\n        end\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/2.04-logging.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"[lab-prod-461912] Project Ownership changes filter is expected to exist","run_time":0.289117878,"start_time":"2025-06-06T12:19:49+00:00","message":"expected google_project_metrics with metric_filter == \"resource.type=audited_resource AND (protoPayload.servic...gDeltas.action=\\\"ADD\\\" AND protoPayload.serviceData.policyDelta.bindingDeltas.role=\\\"roles/owner\\\")\" to exist","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] Project Ownership changes filter"}]},{"id":"cis-gcp-2.5-logging","title":"[LOGGING] Ensure That the Log Metric Filter and Alerts Exist for Audit Configuration Changes","desc":"Google Cloud Platform (GCP) services write audit log entries to the Admin Activity and Data Access logs to help answer the questions of, 'who did what, where, and when?' within GCP projects.\n\n  Cloud audit logging records information includes the identity of the API caller, the time of the API call, the source IP address of the API caller, the request parameters, and the response elements returned by GCP services. Cloud audit logging provides a history of GCP API calls for an account, including API calls made via the console, SDKs, command-line tools, and other GCP services.","descriptions":[{"label":"default","data":"Google Cloud Platform (GCP) services write audit log entries to the Admin Activity and Data Access logs to help answer the questions of, 'who did what, where, and when?' within GCP projects.\n\n  Cloud audit logging records information includes the identity of the API caller, the time of the API call, the source IP address of the API caller, the request parameters, and the response elements returned by GCP services. Cloud audit logging provides a history of GCP API calls for an account, including API calls made via the console, SDKs, command-line tools, and other GCP services."},{"label":"rationale","data":"Admin activity and data access logs produced by cloud audit logging enable security analysis, resource change tracking, and compliance auditing.\n\n  Configuring the metric filter and alerts for audit configuration changes ensures the recommended state of audit configuration is maintained so that all activities in the project are audit-able at any point in time."}],"impact":0.1,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/logging/docs/logs-based-metrics/","ref":"GCP Docs"},{"url":"https://cloud.google.com/monitoring/custom-metrics/","ref":"GCP Docs"},{"url":"https://cloud.google.com/monitoring/alerts/","ref":"GCP Docs"},{"url":"https://cloud.google.com/logging/docs/reference/tools/gcloud-logging","ref":"GCP Docs"},{"url":"https://cloud.google.com/logging/docs/audit/configure-data-access#getiampolicy-setiampolicy","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"2.5","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-3","AU-12"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'low'\n\n  title \"[#{control_abbrev.upcase}] Ensure That the Log Metric Filter and Alerts Exist for Audit Configuration Changes\"\n\n  desc \"Google Cloud Platform (GCP) services write audit log entries to the Admin Activity and Data Access logs to help answer the questions of, 'who did what, where, and when?' within GCP projects.\n\n  Cloud audit logging records information includes the identity of the API caller, the time of the API call, the source IP address of the API caller, the request parameters, and the response elements returned by GCP services. Cloud audit logging provides a history of GCP API calls for an account, including API calls made via the console, SDKs, command-line tools, and other GCP services.\"\n  desc 'rationale', 'Admin activity and data access logs produced by cloud audit logging enable security analysis, resource change tracking, and compliance auditing.\n\n  Configuring the metric filter and alerts for audit configuration changes ensures the recommended state of audit configuration is maintained so that all activities in the project are audit-able at any point in time.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[AU-3 AU-12]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/logs-based-metrics/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/monitoring/custom-metrics/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/monitoring/alerts/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/reference/tools/gcloud-logging'\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/audit/configure-data-access#getiampolicy-setiampolicy'\n\n  log_filter = 'resource.type=audited_resource AND protoPayload.methodName=\"SetIamPolicy\" AND protoPayload.serviceData.policyDelta.auditConfigDeltas:*'\n  describe \"[#{gcp_project_id}] Audit configuration changes filter\" do\n    subject { google_project_metrics(project: gcp_project_id).where(metric_filter: log_filter) }\n    it { should exist }\n  end\n\n  google_project_metrics(project: gcp_project_id).where(metric_filter: log_filter).metric_types.each do |metrictype|\n    describe.one do\n      filter = \"metric.type=\\\"#{metrictype}\\\" resource.type=\\\"audited_resource\\\"\"\n      google_project_alert_policies(project: gcp_project_id).where(policy_enabled_state: true).policy_names.each do |policy|\n        condition = google_project_alert_policy_condition(policy: policy, filter: filter)\n        describe \"[#{gcp_project_id}] Audit configuration changes alert policy\" do\n          subject { condition }\n          it { should exist }\n        end\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/2.05-logging.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"[lab-prod-461912] Audit configuration changes filter is expected to exist","run_time":0.313211454,"start_time":"2025-06-06T12:19:49+00:00","message":"expected google_project_metrics with metric_filter == \"resource.type=audited_resource AND protoPayload.methodName=\\\"SetIamPolicy\\\" AND protoPayload.serviceData.policyDelta.auditConfigDeltas:*\" to exist","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] Audit configuration changes filter"}]},{"id":"cis-gcp-2.6-logging","title":"[LOGGING] Ensure log metric filter and alerts exists for Custom Role changes","desc":"It is recommended that a metric filter and alarm be established for changes to Identity and Access Management (IAM) role creation, deletion and updating activities.","descriptions":[{"label":"default","data":"It is recommended that a metric filter and alarm be established for changes to Identity and Access Management (IAM) role creation, deletion and updating activities."},{"label":"rationale","data":"Google Cloud IAM provides predefined roles that give granular access to specific Google Cloud Platform resources and prevent unwanted access to other resources. However, to cater to organization-specific needs, Cloud IAM also provides the ability to create custom roles. Project owners and administrators with the Organization Role Administrator role or the IAM Role Administrator role can create custom roles. Monitoring role creation, deletion and updating activities will help in identifying any over-privileged role at early stages."}],"impact":0.1,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/logging/docs/logs-based-metrics/","ref":"GCP Docs"},{"url":"https://cloud.google.com/monitoring/custom-metrics/","ref":"GCP Docs"},{"url":"https://cloud.google.com/monitoring/alerts/","ref":"GCP Docs"},{"url":"https://cloud.google.com/logging/docs/reference/tools/gcloud-logging","ref":"GCP Docs"},{"url":"https://cloud.google.com/iam/docs/understanding-custom-roles","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"2.6","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-3","AU-12"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'low'\n\n  title \"[#{control_abbrev.upcase}] Ensure log metric filter and alerts exists for Custom Role changes\"\n\n  desc 'It is recommended that a metric filter and alarm be established for changes to Identity and Access Management (IAM) role creation, deletion and updating activities.'\n  desc 'rationale', 'Google Cloud IAM provides predefined roles that give granular access to specific Google Cloud Platform resources and prevent unwanted access to other resources. However, to cater to organization-specific needs, Cloud IAM also provides the ability to create custom roles. Project owners and administrators with the Organization Role Administrator role or the IAM Role Administrator role can create custom roles. Monitoring role creation, deletion and updating activities will help in identifying any over-privileged role at early stages.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[AU-3 AU-12]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/logs-based-metrics/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/monitoring/custom-metrics/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/monitoring/alerts/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/reference/tools/gcloud-logging'\n  ref 'GCP Docs', url: 'https://cloud.google.com/iam/docs/understanding-custom-roles'\n\n  log_filter = 'resource.type=audited_resource AND protoPayload.methodName=\"google.iam.admin.v1.CreateRole\" OR protoPayload.methodName=\"google.iam.admin.v1.DeleteRole\" OR protoPayload.methodName=\"google.iam.admin.v1.UpdateRole\"'\n  describe \"[#{gcp_project_id}] Custom Role changes filter\" do\n    subject { google_project_metrics(project: gcp_project_id).where(metric_filter: log_filter) }\n    it { should exist }\n  end\n\n  google_project_metrics(project: gcp_project_id).where(metric_filter: log_filter).metric_types.each do |metrictype|\n    describe.one do\n      filter = \"metric.type=\\\"#{metrictype}\\\" resource.type=\\\"audited_resource\\\"\"\n      google_project_alert_policies(project: gcp_project_id).where(policy_enabled_state: true).policy_names.each do |policy|\n        condition = google_project_alert_policy_condition(policy: policy, filter: filter)\n        describe \"[#{gcp_project_id}] Custom Role changes alert policy\" do\n          subject { condition }\n          it { should exist }\n        end\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/2.06-logging.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"[lab-prod-461912] Custom Role changes filter is expected to exist","run_time":0.28632049,"start_time":"2025-06-06T12:19:50+00:00","message":"expected google_project_metrics with metric_filter == \"resource.type=audited_resource AND protoPayload.methodN...me=\\\"google.iam.admin.v1.DeleteRole\\\" OR protoPayload.methodName=\\\"google.iam.admin.v1.UpdateRole\\\"\" to exist","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] Custom Role changes filter"}]},{"id":"cis-gcp-2.7-logging","title":"[LOGGING] Ensure That the Log Metric Filter and Alerts Exist for VPC Network Firewall Rule Changes","desc":"It is recommended that a metric filter and alarm be established for Virtual Private Cloud (VPC) Network Firewall rule changes.","descriptions":[{"label":"default","data":"It is recommended that a metric filter and alarm be established for Virtual Private Cloud (VPC) Network Firewall rule changes."},{"label":"rationale","data":"Monitoring for Create or Update Firewall rule events gives insight to network access changes and may reduce the time it takes to detect suspicious activity."}],"impact":0.1,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/logging/docs/logs-based-metrics/","ref":"GCP Docs"},{"url":"https://cloud.google.com/monitoring/custom-metrics/","ref":"GCP Docs"},{"url":"https://cloud.google.com/monitoring/alerts/","ref":"GCP Docs"},{"url":"https://cloud.google.com/logging/docs/reference/tools/gcloud-logging","ref":"GCP Docs"},{"url":"https://cloud.google.com/vpc/docs/firewalls","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"2.7","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-3","AU-12"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'low'\n\n  title \"[#{control_abbrev.upcase}] Ensure That the Log Metric Filter and Alerts Exist for VPC Network Firewall Rule Changes\"\n\n  desc 'It is recommended that a metric filter and alarm be established for Virtual Private Cloud (VPC) Network Firewall rule changes.'\n  desc 'rationale', 'Monitoring for Create or Update Firewall rule events gives insight to network access changes and may reduce the time it takes to detect suspicious activity.'\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[AU-3 AU-12]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/logs-based-metrics/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/monitoring/custom-metrics/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/monitoring/alerts/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/reference/tools/gcloud-logging'\n  ref 'GCP Docs', url: 'https://cloud.google.com/vpc/docs/firewalls'\n\n  log_filter = 'resource.type=global AND jsonPayload.event_subtype=\"compute.firewalls.patch\" OR jsonPayload.event_subtype=\"compute.firewalls.insert\"'\n  describe \"[#{gcp_project_id}] VPC FW Rule changes filter\" do\n    subject { google_project_metrics(project: gcp_project_id).where(metric_filter: log_filter) }\n    it { should exist }\n  end\n\n  google_project_metrics(project: gcp_project_id).where(metric_filter: log_filter).metric_types.each do |metrictype|\n    describe.one do\n      filter = \"metric.type=\\\"#{metrictype}\\\" resource.type=\\\"global\\\"\"\n      google_project_alert_policies(project: gcp_project_id).where(policy_enabled_state: true).policy_names.each do |policy|\n        condition = google_project_alert_policy_condition(policy: policy, filter: filter)\n        describe \"[#{gcp_project_id}] VPC FW Rule changes alert policy\" do\n          subject { condition }\n          it { should exist }\n        end\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/2.07-logging.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"[lab-prod-461912] VPC FW Rule changes filter is expected to exist","run_time":0.320746415,"start_time":"2025-06-06T12:19:50+00:00","message":"expected google_project_metrics with metric_filter == \"resource.type=global AND jsonPayload.event_subtype=\\\"compute.firewalls.patch\\\" OR jsonPayload.event_subtype=\\\"compute.firewalls.insert\\\"\" to exist","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] VPC FW Rule changes filter"}]},{"id":"cis-gcp-2.8-logging","title":"[LOGGING] Ensure That the Log Metric Filter and Alerts Exist for VPC Network Route Changes","desc":"It is recommended that a metric filter and alarm be established for Virtual Private Cloud (VPC) network route changes.","descriptions":[{"label":"default","data":"It is recommended that a metric filter and alarm be established for Virtual Private Cloud (VPC) network route changes."},{"label":"rationale","data":"Google Cloud Platform (GCP) routes define the paths network traffic takes from a VM instance to another destination. The other destination can be inside the organization VPC network (such as another VM) or outside of it. Every route consists of a destination and a next hop. Traffic whose destination IP is within the destination range is sent to the next hop for delivery.\n\n  Monitoring changes to route tables will help ensure that all VPC traffic flows through an expected path."}],"impact":0.1,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/logging/docs/logs-based-metrics/","ref":"GCP Docs"},{"url":"https://cloud.google.com/monitoring/custom-metrics/","ref":"GCP Docs"},{"url":"https://cloud.google.com/monitoring/alerts/","ref":"GCP Docs"},{"url":"https://cloud.google.com/logging/docs/reference/tools/gcloud-logging","ref":"GCP Docs"},{"url":"https://cloud.google.com/storage/docs/access-control/iam","ref":"GCP Docs"},{"url":"https://cloud.google.com/sdk/gcloud/reference/beta/logging/metrics/create","ref":"GCP Docs"},{"url":"https://cloud.google.com/sdk/gcloud/reference/alpha/monitoring/policies/create","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"2.8","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-3","AU-12"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'low'\n\n  title \"[#{control_abbrev.upcase}] Ensure That the Log Metric Filter and Alerts Exist for VPC Network Route Changes\"\n\n  desc 'It is recommended that a metric filter and alarm be established for Virtual Private Cloud (VPC) network route changes.'\n  desc 'rationale', \"Google Cloud Platform (GCP) routes define the paths network traffic takes from a VM instance to another destination. The other destination can be inside the organization VPC network (such as another VM) or outside of it. Every route consists of a destination and a next hop. Traffic whose destination IP is within the destination range is sent to the next hop for delivery.\n\n  Monitoring changes to route tables will help ensure that all VPC traffic flows through an expected path.\"\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[AU-3 AU-12]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/logs-based-metrics/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/monitoring/custom-metrics/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/monitoring/alerts/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/reference/tools/gcloud-logging'\n  ref 'GCP Docs', url: 'https://cloud.google.com/storage/docs/access-control/iam'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sdk/gcloud/reference/beta/logging/metrics/create'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sdk/gcloud/reference/alpha/monitoring/policies/create'\n\n  log_filter = 'resource.type=global AND jsonPayload.event_subtype=\"compute.routes.delete\" OR jsonPayload.event_subtype=\"compute.routes.insert\"'\n  describe \"[#{gcp_project_id}] VPC Route changes filter\" do\n    subject { google_project_metrics(project: gcp_project_id).where(metric_filter: log_filter) }\n    it { should exist }\n  end\n\n  google_project_metrics(project: gcp_project_id).where(metric_filter: log_filter).metric_types.each do |metrictype|\n    describe.one do\n      filter = \"metric.type=\\\"#{metrictype}\\\" resource.type=\\\"global\\\"\"\n      google_project_alert_policies(project: gcp_project_id).where(policy_enabled_state: true).policy_names.each do |policy|\n        condition = google_project_alert_policy_condition(policy: policy, filter: filter)\n        describe \"[#{gcp_project_id}] VPC Route changes alert policy\" do\n          subject { condition }\n          it { should exist }\n        end\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/2.08-logging.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"[lab-prod-461912] VPC Route changes filter is expected to exist","run_time":0.331836714,"start_time":"2025-06-06T12:19:50+00:00","message":"expected google_project_metrics with metric_filter == \"resource.type=global AND jsonPayload.event_subtype=\\\"compute.routes.delete\\\" OR jsonPayload.event_subtype=\\\"compute.routes.insert\\\"\" to exist","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] VPC Route changes filter"}]},{"id":"cis-gcp-2.9-logging","title":"[LOGGING] Ensure That the Log Metric Filter and Alerts Exist for VPC Network Changes","desc":"It is recommended that a metric filter and alarm be established for Virtual Private Cloud (VPC) network changes.","descriptions":[{"label":"default","data":"It is recommended that a metric filter and alarm be established for Virtual Private Cloud (VPC) network changes."},{"label":"rationale","data":"It is possible to have more than one VPC within a project. In addition, it is also possible to create a peer connection between two VPCs enabling network traffic to route between VPCs.\n\n  Monitoring changes to a VPC will help ensure VPC traffic flow is not getting impacted."}],"impact":0.1,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/logging/docs/logs-based-metrics/","ref":"GCP Docs"},{"url":"https://cloud.google.com/monitoring/custom-metrics/","ref":"GCP Docs"},{"url":"https://cloud.google.com/monitoring/alerts/","ref":"GCP Docs"},{"url":"https://cloud.google.com/logging/docs/reference/tools/gcloud-logging","ref":"GCP Docs"},{"url":"https://cloud.google.com/vpc/docs/overview","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"2.9","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-3","AU-12"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'low'\n\n  title \"[#{control_abbrev.upcase}] Ensure That the Log Metric Filter and Alerts Exist for VPC Network Changes\"\n\n  desc 'It is recommended that a metric filter and alarm be established for Virtual Private Cloud (VPC) network changes.'\n  desc 'rationale', \"It is possible to have more than one VPC within a project. In addition, it is also possible to create a peer connection between two VPCs enabling network traffic to route between VPCs.\n\n  Monitoring changes to a VPC will help ensure VPC traffic flow is not getting impacted.\"\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[AU-3 AU-12]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/logs-based-metrics/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/monitoring/custom-metrics/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/monitoring/alerts/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/reference/tools/gcloud-logging'\n  ref 'GCP Docs', url: 'https://cloud.google.com/vpc/docs/overview'\n\n  log_filter = 'resource.type=audited_resource AND jsonPayload.event_subtype=\"compute.networks.insert\" OR jsonPayload.event_subtype=\"compute.networks.patch\" OR jsonPayload.event_subtype=\"compute.networks.delete\" OR jsonPayload.event_subtype=\"compute.networks.removePeering\" OR jsonPayload.event_subtype=\"compute.networks.addPeering\"'\n  describe \"[#{gcp_project_id}] VPC Network changes filter\" do\n    subject { google_project_metrics(project: gcp_project_id).where(metric_filter: log_filter) }\n    it { should exist }\n  end\n\n  google_project_metrics(project: gcp_project_id).where(metric_filter: log_filter).metric_types.each do |metrictype|\n    describe.one do\n      filter = \"metric.type=\\\"#{metrictype}\\\" resource.type=\\\"audited_resource\\\"\"\n      google_project_alert_policies(project: gcp_project_id).where(policy_enabled_state: true).policy_names.each do |policy|\n        condition = google_project_alert_policy_condition(policy: policy, filter: filter)\n        describe \"[#{gcp_project_id}] VPC Network changes alert policy\" do\n          subject { condition }\n          it { should exist }\n        end\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/2.09-logging.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"[lab-prod-461912] VPC Network changes filter is expected to exist","run_time":0.336532872,"start_time":"2025-06-06T12:19:51+00:00","message":"expected google_project_metrics with metric_filter == \"resource.type=audited_resource AND jsonPayload.event_su...ype=\\\"compute.networks.removePeering\\\" OR jsonPayload.event_subtype=\\\"compute.networks.addPeering\\\"\" to exist","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] VPC Network changes filter"}]},{"id":"cis-gcp-2.10-logging","title":"[LOGGING] Ensure That the Log Metric Filter and Alerts Exist for Cloud Storage IAM Permission Changes","desc":"It is recommended that a metric filter and alarm be established for Cloud Storage Bucket IAM changes.","descriptions":[{"label":"default","data":"It is recommended that a metric filter and alarm be established for Cloud Storage Bucket IAM changes."},{"label":"rationale","data":"Monitoring changes to cloud storage bucket permissions may reduce the time needed to detect and correct permissions on sensitive cloud storage buckets and objects inside the bucket."}],"impact":0.1,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/logging/docs/logs-based-metrics/","ref":"GCP Docs"},{"url":"https://cloud.google.com/monitoring/custom-metrics/","ref":"GCP Docs"},{"url":"https://cloud.google.com/monitoring/alerts/","ref":"GCP Docs"},{"url":"https://cloud.google.com/logging/docs/reference/tools/gcloud-logging","ref":"GCP Docs"},{"url":"https://cloud.google.com/storage/docs/overview","ref":"GCP Docs"},{"url":"https://cloud.google.com/storage/docs/access-control/iam-roles","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"2.10","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-3","AU-12"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'low'\n\n  title \"[#{control_abbrev.upcase}] Ensure That the Log Metric Filter and Alerts Exist for Cloud Storage IAM Permission Changes\"\n\n  desc 'It is recommended that a metric filter and alarm be established for Cloud Storage Bucket IAM changes.'\n  desc 'rationale', 'Monitoring changes to cloud storage bucket permissions may reduce the time needed to detect and correct permissions on sensitive cloud storage buckets and objects inside the bucket.'\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[AU-3 AU-12]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/logs-based-metrics/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/monitoring/custom-metrics/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/monitoring/alerts/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/reference/tools/gcloud-logging'\n  ref 'GCP Docs', url: 'https://cloud.google.com/storage/docs/overview'\n  ref 'GCP Docs', url: 'https://cloud.google.com/storage/docs/access-control/iam-roles'\n\n  log_filter = 'resource.type=gcs_bucket AND protoPayload.methodName=\"storage.setIamPermissions\"'\n  describe \"[#{gcp_project_id}] Cloud Storage changes filter\" do\n    subject { google_project_metrics(project: gcp_project_id).where(metric_filter: log_filter) }\n    it { should exist }\n  end\n\n  google_project_metrics(project: gcp_project_id).where(metric_filter: log_filter).metric_types.each do |metrictype|\n    describe.one do\n      filter = \"metric.type=\\\"#{metrictype}\\\" resource.type=\\\"gcs_bucket\\\"\"\n      google_project_alert_policies(project: gcp_project_id).where(policy_enabled_state: true).policy_names.each do |policy|\n        condition = google_project_alert_policy_condition(policy: policy, filter: filter)\n        describe \"[#{gcp_project_id}] Cloud Storage changes alert policy\" do\n          subject { condition }\n          it { should exist }\n        end\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/2.10-logging.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"[lab-prod-461912] Cloud Storage changes filter is expected to exist","run_time":0.485148246,"start_time":"2025-06-06T12:19:51+00:00","message":"expected google_project_metrics with metric_filter == \"resource.type=gcs_bucket AND protoPayload.methodName=\\\"storage.setIamPermissions\\\"\" to exist","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] Cloud Storage changes filter"}]},{"id":"cis-gcp-2.11-logging","title":"[LOGGING] Ensure log metric filter and alerts exists for SQL instance configuration changes","desc":"It is recommended that a metric filter and alarm be established for SQL instance configuration changes.","descriptions":[{"label":"default","data":"It is recommended that a metric filter and alarm be established for SQL instance configuration changes."},{"label":"rationale","data":"Monitoring changes to SQL instance configuration changes may reduce the time needed to detect and correct misconfigurations done on the SQL server.\n  Below are a few of the configurable options which may the impact security posture of an SQL instance:\n  - Enable auto backups and high availability: Misconfiguration may adversely impact business continuity, disaster recovery, and high availability\n  - Authorize networks: Misconfiguration may increase exposure to untrusted networks"}],"impact":0.1,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/logging/docs/logs-based-metrics/","ref":"GCP Docs"},{"url":"https://cloud.google.com/monitoring/custom-metrics/","ref":"GCP Docs"},{"url":"https://cloud.google.com/monitoring/alerts/","ref":"GCP Docs"},{"url":"https://cloud.google.com/logging/docs/reference/tools/gcloud-logging","ref":"GCP Docs"},{"url":"https://cloud.google.com/storage/docs/overview","ref":"GCP Docs"},{"url":"https://cloud.google.com/sql/docs/","ref":"GCP Docs"},{"url":"https://cloud.google.com/sql/docs/mysql/","ref":"GCP Docs"},{"url":"https://cloud.google.com/sql/docs/postgres/","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"2.11","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-3","AU-12"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'low'\n\n  title \"[#{control_abbrev.upcase}] Ensure log metric filter and alerts exists for SQL instance configuration changes\"\n\n  desc 'It is recommended that a metric filter and alarm be established for SQL instance configuration changes.'\n  desc 'rationale', \"Monitoring changes to SQL instance configuration changes may reduce the time needed to detect and correct misconfigurations done on the SQL server.\n  Below are a few of the configurable options which may the impact security posture of an SQL instance:\n  - Enable auto backups and high availability: Misconfiguration may adversely impact business continuity, disaster recovery, and high availability\n  - Authorize networks: Misconfiguration may increase exposure to untrusted networks\"\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[AU-3 AU-12]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/logs-based-metrics/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/monitoring/custom-metrics/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/monitoring/alerts/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/reference/tools/gcloud-logging'\n  ref 'GCP Docs', url: 'https://cloud.google.com/storage/docs/overview'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/mysql/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/postgres/'\n\n  log_filter = 'resource.type=audited_resource AND protoPayload.methodName=\"cloudsql.instances.update\"'\n  describe \"[#{gcp_project_id}] Cloud SQL changes filter\" do\n    subject { google_project_metrics(project: gcp_project_id).where(metric_filter: log_filter) }\n    it { should exist }\n  end\n\n  google_project_metrics(project: gcp_project_id).where(metric_filter: log_filter).metric_types.each do |metrictype|\n    describe.one do\n      filter = \"metric.type=\\\"#{metrictype}\\\" resource.type=\\\"audited_resource\\\"\"\n      google_project_alert_policies(project: gcp_project_id).where(policy_enabled_state: true).policy_names.each do |policy|\n        condition = google_project_alert_policy_condition(policy: policy, filter: filter)\n        describe \"[#{gcp_project_id}] Cloud SQL changes alert policy\" do\n          subject { condition }\n          it { should exist }\n        end\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/2.11-logging.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"[lab-prod-461912] Cloud SQL changes filter is expected to exist","run_time":0.322655895,"start_time":"2025-06-06T12:19:51+00:00","message":"expected google_project_metrics with metric_filter == \"resource.type=audited_resource AND protoPayload.methodName=\\\"cloudsql.instances.update\\\"\" to exist","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] Cloud SQL changes filter"}]},{"id":"cis-gcp-2.12-logging","title":"[LOGGING] Ensure That Cloud DNS Logging Is Enabled for All VPC Networks","desc":"Cloud DNS logging records the queries from the name servers within your VPC to Stackdriver. Logged queries can come from Compute Engine VMs, GKE containers, or other GCP resources provisioned within the VPC.","descriptions":[{"label":"default","data":"Cloud DNS logging records the queries from the name servers within your VPC to Stackdriver. Logged queries can come from Compute Engine VMs, GKE containers, or other GCP resources provisioned within the VPC."},{"label":"rationale","data":"Security monitoring and forensics cannot depend solely on IP addresses from VPC flow logs, especially when considering the dynamic IP usage of cloud resources, HTTP virtual host routing, and other technology that can obscure the DNS name used by a client from the IP address. Monitoring of Cloud DNS logs provides visibility to DNS names requested by the clients within the VPC. These logs can be monitored for anomalous domain names, evaluated against threat intelligence, and\n\n  Note: For full capture of DNS, firewall must block egress UDP/53 (DNS) and TCP/443 (DNS over HTTPS) to prevent client from using external DNS name server for resolution."}],"impact":0.1,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/dns/docs/monitoring","ref":"GCP Docs"}],"tags":{"cis_scored":false,"cis_level":1,"cis_gcp":"2.12","cis_version":"4.0","project":"lab-prod-461912","nist":[]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'low'\n\n  title \"[#{control_abbrev.upcase}] Ensure That Cloud DNS Logging Is Enabled for All VPC Networks\"\n\n  desc 'Cloud DNS logging records the queries from the name servers within your VPC to Stackdriver. Logged queries can come from Compute Engine VMs, GKE containers, or other GCP resources provisioned within the VPC.'\n  desc 'rationale', \"Security monitoring and forensics cannot depend solely on IP addresses from VPC flow logs, especially when considering the dynamic IP usage of cloud resources, HTTP virtual host routing, and other technology that can obscure the DNS name used by a client from the IP address. Monitoring of Cloud DNS logs provides visibility to DNS names requested by the clients within the VPC. These logs can be monitored for anomalous domain names, evaluated against threat intelligence, and\n\n  Note: For full capture of DNS, firewall must block egress UDP/53 (DNS) and TCP/443 (DNS over HTTPS) to prevent client from using external DNS name server for resolution.\"\n\n  tag cis_scored: false\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[] # Add relevant NIST controls if any in future\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/dns/docs/monitoring'\n\n  describe 'This control is not scored' do\n    skip 'This control is not scored'\n  end\nend\n","source_location":{"line":23,"ref":"./controls/2.12-logging.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This control is not scored","run_time":3.2916e-05,"start_time":"2025-06-06T12:19:52+00:00","resource":"","skip_message":"This control is not scored","resource_class":"Object","resource_params":"[]","resource_id":"This control is not scored"}]},{"id":"cis-gcp-2.13-logging","title":"[LOGGING] Ensure Cloud Asset Inventory Is Enabled","desc":"GCP Cloud Asset Inventory is services that provides a historical view of GCP resources and IAM policies through a time-series database. The information recorded includes metadata on Google Cloud resources, metadata on policies set on Google Cloud projects or resources, and runtime information gathered within a Google Cloud resource.\n\n  Cloud Asset Inventory Service (CAIS) API enablement is not required for operation of the service, but rather enables the mechanism for searching/exporting CAIS asset data directly.","descriptions":[{"label":"default","data":"GCP Cloud Asset Inventory is services that provides a historical view of GCP resources and IAM policies through a time-series database. The information recorded includes metadata on Google Cloud resources, metadata on policies set on Google Cloud projects or resources, and runtime information gathered within a Google Cloud resource.\n\n  Cloud Asset Inventory Service (CAIS) API enablement is not required for operation of the service, but rather enables the mechanism for searching/exporting CAIS asset data directly."},{"label":"rationale","data":"The GCP resources and IAM policies captured by GCP Cloud Asset Inventory enables security analysis, resource change tracking, and compliance auditing.\n\n  It is recommended GCP Cloud Asset Inventory be enabled for all GCP projects."}],"impact":0.1,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/asset-inventory/docs","ref":"GCP Docs"}],"tags":{"cis_scored":false,"cis_level":1,"cis_gcp":"2.13","cis_version":"4.0","project":"lab-prod-461912","nist":[]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'low'\n\n  title \"[#{control_abbrev.upcase}] Ensure Cloud Asset Inventory Is Enabled\"\n\n  desc \"GCP Cloud Asset Inventory is services that provides a historical view of GCP resources and IAM policies through a time-series database. The information recorded includes metadata on Google Cloud resources, metadata on policies set on Google Cloud projects or resources, and runtime information gathered within a Google Cloud resource.\n\n  Cloud Asset Inventory Service (CAIS) API enablement is not required for operation of the service, but rather enables the mechanism for searching/exporting CAIS asset data directly.\"\n  desc 'rationale', \"The GCP resources and IAM policies captured by GCP Cloud Asset Inventory enables security analysis, resource change tracking, and compliance auditing.\n\n  It is recommended GCP Cloud Asset Inventory be enabled for all GCP projects.\"\n\n  tag cis_scored: false\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[] # Add relevant NIST controls if any in future\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/asset-inventory/docs'\n  describe 'This control is not scored' do\n    skip 'This control is not scored'\n  end\nend\n","source_location":{"line":23,"ref":"./controls/2.13-logging.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This control is not scored","run_time":8.208e-06,"start_time":"2025-06-06T12:19:52+00:00","resource":"","skip_message":"This control is not scored","resource_class":"Object","resource_params":"[]","resource_id":"This control is not scored"}]},{"id":"cis-gcp-2.14-logging","title":"[LOGGING] Ensure 'Access Transparency' is 'Enabled'","desc":"GCP Access Transparency provides audit logs for all actions that Google personnel take in your Google Cloud resources.","descriptions":[{"label":"default","data":"GCP Access Transparency provides audit logs for all actions that Google personnel take in your Google Cloud resources."},{"label":"rationale","data":"Controlling access to your information is one of the foundations of information security. Given that Google Employees do have access to your organizations' projects for support reasons, you should have logging in place to view who, when, and why your information is being accessed. To use Access Transparency your organization will need to have at one of the following support level: Premium, Enterprise, Platinum, or Gold. There will be subscription costs associated with support, as well as increased storage costs for storing the logs."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/cloud-provider-access-management/access-transparency/docs/overview","ref":"GCP Docs"},{"url":"https://cloud.google.com/cloud-provider-access-management/access-transparency/docs/enable","ref":"GCP Docs"},{"url":"https://cloud.google.com/cloud-provider-access-management/access-transparency/docs/reading-logs","ref":"GCP Docs"},{"url":"https://cloud.google.com/cloud-provider-access-management/access-transparency/docs/reading-logs#justification_reason_codes","ref":"GCP Docs"},{"url":"https://cloud.google.com/cloud-provider-access-management/access-transparency/docs/supported-services","ref":"GCP Docs"}],"tags":{"cis_scored":false,"cis_level":2,"cis_gcp":"2.14","cis_version":"4.0","project":"lab-prod-461912","nist":[]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure 'Access Transparency' is 'Enabled'\"\n\n  desc 'GCP Access Transparency provides audit logs for all actions that Google personnel take in your Google Cloud resources.'\n  desc 'rationale', \"Controlling access to your information is one of the foundations of information security. Given that Google Employees do have access to your organizations' projects for support reasons, you should have logging in place to view who, when, and why your information is being accessed. To use Access Transparency your organization will need to have at one of the following support level: Premium, Enterprise, Platinum, or Gold. There will be subscription costs associated with support, as well as increased storage costs for storing the logs.\"\n\n  tag cis_scored: false\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[] # Add relevant NIST controls if any in future\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/cloud-provider-access-management/access-transparency/docs/overview'\n  ref 'GCP Docs', url: 'https://cloud.google.com/cloud-provider-access-management/access-transparency/docs/enable'\n  ref 'GCP Docs', url: 'https://cloud.google.com/cloud-provider-access-management/access-transparency/docs/reading-logs'\n  ref 'GCP Docs', url: 'https://cloud.google.com/cloud-provider-access-management/access-transparency/docs/reading-logs#justification_reason_codes'\n  ref 'GCP Docs', url: 'https://cloud.google.com/cloud-provider-access-management/access-transparency/docs/supported-services'\n\n  describe 'This control is not scored' do\n    skip 'This control is not scored'\n  end\nend\n","source_location":{"line":24,"ref":"./controls/2.14-logging.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This control is not scored","run_time":5.208e-06,"start_time":"2025-06-06T12:19:52+00:00","resource":"","skip_message":"This control is not scored","resource_class":"Object","resource_params":"[]","resource_id":"This control is not scored"}]},{"id":"cis-gcp-2.15-logging","title":"[LOGGING] Ensure 'Access Approval' is 'Enabled'","desc":"GCP Access Approval enables you to require your organizations' explicit approval whenever Google support try to access your projects. You can then select users within your organization who can approve these requests through giving them a security role in IAM. All access requests display which Google Employee requested them in an email or Pub/Sub message that you can choose to Approve. This adds an additional control and logging of who in your organization approved/denied these requests.","descriptions":[{"label":"default","data":"GCP Access Approval enables you to require your organizations' explicit approval whenever Google support try to access your projects. You can then select users within your organization who can approve these requests through giving them a security role in IAM. All access requests display which Google Employee requested them in an email or Pub/Sub message that you can choose to Approve. This adds an additional control and logging of who in your organization approved/denied these requests."},{"label":"rationale","data":"Controlling access to your information is one of the foundations of information security. Google Employees do have access to your organizations' projects for support reasons. With Access Approval, organizations can then be certain that their information is accessed by only approved Google Personnel. Note: To use Access Approval your organization will need have enabled Access Transparency and have at one of the following support level: Enhanced or Premium. There will be subscription costs associated with these support levels, as well as increased storage costs for storing the logs. There may also be a potential delay in support times if approval is not granted promptly."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/cloud-provider-access-management/access-approval/docs","ref":"GCP Docs"},{"url":"https://cloud.google.com/cloud-provider-access-management/access-approval/docs/overview","ref":"GCP Docs"},{"url":"https://cloud.google.com/cloud-provider-access-management/access-approval/docs/quickstart-custom-key","ref":"GCP Docs"},{"url":"https://cloud.google.com/cloud-provider-access-management/access-approval/docs/supported-services","ref":"GCP Docs"},{"url":"https://cloud.google.com/cloud-provider-access-management/access-approval/docs/view-historical-requests","ref":"GCP Docs"}],"tags":{"cis_scored":false,"cis_level":2,"cis_gcp":"2.15","cis_version":"4.0","project":"lab-prod-461912","nist":[]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure 'Access Approval' is 'Enabled'\"\n\n  desc \"GCP Access Approval enables you to require your organizations' explicit approval whenever Google support try to access your projects. You can then select users within your organization who can approve these requests through giving them a security role in IAM. All access requests display which Google Employee requested them in an email or Pub/Sub message that you can choose to Approve. This adds an additional control and logging of who in your organization approved/denied these requests.\"\n  desc 'rationale', \"Controlling access to your information is one of the foundations of information security. Google Employees do have access to your organizations' projects for support reasons. With Access Approval, organizations can then be certain that their information is accessed by only approved Google Personnel. Note: To use Access Approval your organization will need have enabled Access Transparency and have at one of the following support level: Enhanced or Premium. There will be subscription costs associated with these support levels, as well as increased storage costs for storing the logs. There may also be a potential delay in support times if approval is not granted promptly.\"\n\n  tag cis_scored: false\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[] # Add relevant NIST controls if any in future\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/cloud-provider-access-management/access-approval/docs'\n  ref 'GCP Docs', url: 'https://cloud.google.com/cloud-provider-access-management/access-approval/docs/overview'\n  ref 'GCP Docs', url: 'https://cloud.google.com/cloud-provider-access-management/access-approval/docs/quickstart-custom-key'\n  ref 'GCP Docs', url: 'https://cloud.google.com/cloud-provider-access-management/access-approval/docs/supported-services'\n  ref 'GCP Docs', url: 'https://cloud.google.com/cloud-provider-access-management/access-approval/docs/view-historical-requests'\n\n  describe 'This control is not scored' do\n    skip 'This control is not scored'\n  end\nend\n","source_location":{"line":23,"ref":"./controls/2.15-logging.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This control is not scored","run_time":1.8375e-05,"start_time":"2025-06-06T12:19:52+00:00","resource":"","skip_message":"This control is not scored","resource_class":"Object","resource_params":"[]","resource_id":"This control is not scored"}]},{"id":"cis-gcp-2.16-logging","title":"[LOGGING] Ensure Logging is enabled for HTTP(S) Load Balancer","desc":"Logging enabled on a HTTPS Load Balancer will show all network traffic and its destination.","descriptions":[{"label":"default","data":"Logging enabled on a HTTPS Load Balancer will show all network traffic and its destination."},{"label":"rationale","data":"Logging will allow you to view HTTPS network traffic to your web applications. On high use systems with a high percentage sample rate, the logging file may grow to high capacity in a short amount of time. Ensure that the sample rate is set appropriately so that storage costs are not exorbitant."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/load-balancing/","ref":"GCP Docs"},{"url":"https://cloud.google.com/load-balancing/docs/https/https-logging-monitoring#gcloud:-global-mode","ref":"GCP Docs"},{"url":"https://cloud.google.com/sdk/gcloud/reference/compute/backend-services/","ref":"GCP Docs"}],"tags":{"cis_scored":false,"cis_level":2,"cis_gcp":"2.16","cis_version":"4.0","project":"lab-prod-461912","nist":[]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure Logging is enabled for HTTP(S) Load Balancer\"\n\n  desc 'Logging enabled on a HTTPS Load Balancer will show all network traffic and its destination.'\n  desc 'rationale', 'Logging will allow you to view HTTPS network traffic to your web applications. On high use systems with a high percentage sample rate, the logging file may grow to high capacity in a short amount of time. Ensure that the sample rate is set appropriately so that storage costs are not exorbitant.'\n\n  tag cis_scored: false\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[] # Add relevant NIST controls if any in future\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/load-balancing/'\n  ref 'GCP Docs', url: 'https://cloud.google.com/load-balancing/docs/https/https-logging-monitoring#gcloud:-global-mode'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sdk/gcloud/reference/compute/backend-services/'\n  describe 'This control is not scored' do\n    skip 'This control is not scored'\n  end\nend\n","source_location":{"line":23,"ref":"./controls/2.16-logging.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This control is not scored","run_time":5.25e-06,"start_time":"2025-06-06T12:19:52+00:00","resource":"","skip_message":"This control is not scored","resource_class":"Object","resource_params":"[]","resource_id":"This control is not scored"}]},{"id":"cis-gcp-3.1-networking","title":"[NETWORKING] Ensure That the Default Network Does Not Exist in a Project","desc":"To prevent use of default network, a project should not have a default network.","descriptions":[{"label":"default","data":"To prevent use of default network, a project should not have a default network."},{"label":"rationale","data":"The default network has a preconfigured network configuration and automatically generates the following insecure firewall rules:\n  - default-allow-internal: Allows ingress connections for all protocols and ports among instances in the network.\n  - default-allow-ssh: Allows ingress connections on TCP port 22(SSH) from any source to any instance in the network.\n  - default-allow-rdp: Allows ingress connections on TCP port 3389(RDP) from any source to any instance in the network.\n  - default-allow-icmp: Allows ingress ICMP traffic from any source to any instance in the network.\n  These automatically created firewall rules do not get audit logged by default.\n\n  Furthermore, the default network is an auto mode network, which means that its subnets use the same predefined range of IP addresses, and as a result, it's not possible to use Cloud VPN or VPC Network Peering with the default network.\n\n  Based on organization security and networking requirements, the organization should create a new network and delete the default network."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/compute/docs/networking#firewall_rules","ref":"GCP Docs"},{"url":"https://cloud.google.com/compute/docs/reference/latest/networks/insert","ref":"GCP Docs"},{"url":"https://cloud.google.com/compute/docs/reference/latest/networks/delete","ref":"GCP Docs"},{"url":"https://cloud.google.com/vpc/docs/firewall-rules-logging","ref":"GCP Docs"},{"url":"https://cloud.google.com/vpc/docs/vpc#default-network","ref":"GCP Docs"},{"url":"https://cloud.google.com/sdk/gcloud/reference/compute/networks/delete","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"3.1","cis_version":"4.0","project":"lab-prod-461912","nist":["CM-6"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure That the Default Network Does Not Exist in a Project\"\n\n  desc 'To prevent use of default network, a project should not have a default network.'\n  desc 'rationale', \"The default network has a preconfigured network configuration and automatically generates the following insecure firewall rules:\n  - default-allow-internal: Allows ingress connections for all protocols and ports among instances in the network.\n  - default-allow-ssh: Allows ingress connections on TCP port 22(SSH) from any source to any instance in the network.\n  - default-allow-rdp: Allows ingress connections on TCP port 3389(RDP) from any source to any instance in the network.\n  - default-allow-icmp: Allows ingress ICMP traffic from any source to any instance in the network.\n  These automatically created firewall rules do not get audit logged by default.\n\n  Furthermore, the default network is an auto mode network, which means that its subnets use the same predefined range of IP addresses, and as a result, it's not possible to use Cloud VPN or VPC Network Peering with the default network.\n\n  Based on organization security and networking requirements, the organization should create a new network and delete the default network.\"\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['CM-6']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/networking#firewall_rules'\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/reference/latest/networks/insert'\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/reference/latest/networks/delete'\n  ref 'GCP Docs', url: 'https://cloud.google.com/vpc/docs/firewall-rules-logging'\n  ref 'GCP Docs', url: 'https://cloud.google.com/vpc/docs/vpc#default-network'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sdk/gcloud/reference/compute/networks/delete'\n  describe \"[#{gcp_project_id}] Subnets\" do\n    subject { google_compute_networks(project: gcp_project_id) }\n    its('network_names') { should_not include 'default' }\n  end\nend\n","source_location":{"line":23,"ref":"./controls/3.01-networking.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"[lab-prod-461912] Subnets network_names is expected not to include \"default\"","run_time":0.525345777,"start_time":"2025-06-06T12:19:52+00:00","message":"expected [\"default\"] not to include \"default\"","resource_class":"Object","resource_params":"[]","resource_id":"network_names"}]},{"id":"cis-gcp-3.2-networking","title":"[NETWORKING] Ensure Legacy Networks Do Not Exist for Older Projects","desc":"In order to prevent use of legacy networks, a project should not have a legacy network configured. As of now, Legacy Networks are gradually being phased out, and you can no longer create projects with them. This recommendation is to check older projects to ensure that they are not using Legacy Networks.","descriptions":[{"label":"default","data":"In order to prevent use of legacy networks, a project should not have a legacy network configured. As of now, Legacy Networks are gradually being phased out, and you can no longer create projects with them. This recommendation is to check older projects to ensure that they are not using Legacy Networks."},{"label":"rationale","data":"Legacy networks have a single network IPv4 prefix range and a single gateway IP address for the whole network. The network is global in scope and spans all cloud regions. Subnetworks cannot be created in a legacy network and are unable to switch from legacy to auto or custom subnet networks. Legacy networks can have an impact for high network traffic projects and are subject to a single point of contention or failure."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/compute/docs/networking#creating_a_legacy_network","ref":"GCP Docs"},{"url":"https://cloud.google.com/vpc/docs/using-legacy#deleting_a_legacy_network","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"3.2","cis_version":"4.0","project":"lab-prod-461912","nist":["CM-6"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure Legacy Networks Do Not Exist for Older Projects\"\n\n  desc 'In order to prevent use of legacy networks, a project should not have a legacy network configured. As of now, Legacy Networks are gradually being phased out, and you can no longer create projects with them. This recommendation is to check older projects to ensure that they are not using Legacy Networks.'\n  desc 'rationale', 'Legacy networks have a single network IPv4 prefix range and a single gateway IP address for the whole network. The network is global in scope and spans all cloud regions. Subnetworks cannot be created in a legacy network and are unable to switch from legacy to auto or custom subnet networks. Legacy networks can have an impact for high network traffic projects and are subject to a single point of contention or failure.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['CM-6']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/networking#creating_a_legacy_network'\n  ref 'GCP Docs', url: 'https://cloud.google.com/vpc/docs/using-legacy#deleting_a_legacy_network'\n\n  network_names = google_compute_networks(project: gcp_project_id).network_names\n\n  if network_names.empty?\n    describe \"[#{gcp_project_id}] does not have any networks. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have any networks.\"\n    end\n  else\n    google_compute_networks(project: gcp_project_id).network_names.each do |network|\n      describe \"[#{gcp_project_id}] Network [#{network}] \" do\n        subject { google_compute_network(project: gcp_project_id, name: network) }\n        it { should_not be_legacy }\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/3.02-networking.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"[lab-prod-461912] Network [default]  is expected not to be legacy","run_time":0.580145151,"start_time":"2025-06-06T12:19:52+00:00","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] Network [default]"}]},{"id":"cis-gcp-3.3-networking","title":"[NETWORKING] Ensure that DNSSEC is enabled for Cloud DNS","desc":"Cloud Domain Name System (DNS) is a fast, reliable and cost-effective domain name system that powers millions of domains on the internet. Domain Name System Security Extensions (DNSSEC) in Cloud DNS enables domain owners to take easy steps to protect their domains against DNS hijacking and man-in-the-middle and other attacks.","descriptions":[{"label":"default","data":"Cloud Domain Name System (DNS) is a fast, reliable and cost-effective domain name system that powers millions of domains on the internet. Domain Name System Security Extensions (DNSSEC) in Cloud DNS enables domain owners to take easy steps to protect their domains against DNS hijacking and man-in-the-middle and other attacks."},{"label":"rationale","data":"Domain Name System Security Extensions (DNSSEC) adds security to the DNS protocol by enabling DNS responses to be validated. Having a trustworthy DNS that translates a domain name like www.example.com into its associated IP address is an increasingly important building block of todays web-based applications. Attackers can hijack this process of domain/IP lookup and redirect users to a malicious site through DNS hijacking and man-in-the-middle attacks. DNSSEC helps mitigate the risk of such attacks by cryptographically signing DNS records. As a result, it prevents attackers from issuing fake DNS responses that may misdirect browsers to nefarious websites."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloudplatform.googleblog.com/2017/11/DNSSEC-now-available-in-Cloud-DNS.html","ref":"GCP Docs"},{"url":"https://cloud.google.com/dns/dnssec-config#enabling","ref":"GCP Docs"},{"url":"https://cloud.google.com/dns/dnssec","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"3.3","cis_version":"4.0","project":"lab-prod-461912","nist":["CM-6"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure that DNSSEC is enabled for Cloud DNS\"\n\n  desc 'Cloud Domain Name System (DNS) is a fast, reliable and cost-effective domain name system that powers millions of domains on the internet. Domain Name System Security Extensions (DNSSEC) in Cloud DNS enables domain owners to take easy steps to protect their domains against DNS hijacking and man-in-the-middle and other attacks.'\n  desc 'rationale', 'Domain Name System Security Extensions (DNSSEC) adds security to the DNS protocol by enabling DNS responses to be validated. Having a trustworthy DNS that translates a domain name like www.example.com into its associated IP address is an increasingly important building block of todays web-based applications. Attackers can hijack this process of domain/IP lookup and redirect users to a malicious site through DNS hijacking and man-in-the-middle attacks. DNSSEC helps mitigate the risk of such attacks by cryptographically signing DNS records. As a result, it prevents attackers from issuing fake DNS responses that may misdirect browsers to nefarious websites.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['CM-6']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloudplatform.googleblog.com/2017/11/DNSSEC-now-available-in-Cloud-DNS.html'\n  ref 'GCP Docs', url: 'https://cloud.google.com/dns/dnssec-config#enabling'\n  ref 'GCP Docs', url: 'https://cloud.google.com/dns/dnssec'\n\n  managed_zone_names = google_dns_managed_zones(project: gcp_project_id).where(visibility: 'public').zone_names\n  if managed_zone_names.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] does not have DNS Zones with Public visibility. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have DNS Zones with Public visibility.\"\n    end\n  else\n    managed_zone_names.each do |dnszone|\n      describe \"[#{gcp_project_id}] DNS Zone [#{dnszone}] with DNSSEC\" do\n        subject { google_dns_managed_zone(project: gcp_project_id, zone: dnszone) }\n        its('dnssec_config.state') { should cmp 'on' }\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/3.03-networking.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have DNS Zones with Public visibility. This test is Not Applicable.","run_time":1.4959e-05,"start_time":"2025-06-06T12:19:53+00:00","resource":"","skip_message":"[lab-prod-461912] does not have DNS Zones with Public visibility.","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have DNS Zones with Public visibility. This test is Not Applicable."}]},{"id":"cis-gcp-3.4-networking","title":"[NETWORKING] Ensure that RSASHA1 is not used for key-signing key in Cloud DNS DNSSEC","desc":"NOTE: Currently, the SHA1 algorithm has been removed from general use by Google, and, if being used, needs to be whitelisted on a project basis by Google and will also, therefore, require a Google Cloud support contract.\n\n  DNSSEC algorithm numbers in this registry may be used in CERT RRs. Zone signing (DNSSEC) and transaction security mechanisms (SIG(0) and TSIG) make use of particular subsets of these algorithms. The algorithm used for key signing should be a recommended one and it should be strong.","descriptions":[{"label":"default","data":"NOTE: Currently, the SHA1 algorithm has been removed from general use by Google, and, if being used, needs to be whitelisted on a project basis by Google and will also, therefore, require a Google Cloud support contract.\n\n  DNSSEC algorithm numbers in this registry may be used in CERT RRs. Zone signing (DNSSEC) and transaction security mechanisms (SIG(0) and TSIG) make use of particular subsets of these algorithms. The algorithm used for key signing should be a recommended one and it should be strong."},{"label":"rationale","data":"Domain Name System Security Extensions (DNSSEC) algorithm numbers in this registry may be used in CERT RRs. Zonesigning (DNSSEC) and transaction security mechanisms (SIG(0) and TSIG) make use of particular subsets of these algorithms.\n\n  The algorithm used for key signing should be a recommended one and it should be strong. When enabling DNSSEC for a managed zone, or creating a managed zone with DNSSEC, the user can select the DNSSEC signing algorithms and the denial-of-existence type. Changing the DNSSEC settings is only effective for a managed zone if DNSSEC is not already enabled. If there is a need to change the settings for a managed zone where it has been enabled, turn DNSSEC off and then re-enable it with different settings."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/dns/dnssec-advanced#advanced_signing_options","ref":"GCP Docs"}],"tags":{"cis_scored":false,"cis_level":1,"cis_gcp":"3.4","cis_version":"4.0","project":"lab-prod-461912","nist":["CM-6"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure that RSASHA1 is not used for key-signing key in Cloud DNS DNSSEC\"\n\n  desc 'NOTE: Currently, the SHA1 algorithm has been removed from general use by Google, and, if being used, needs to be whitelisted on a project basis by Google and will also, therefore, require a Google Cloud support contract.\n\n  DNSSEC algorithm numbers in this registry may be used in CERT RRs. Zone signing (DNSSEC) and transaction security mechanisms (SIG(0) and TSIG) make use of particular subsets of these algorithms. The algorithm used for key signing should be a recommended one and it should be strong.'\n  desc 'rationale', 'Domain Name System Security Extensions (DNSSEC) algorithm numbers in this registry may be used in CERT RRs. Zonesigning (DNSSEC) and transaction security mechanisms (SIG(0) and TSIG) make use of particular subsets of these algorithms.\n\n  The algorithm used for key signing should be a recommended one and it should be strong. When enabling DNSSEC for a managed zone, or creating a managed zone with DNSSEC, the user can select the DNSSEC signing algorithms and the denial-of-existence type. Changing the DNSSEC settings is only effective for a managed zone if DNSSEC is not already enabled. If there is a need to change the settings for a managed zone where it has been enabled, turn DNSSEC off and then re-enable it with different settings.'\n\n  tag cis_scored: false\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['CM-6']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/dns/dnssec-advanced#advanced_signing_options'\n\n  managed_zone_names = google_dns_managed_zones(project: gcp_project_id).zone_names\n\n  if managed_zone_names.empty?\n    describe \"[#{gcp_project_id}] does not have DNS Zones. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have DNS Zones.\"\n    end\n  else\n    managed_zone_names.each do |dnszone|\n      zone = google_dns_managed_zone(project: gcp_project_id, zone: dnszone)\n      if zone.visibility == 'private'\n        describe \"[#{gcp_project_id}] DNS zone #{dnszone} has private visibility. This test is not applicable for private zones.\" do\n          skip \"[#{gcp_project_id}] DNS zone #{dnszone} has private visibility.\"\n        end\n      elsif zone.dnssec_config.state == 'on'\n        zone.dnssec_config.default_key_specs.select { |spec| spec.key_type == 'keySigning' }.each do |spec|\n          impact 'medium'\n          describe \"[#{gcp_project_id}] DNS Zone [#{dnszone}] with DNSSEC key-signing\" do\n            subject { spec }\n            its('algorithm') { should_not cmp 'RSASHA1' }\n            its('algorithm') { should_not cmp nil }\n          end\n        end\n      else\n        impact 'medium'\n        describe \"[#{gcp_project_id}] DNS Zone [#{dnszone}] DNSSEC\" do\n          subject { 'off' }\n          it { should cmp 'on' }\n        end\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/3.04-networking.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have DNS Zones. This test is Not Applicable.","run_time":6.917e-06,"start_time":"2025-06-06T12:19:53+00:00","resource":"","skip_message":"[lab-prod-461912] does not have DNS Zones.","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have DNS Zones. This test is Not Applicable."}]},{"id":"cis-gcp-3.5-networking","title":"[NETWORKING] Ensure That RSASHA1 Is Not Used for the Zone-Signing Key in Cloud DNS DNSSEC","desc":"NOTE: Currently, the SHA1 algorithm has been removed from general use by Google, and, if being used, needs to be whitelisted on a project basis by Google and will also, therefore, require a Google Cloud support contract.\n\n  DNSSEC algorithm numbers in this registry may be used in CERT RRs. Zone signing (DNSSEC) and transaction security mechanisms (SIG(0) and TSIG) make use of particular subsets of these algorithms. The algorithm used for key signing should be a recommended one and it should be strong.","descriptions":[{"label":"default","data":"NOTE: Currently, the SHA1 algorithm has been removed from general use by Google, and, if being used, needs to be whitelisted on a project basis by Google and will also, therefore, require a Google Cloud support contract.\n\n  DNSSEC algorithm numbers in this registry may be used in CERT RRs. Zone signing (DNSSEC) and transaction security mechanisms (SIG(0) and TSIG) make use of particular subsets of these algorithms. The algorithm used for key signing should be a recommended one and it should be strong."},{"label":"rationale","data":"DNSSEC algorithm numbers in this registry may be used in CERT RRs. Zone signing (DNSSEC) and transaction security mechanisms (SIG(0) and TSIG) make use of particular subsets of these algorithms.\n\n  The algorithm used for key signing should be a recommended one and it should be strong. When enabling DNSSEC for a managed zone, or creating a managed zone with DNSSEC, the DNSSEC signing algorithms and the denial-of-existence type can be selected. Changing the DNSSEC settings is only effective for a managed zone if DNSSEC is not already enabled. If the need exists to change the settings for a managed zone where it has been enabled, turn DNSSEC off and then re-enable it with different settings."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/dns/dnssec-advanced#advanced_signing_options","ref":"GCP Docs"}],"tags":{"cis_scored":false,"cis_level":1,"cis_gcp":"3.5","cis_version":"4.0","project":"lab-prod-461912","nist":["CM-6"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure That RSASHA1 Is Not Used for the Zone-Signing Key in Cloud DNS DNSSEC\"\n\n  desc 'NOTE: Currently, the SHA1 algorithm has been removed from general use by Google, and, if being used, needs to be whitelisted on a project basis by Google and will also, therefore, require a Google Cloud support contract.\n\n  DNSSEC algorithm numbers in this registry may be used in CERT RRs. Zone signing (DNSSEC) and transaction security mechanisms (SIG(0) and TSIG) make use of particular subsets of these algorithms. The algorithm used for key signing should be a recommended one and it should be strong.'\n  desc 'rationale', \"DNSSEC algorithm numbers in this registry may be used in CERT RRs. Zone signing (DNSSEC) and transaction security mechanisms (SIG(0) and TSIG) make use of particular subsets of these algorithms.\n\n  The algorithm used for key signing should be a recommended one and it should be strong. When enabling DNSSEC for a managed zone, or creating a managed zone with DNSSEC, the DNSSEC signing algorithms and the denial-of-existence type can be selected. Changing the DNSSEC settings is only effective for a managed zone if DNSSEC is not already enabled. If the need exists to change the settings for a managed zone where it has been enabled, turn DNSSEC off and then re-enable it with different settings.\"\n\n  tag cis_scored: false\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['CM-6']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/dns/dnssec-advanced#advanced_signing_options'\n\n  managed_zone_names = google_dns_managed_zones(project: gcp_project_id).zone_names\n\n  if managed_zone_names.empty?\n    describe \"[#{gcp_project_id}] does not have DNS Zones. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have DNS Zones.\"\n    end\n  else\n    managed_zone_names.each do |dnszone|\n      zone = google_dns_managed_zone(project: gcp_project_id, zone: dnszone)\n      if zone.visibility == 'private'\n        describe \"[#{gcp_project_id}] DNS zone #{dnszone} has private visibility. This test is not applicable for private zones.\" do\n          skip \"[#{gcp_project_id}] DNS zone #{dnszone} has private visibility.\"\n        end\n      elsif zone.dnssec_config.state == 'on'\n        zone.dnssec_config.default_key_specs.select { |spec| spec.key_type == 'zoneSigning' }.each do |spec|\n          impact 'medium'\n          describe \"[#{gcp_project_id}] DNS Zone [#{dnszone}] with DNSSEC zone-signing\" do\n            subject { spec }\n            its('algorithm') { should_not cmp 'RSASHA1' }\n            its('algorithm') { should_not cmp nil }\n          end\n        end\n      else\n        impact 'medium'\n        describe \"[#{gcp_project_id}] DNS Zone [#{dnszone}] DNSSEC\" do\n          subject { 'off' }\n          it { should cmp 'on' }\n        end\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/3.05-networking.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have DNS Zones. This test is Not Applicable.","run_time":5.875e-06,"start_time":"2025-06-06T12:19:53+00:00","resource":"","skip_message":"[lab-prod-461912] does not have DNS Zones.","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have DNS Zones. This test is Not Applicable."}]},{"id":"cis-gcp-3.6-networking","title":"[NETWORKING] Ensure that SSH access is restricted from the internet","desc":"GCP Firewall Rules are specific to a VPC Network. Each rule either allows or denies traffic when its conditions are met. Its conditions allow the user to specify the type of traffic, such as ports and protocols, and the source or destination of the traffic, including IP addresses, subnets, and instances.\n\n  Firewall rules are defined at the VPC network level and are specific to the network in which they are defined. The rules themselves cannot be shared among networks. Firewall rules only support IPv4 traffic. When specifying a source for an ingress rule or a destination for an egress rule by address, only an IPv4 address or IPv4 block in CIDR notation can be used. Generic (0.0.0.0/0) incoming traffic from the internet to VPC or VM instance using SSH on Port 22 can be avoided.","descriptions":[{"label":"default","data":"GCP Firewall Rules are specific to a VPC Network. Each rule either allows or denies traffic when its conditions are met. Its conditions allow the user to specify the type of traffic, such as ports and protocols, and the source or destination of the traffic, including IP addresses, subnets, and instances.\n\n  Firewall rules are defined at the VPC network level and are specific to the network in which they are defined. The rules themselves cannot be shared among networks. Firewall rules only support IPv4 traffic. When specifying a source for an ingress rule or a destination for an egress rule by address, only an IPv4 address or IPv4 block in CIDR notation can be used. Generic (0.0.0.0/0) incoming traffic from the internet to VPC or VM instance using SSH on Port 22 can be avoided."},{"label":"rationale","data":"GCP Firewall Rules within a VPC Network apply to outgoing (egress) traffic from instances and incoming (ingress) traffic to instances in the network. Egress and ingress traffic flows are controlled even if the traffic stays within the network (for example, instance-to-instance communication). For an instance to have outgoing Internet access, the network must have a valid Internet gateway route or custom route whose destination IP is specified. This route simply defines the path to the Internet, to avoid the most general (0.0.0.0/0) destination IP Range specified from the Internet through SSH with the default Port 22. Generic access from the Internet to a specific IP Range needs to be restricted."}],"impact":0.7,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/vpc/docs/firewalls#blockedtraffic","ref":"GCP Docs"},{"url":"https://cloud.google.com/blog/products/identity-security/cloud-iap-enables-context-aware-access-to-vms-via-ssh-and-rdp-without-bastion-hosts","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"3.6","cis_version":"4.0","project":"lab-prod-461912","nist":["CM-7","CA-3","SC-7"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'high'\n\n  title \"[#{control_abbrev.upcase}] Ensure that SSH access is restricted from the internet\"\n\n  desc 'GCP Firewall Rules are specific to a VPC Network. Each rule either allows or denies traffic when its conditions are met. Its conditions allow the user to specify the type of traffic, such as ports and protocols, and the source or destination of the traffic, including IP addresses, subnets, and instances.\n\n  Firewall rules are defined at the VPC network level and are specific to the network in which they are defined. The rules themselves cannot be shared among networks. Firewall rules only support IPv4 traffic. When specifying a source for an ingress rule or a destination for an egress rule by address, only an IPv4 address or IPv4 block in CIDR notation can be used. Generic (0.0.0.0/0) incoming traffic from the internet to VPC or VM instance using SSH on Port 22 can be avoided.'\n  desc 'rationale', 'GCP Firewall Rules within a VPC Network apply to outgoing (egress) traffic from instances and incoming (ingress) traffic to instances in the network. Egress and ingress traffic flows are controlled even if the traffic stays within the network (for example, instance-to-instance communication). For an instance to have outgoing Internet access, the network must have a valid Internet gateway route or custom route whose destination IP is specified. This route simply defines the path to the Internet, to avoid the most general (0.0.0.0/0) destination IP Range specified from the Internet through SSH with the default Port 22. Generic access from the Internet to a specific IP Range needs to be restricted.'\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[CM-7 CA-3 SC-7]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/vpc/docs/firewalls#blockedtraffic'\n  ref 'GCP Docs', url: 'https://cloud.google.com/blog/products/identity-security/cloud-iap-enables-context-aware-access-to-vms-via-ssh-and-rdp-without-bastion-hosts'\n\n  google_compute_firewalls(project: gcp_project_id).where(firewall_direction: 'INGRESS').firewall_names.each do |firewall_name|\n    describe \"[#{gcp_project_id}] #{firewall_name}\" do\n      subject { google_compute_firewall(project: gcp_project_id, name: firewall_name) }\n      it 'should not allow SSH from 0.0.0.0/0' do\n        expect(subject.allowed_ssh? && (subject.allow_ip_ranges? ['0.0.0.0/0'])).to be false\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/3.06-networking.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"[lab-prod-461912] default-allow-icmp should not allow SSH from 0.0.0.0/0","run_time":0.407254868,"start_time":"2025-06-06T12:19:53+00:00","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] default-allow-icmp"},{"status":"passed","code_desc":"[lab-prod-461912] default-allow-internal should not allow SSH from 0.0.0.0/0","run_time":0.615535357,"start_time":"2025-06-06T12:19:53+00:00","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] default-allow-internal"},{"status":"passed","code_desc":"[lab-prod-461912] default-allow-rdp should not allow SSH from 0.0.0.0/0","run_time":0.510889305,"start_time":"2025-06-06T12:19:54+00:00","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] default-allow-rdp"},{"status":"failed","code_desc":"[lab-prod-461912] default-allow-ssh should not allow SSH from 0.0.0.0/0","run_time":0.612054102,"start_time":"2025-06-06T12:19:54+00:00","message":"\nexpected false\n     got true\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] default-allow-ssh"}]},{"id":"cis-gcp-3.7-networking","title":"[NETWORKING] Ensure that RDP access is restricted from the internet","desc":"GCP Firewall Rules are specific to a VPC Network. Each rule either allows or denies traffic when its conditions are met. Its conditions allow users to specify the type of traffic, such as ports and protocols, and the source or destination of the traffic, including IP addresses, subnets, and instances.\n\n  Firewall rules are defined at the VPC network level and are specific to the network in which they are defined. The rules themselves cannot be shared among networks. Firewall rules only support IPv4 traffic. When specifying a source for an ingress rule or a destination for an egress rule by address, an IPv4 address or IPv4 block in CIDR notation can be used. Generic (0.0.0.0/0) incoming traffic from the Internet to a VPC or VM instance using RDP on Port 3389 can be avoided.","descriptions":[{"label":"default","data":"GCP Firewall Rules are specific to a VPC Network. Each rule either allows or denies traffic when its conditions are met. Its conditions allow users to specify the type of traffic, such as ports and protocols, and the source or destination of the traffic, including IP addresses, subnets, and instances.\n\n  Firewall rules are defined at the VPC network level and are specific to the network in which they are defined. The rules themselves cannot be shared among networks. Firewall rules only support IPv4 traffic. When specifying a source for an ingress rule or a destination for an egress rule by address, an IPv4 address or IPv4 block in CIDR notation can be used. Generic (0.0.0.0/0) incoming traffic from the Internet to a VPC or VM instance using RDP on Port 3389 can be avoided."},{"label":"rationale","data":"GCP Firewall Rules within a VPC Network. These rules apply to outgoing (egress) traffic from instances and incoming (ingress) traffic to instances in the network. Egress and ingress traffic flows are controlled even if the traffic stays within the network (for example, instance-to-instance communication). For an instance to have outgoing Internet access, the network must have a valid Internet gateway route or custom route whose destination IP is specified. This route simply defines the path to the Internet, to avoid the most general (0.0.0.0/0) destination IP Range specified from the Internet through RDP with the default Port 3389. Generic access from the Internet to a specific IP Range should be restricted."}],"impact":0.7,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/vpc/docs/firewalls#blockedtraffic","ref":"GCP Docs"},{"url":"https://cloud.google.com/blog/products/identity-security/cloud-iap-enables-context-aware-access-to-vms-via-ssh-and-rdp-without-bastion-hosts","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"3.7","cis_version":"4.0","project":"lab-prod-461912","nist":["CM-7","CA-3","SC-7"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'high'\n\n  title \"[#{control_abbrev.upcase}] Ensure that RDP access is restricted from the internet\"\n\n  desc 'GCP Firewall Rules are specific to a VPC Network. Each rule either allows or denies traffic when its conditions are met. Its conditions allow users to specify the type of traffic, such as ports and protocols, and the source or destination of the traffic, including IP addresses, subnets, and instances.\n\n  Firewall rules are defined at the VPC network level and are specific to the network in which they are defined. The rules themselves cannot be shared among networks. Firewall rules only support IPv4 traffic. When specifying a source for an ingress rule or a destination for an egress rule by address, an IPv4 address or IPv4 block in CIDR notation can be used. Generic (0.0.0.0/0) incoming traffic from the Internet to a VPC or VM instance using RDP on Port 3389 can be avoided.'\n  desc 'rationale', 'GCP Firewall Rules within a VPC Network. These rules apply to outgoing (egress) traffic from instances and incoming (ingress) traffic to instances in the network. Egress and ingress traffic flows are controlled even if the traffic stays within the network (for example, instance-to-instance communication). For an instance to have outgoing Internet access, the network must have a valid Internet gateway route or custom route whose destination IP is specified. This route simply defines the path to the Internet, to avoid the most general (0.0.0.0/0) destination IP Range specified from the Internet through RDP with the default Port 3389. Generic access from the Internet to a specific IP Range should be restricted.'\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[CM-7 CA-3 SC-7]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/vpc/docs/firewalls#blockedtraffic'\n  ref 'GCP Docs', url: 'https://cloud.google.com/blog/products/identity-security/cloud-iap-enables-context-aware-access-to-vms-via-ssh-and-rdp-without-bastion-hosts'\n\n  google_compute_firewalls(project: gcp_project_id).where(firewall_direction: 'INGRESS').firewall_names.each do |firewall_name|\n    describe \"[#{gcp_project_id}] #{firewall_name}\" do\n      subject { google_compute_firewall(project: gcp_project_id, name: firewall_name) }\n      it 'Should not allow RDP from 0.0.0.0/0' do\n        expect(subject.allowed_rdp? && (subject.allow_ip_ranges? ['0.0.0.0/0'])).to be false\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/3.07-networking.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"[lab-prod-461912] default-allow-icmp Should not allow RDP from 0.0.0.0/0","run_time":0.494735727,"start_time":"2025-06-06T12:19:55+00:00","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] default-allow-icmp"},{"status":"passed","code_desc":"[lab-prod-461912] default-allow-internal Should not allow RDP from 0.0.0.0/0","run_time":0.428753889,"start_time":"2025-06-06T12:19:55+00:00","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] default-allow-internal"},{"status":"failed","code_desc":"[lab-prod-461912] default-allow-rdp Should not allow RDP from 0.0.0.0/0","run_time":0.466535153,"start_time":"2025-06-06T12:19:56+00:00","message":"\nexpected false\n     got true\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] default-allow-rdp"},{"status":"passed","code_desc":"[lab-prod-461912] default-allow-ssh Should not allow RDP from 0.0.0.0/0","run_time":0.452605052,"start_time":"2025-06-06T12:19:56+00:00","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] default-allow-ssh"}]},{"id":"cis-gcp-3.8-networking","title":"[NETWORKING] Ensure that VPC Flow Logs is Enabled for Every Subnet in a VPC Network","desc":"Flow Logs is a feature that enables users to capture information about the IP traffic going to and from network interfaces in the organization's VPC Subnets. Once a flow log is created, the user can view and retrieve its data in Stackdriver Logging. It is recommended that Flow Logs be enabled for every business-critical VPC subnet.","descriptions":[{"label":"default","data":"Flow Logs is a feature that enables users to capture information about the IP traffic going to and from network interfaces in the organization's VPC Subnets. Once a flow log is created, the user can view and retrieve its data in Stackdriver Logging. It is recommended that Flow Logs be enabled for every business-critical VPC subnet."},{"label":"rationale","data":"VPC networks and subnetworks not reserved for internal HTTP(S) load balancing provide logically isolated and secure network partitions where GCP resources can be launched. When Flow Logs are enabled for a subnet, VMs within that subnet start reporting on all Transmission Control Protocol (TCP) and User Datagram Protocol (UDP) flows. Each VM samples the TCP and UDP flows it sees, inbound and outbound, whether the flow is to or from another VM, a host in the on-premises datacenter, a Google service, or a host on the Internet. If two GCP VMs are communicating, and both are in subnets that have VPC Flow Logs enabled, both VMs report the flows.\n\n  Flow Logs supports the following use cases:\n  - Network monitoring\n  - Understanding network usage and optimizing network traffic expenses\n  - Network forensics\n  - Real-time security analysis\n\n  Flow Logs provide visibility into network traffic for each VM inside the subnet and can be used to detect anomalous traffic or provide insight during security workflows.\n\n  The Flow Logs must be configured such that all network traffic is logged, the interval of logging is granular to provide detailed information on the connections, no logs are filtered, and metadata to facilitate investigations are included."}],"impact":0.1,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/vpc/docs/using-flow-logs#enabling_vpc_flow_logging","ref":"GCP Docs"},{"url":"https://cloud.google.com/vpc/","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"3.8","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-12","SI-4"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'low'\n\n  title \"[#{control_abbrev.upcase}] Ensure that VPC Flow Logs is Enabled for Every Subnet in a VPC Network\"\n\n  desc \"Flow Logs is a feature that enables users to capture information about the IP traffic going to and from network interfaces in the organization's VPC Subnets. Once a flow log is created, the user can view and retrieve its data in Stackdriver Logging. It is recommended that Flow Logs be enabled for every business-critical VPC subnet.\"\n  desc 'rationale', \"VPC networks and subnetworks not reserved for internal HTTP(S) load balancing provide logically isolated and secure network partitions where GCP resources can be launched. When Flow Logs are enabled for a subnet, VMs within that subnet start reporting on all Transmission Control Protocol (TCP) and User Datagram Protocol (UDP) flows. Each VM samples the TCP and UDP flows it sees, inbound and outbound, whether the flow is to or from another VM, a host in the on-premises datacenter, a Google service, or a host on the Internet. If two GCP VMs are communicating, and both are in subnets that have VPC Flow Logs enabled, both VMs report the flows.\n\n  Flow Logs supports the following use cases:\n  - Network monitoring\n  - Understanding network usage and optimizing network traffic expenses\n  - Network forensics\n  - Real-time security analysis\n\n  Flow Logs provide visibility into network traffic for each VM inside the subnet and can be used to detect anomalous traffic or provide insight during security workflows.\n\n  The Flow Logs must be configured such that all network traffic is logged, the interval of logging is granular to provide detailed information on the connections, no logs are filtered, and metadata to facilitate investigations are included.\"\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[AU-12 SI-4]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/vpc/docs/using-flow-logs#enabling_vpc_flow_logging'\n  ref 'GCP Docs', url: 'https://cloud.google.com/vpc/'\n\n  google_compute_regions(project: gcp_project_id).region_names.each do |region|\n    google_compute_subnetworks(project: gcp_project_id, region: region).subnetwork_names.each do |subnet|\n      subnet_obj = google_compute_subnetwork(project: gcp_project_id, region: region, name: subnet)\n      if subnet_obj.purpose == 'INTERNAL_HTTPS_LOAD_BALANCER' # filter subnets for internal HTTPs Load Balancing\n        describe \"[#{gcp_project_id} #{region}/#{subnet}] does not support VPC Flow Logs. This test is Not Applicable.\" do\n          skip \"[#{gcp_project_id} #{region}/#{subnet}] does not support VPC Flow Logs.\"\n        end\n      else\n        describe \"[#{gcp_project_id}] #{region}/#{subnet}\" do\n          subject { subnet_obj }\n          if subnet_obj.methods.include?(:log_config) == true\n            it 'should have logging enabled' do\n              expect(subnet_obj.log_config.enable).to be true\n            end\n          end\n        end\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/3.08-networking.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"[lab-prod-461912] africa-south1/default should have logging enabled","run_time":0.00062766,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] africa-south1/default"},{"status":"failed","code_desc":"[lab-prod-461912] asia-east1/default should have logging enabled","run_time":0.000189248,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] asia-east1/default"},{"status":"failed","code_desc":"[lab-prod-461912] asia-east2/default should have logging enabled","run_time":0.000156123,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] asia-east2/default"},{"status":"failed","code_desc":"[lab-prod-461912] asia-northeast1/default should have logging enabled","run_time":0.00015879,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] asia-northeast1/default"},{"status":"failed","code_desc":"[lab-prod-461912] asia-northeast2/default should have logging enabled","run_time":0.000166748,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] asia-northeast2/default"},{"status":"failed","code_desc":"[lab-prod-461912] asia-northeast3/default should have logging enabled","run_time":0.00012629,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] asia-northeast3/default"},{"status":"failed","code_desc":"[lab-prod-461912] asia-south1/default should have logging enabled","run_time":0.000152665,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] asia-south1/default"},{"status":"failed","code_desc":"[lab-prod-461912] asia-south2/default should have logging enabled","run_time":0.000154373,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] asia-south2/default"},{"status":"failed","code_desc":"[lab-prod-461912] asia-southeast1/default should have logging enabled","run_time":0.000206206,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] asia-southeast1/default"},{"status":"failed","code_desc":"[lab-prod-461912] asia-southeast2/default should have logging enabled","run_time":0.000118249,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] asia-southeast2/default"},{"status":"failed","code_desc":"[lab-prod-461912] australia-southeast1/default should have logging enabled","run_time":0.000124915,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] australia-southeast1/default"},{"status":"failed","code_desc":"[lab-prod-461912] australia-southeast2/default should have logging enabled","run_time":0.000130166,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] australia-southeast2/default"},{"status":"failed","code_desc":"[lab-prod-461912] europe-central2/default should have logging enabled","run_time":0.001380693,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] europe-central2/default"},{"status":"failed","code_desc":"[lab-prod-461912] europe-north1/default should have logging enabled","run_time":0.000180123,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] europe-north1/default"},{"status":"failed","code_desc":"[lab-prod-461912] europe-north2/default should have logging enabled","run_time":0.000136624,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] europe-north2/default"},{"status":"failed","code_desc":"[lab-prod-461912] europe-southwest1/default should have logging enabled","run_time":0.000135957,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] europe-southwest1/default"},{"status":"failed","code_desc":"[lab-prod-461912] europe-west1/default should have logging enabled","run_time":0.000114582,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] europe-west1/default"},{"status":"failed","code_desc":"[lab-prod-461912] europe-west10/default should have logging enabled","run_time":0.000119165,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] europe-west10/default"},{"status":"failed","code_desc":"[lab-prod-461912] europe-west12/default should have logging enabled","run_time":0.000127124,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] europe-west12/default"},{"status":"failed","code_desc":"[lab-prod-461912] europe-west2/default should have logging enabled","run_time":0.000107332,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] europe-west2/default"},{"status":"failed","code_desc":"[lab-prod-461912] europe-west3/default should have logging enabled","run_time":0.000128207,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] europe-west3/default"},{"status":"failed","code_desc":"[lab-prod-461912] europe-west4/default should have logging enabled","run_time":0.000122332,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] europe-west4/default"},{"status":"failed","code_desc":"[lab-prod-461912] europe-west6/default should have logging enabled","run_time":0.000129623,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] europe-west6/default"},{"status":"failed","code_desc":"[lab-prod-461912] europe-west8/default should have logging enabled","run_time":0.000961573,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] europe-west8/default"},{"status":"failed","code_desc":"[lab-prod-461912] europe-west9/default should have logging enabled","run_time":0.000101541,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] europe-west9/default"},{"status":"failed","code_desc":"[lab-prod-461912] me-central1/default should have logging enabled","run_time":8.4749e-05,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] me-central1/default"},{"status":"failed","code_desc":"[lab-prod-461912] me-west1/default should have logging enabled","run_time":9.8582e-05,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] me-west1/default"},{"status":"failed","code_desc":"[lab-prod-461912] northamerica-northeast1/default should have logging enabled","run_time":8.9165e-05,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] northamerica-northeast1/default"},{"status":"failed","code_desc":"[lab-prod-461912] northamerica-northeast2/default should have logging enabled","run_time":0.000240539,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] northamerica-northeast2/default"},{"status":"failed","code_desc":"[lab-prod-461912] northamerica-south1/default should have logging enabled","run_time":0.000153249,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] northamerica-south1/default"},{"status":"failed","code_desc":"[lab-prod-461912] southamerica-east1/default should have logging enabled","run_time":0.000118541,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] southamerica-east1/default"},{"status":"failed","code_desc":"[lab-prod-461912] southamerica-west1/default should have logging enabled","run_time":0.000112541,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] southamerica-west1/default"},{"status":"failed","code_desc":"[lab-prod-461912] us-central1/default should have logging enabled","run_time":0.000119332,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] us-central1/default"},{"status":"failed","code_desc":"[lab-prod-461912] us-east1/default should have logging enabled","run_time":0.000106499,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] us-east1/default"},{"status":"failed","code_desc":"[lab-prod-461912] us-east4/default should have logging enabled","run_time":0.000379371,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] us-east4/default"},{"status":"failed","code_desc":"[lab-prod-461912] us-east5/default should have logging enabled","run_time":0.000120832,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] us-east5/default"},{"status":"failed","code_desc":"[lab-prod-461912] us-south1/default should have logging enabled","run_time":0.000101291,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] us-south1/default"},{"status":"failed","code_desc":"[lab-prod-461912] us-west1/default should have logging enabled","run_time":0.000102124,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] us-west1/default"},{"status":"failed","code_desc":"[lab-prod-461912] us-west2/default should have logging enabled","run_time":0.000112499,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] us-west2/default"},{"status":"failed","code_desc":"[lab-prod-461912] us-west3/default should have logging enabled","run_time":0.000140457,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] us-west3/default"},{"status":"failed","code_desc":"[lab-prod-461912] us-west4/default should have logging enabled","run_time":0.000105415,"start_time":"2025-06-06T12:19:57+00:00","message":"\nexpected true\n     got nil\n","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] us-west4/default"}]},{"id":"cis-gcp-3.9-networking","title":"[NETWORKING] Ensure No HTTPS or SSL Proxy Load Balancers Permit SSL Policies With Weak Cipher Suites","desc":"Secure Sockets Layer (SSL) policies determine what port Transport Layer Security (TLS) features clients are permitted to use when connecting to load balancers. To prevent usage of insecure features, SSL policies should use (a) at least TLS 1.2 with the MODERN profile; or (b) the RESTRICTED profile, because it effectively requires clients to use TLS 1.2 regardless of the chosen minimum TLS version; or (3) a CUSTOM profile that does not support any of the following features: TLS_RSA_WITH_AES_128_GCM_SHA256 TLS_RSA_WITH_AES_256_GCM_SHA384 TLS_RSA_WITH_AES_128_CBC_SHA TLS_RSA_WITH_AES_256_CBC_SHA TLS_RSA_WITH_3DES_EDE_CBC_SHA","descriptions":[{"label":"default","data":"Secure Sockets Layer (SSL) policies determine what port Transport Layer Security (TLS) features clients are permitted to use when connecting to load balancers. To prevent usage of insecure features, SSL policies should use (a) at least TLS 1.2 with the MODERN profile; or (b) the RESTRICTED profile, because it effectively requires clients to use TLS 1.2 regardless of the chosen minimum TLS version; or (3) a CUSTOM profile that does not support any of the following features: TLS_RSA_WITH_AES_128_GCM_SHA256 TLS_RSA_WITH_AES_256_GCM_SHA384 TLS_RSA_WITH_AES_128_CBC_SHA TLS_RSA_WITH_AES_256_CBC_SHA TLS_RSA_WITH_3DES_EDE_CBC_SHA"},{"label":"rationale","data":"Load balancers are used to efficiently distribute traffic across multiple servers. Both SSL proxy and HTTPS load balancers are external load balancers, meaning they distribute traffic from the Internet to a GCP network. GCP customers can configure load balancer SSL policies with a minimum TLS version (1.0, 1.1, or 1.2) that clients can use to establish a connection, along with a profile (Compatible, Modern, Restricted, or Custom) that specifies permissible cipher suites. To comply with users using outdated protocols, GCP load balancers can be configured to permit insecure cipher suites. In fact, the GCP default SSL policy uses a minimum TLS version of 1.0 and a Compatible profile, which allows the widest range of insecure cipher suites. As a result, it is easy for customers to configure a load balancer without even knowing that they are permitting outdated cipher suites."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/load-balancing/docs/use-ssl-policies","ref":"GCP Docs"},{"url":"https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-52r.pdf","ref":"GCP Docs"}],"tags":{"cis_scored":false,"cis_level":1,"cis_gcp":"3.9","cis_version":"4.0","project":"lab-prod-461912","nist":["SC-1"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'low'\n\n  title \"[#{control_abbrev.upcase}] Ensure No HTTPS or SSL Proxy Load Balancers Permit SSL Policies With Weak Cipher Suites\"\n\n  desc 'Secure Sockets Layer (SSL) policies determine what port Transport Layer Security (TLS) features clients are permitted to use when connecting to load balancers. To prevent usage of insecure features, SSL policies should use (a) at least TLS 1.2 with the MODERN profile; or (b) the RESTRICTED profile, because it effectively requires clients to use TLS 1.2 regardless of the chosen minimum TLS version; or (3) a CUSTOM profile that does not support any of the following features: TLS_RSA_WITH_AES_128_GCM_SHA256 TLS_RSA_WITH_AES_256_GCM_SHA384 TLS_RSA_WITH_AES_128_CBC_SHA TLS_RSA_WITH_AES_256_CBC_SHA TLS_RSA_WITH_3DES_EDE_CBC_SHA'\n  desc 'rationale', 'Load balancers are used to efficiently distribute traffic across multiple servers. Both SSL proxy and HTTPS load balancers are external load balancers, meaning they distribute traffic from the Internet to a GCP network. GCP customers can configure load balancer SSL policies with a minimum TLS version (1.0, 1.1, or 1.2) that clients can use to establish a connection, along with a profile (Compatible, Modern, Restricted, or Custom) that specifies permissible cipher suites. To comply with users using outdated protocols, GCP load balancers can be configured to permit insecure cipher suites. In fact, the GCP default SSL policy uses a minimum TLS version of 1.0 and a Compatible profile, which allows the widest range of insecure cipher suites. As a result, it is easy for customers to configure a load balancer without even knowing that they are permitting outdated cipher suites.'\n\n  tag cis_scored: false\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['SC-1']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/load-balancing/docs/use-ssl-policies'\n  ref 'GCP Docs', url: 'https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-52r.pdf'\n\n  # All load balancers have custom/strong TLS profiles set\n\n  gcp_https_proxies.each do |proxy|\n    describe \"[#{gcp_project_id}] HTTPS Proxy: #{proxy}\" do\n      subject { google_compute_target_https_proxy(project: gcp_project_id, name: proxy) }\n      it 'should have a custom SSL policy configured' do\n        expect(subject.ssl_policy).to_not cmp(nil)\n      end\n    end\n  end\n  # Ensure SSL Policies use strong TLS\n  gcp_ssl_policies.each do |policy|\n    case google_compute_ssl_policy(project: gcp_project_id, name: policy).profile\n    when 'MODERN'\n      describe \"[#{gcp_project_id}] SSL Policy: #{policy}\" do\n        subject { google_compute_ssl_policy(project: gcp_project_id, name: policy) }\n        it 'should minimally require TLS 1.2' do\n          expect(subject.min_tls_version).to cmp('TLS_1_2')\n        end\n      end\n\n    when 'RESTRICTED'\n      describe \"[#{gcp_project_id}] SSL Policy: #{policy} profile should be RESTRICTED\" do\n        subject { google_compute_ssl_policy(project: gcp_project_id, name: policy).profile }\n        it { should cmp 'RESTRICTED' }\n      end\n\n    when 'CUSTOM'\n      describe \"[#{gcp_project_id}] SSL Policy: #{policy} profile CUSTOM should not contain these cipher suites [TLS_RSA_WITH_AES_128_GCM_SHA256, TLS_RSA_WITH_AES_256_GCM_SHA384, TLS_RSA_WITH_AES_128_CBC_SHA,  TLS_RSA_WITH_AES_256_CBC_SHA, TLS_RSA_WITH_3DES_EDE_CBC_SHA] \" do\n        subject { google_compute_ssl_policy(project: gcp_project_id, name: policy) }\n        its('custom_features') { should_not be_in %w[TLS_RSA_WITH_AES_128_GCM_SHA256 TLS_RSA_WITH_AES_256_GCM_SHA384 TLS_RSA_WITH_AES_128_CBC_SHA TLS_RSA_WITH_AES_256_CBC_SHA TLS_RSA_WITH_3DES_EDE_CBC_SHA] }\n      end\n    end\n  end\n\n  if gcp_https_proxies.empty? && gcp_ssl_policies.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] No HTTPS or SSL proxy load balancers found. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] No HTTPS or SSL proxy load balancers found\"\n    end\n  end\nend\n","source_location":{"line":26,"ref":"./controls/3.09-networking.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] No HTTPS or SSL proxy load balancers found. This test is Not Applicable.","run_time":1.3458e-05,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] No HTTPS or SSL proxy load balancers found","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] No HTTPS or SSL proxy load balancers found. This test is Not Applicable."}]},{"id":"cis-gcp-3.10-networking","title":"[NETWORKING] Use Identity Aware Proxy (IAP) to Ensure Only Traffic From Google IP Addresses are Allowed","desc":"IAP authenticates the user requests to your apps via a Google single sign in. You can then manage these users with permissions to control access. It is recommended to use both IAP permissions and firewalls to restrict this access to your apps with sensitive information.","descriptions":[{"label":"default","data":"IAP authenticates the user requests to your apps via a Google single sign in. You can then manage these users with permissions to control access. It is recommended to use both IAP permissions and firewalls to restrict this access to your apps with sensitive information."},{"label":"rationale","data":"IAP ensure that access to VMs is controlled by authenticating incoming requests. Access to your apps and the VMs should be restricted by firewall rules that allow only the proxy IAP IP addresses contained in the 35.235.240.0/20 subnet. Otherwise, unauthenticated requests can be made to your apps. To ensure that load balancing works correctly health checks should also be allowed."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/iap","ref":"GCP Docs"},{"url":"https://cloud.google.com/iap/docs/load-balancer-howto","ref":"GCP Docs"},{"url":"https://cloud.google.com/load-balancing/docs/health-checks","ref":"GCP Docs"},{"url":"https://cloud.google.com/blog/products/identity-security/cloud-iap-enables-context-aware-access-to-vms-via-ssh-and-rdp-without-bastion-hosts","ref":"GCP Docs"}],"tags":{"cis_scored":false,"cis_level":2,"cis_gcp":"3.10","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-1"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n  title \"[#{control_abbrev.upcase}] Use Identity Aware Proxy (IAP) to Ensure Only Traffic From Google IP Addresses are Allowed\"\n  desc 'IAP authenticates the user requests to your apps via a Google single sign in. You can then manage these users with permissions to control access. It is recommended to use both IAP permissions and firewalls to restrict this access to your apps with sensitive information.'\n  desc 'rationale', 'IAP ensure that access to VMs is controlled by authenticating incoming requests. Access to your apps and the VMs should be restricted by firewall rules that allow only the proxy IAP IP addresses contained in the 35.235.240.0/20 subnet. Otherwise, unauthenticated requests can be made to your apps. To ensure that load balancing works correctly health checks should also be allowed.'\n\n  tag cis_scored: false\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-1']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/iap'\n  ref 'GCP Docs', url: 'https://cloud.google.com/iap/docs/load-balancer-howto'\n  ref 'GCP Docs', url: 'https://cloud.google.com/load-balancing/docs/health-checks'\n  ref 'GCP Docs', url: 'https://cloud.google.com/blog/products/identity-security/cloud-iap-enables-context-aware-access-to-vms-via-ssh-and-rdp-without-bastion-hosts'\n\n  describe 'This control is not scored' do\n    skip 'This control is not scored'\n  end\nend\n","source_location":{"line":23,"ref":"./controls/3.10-networking.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This control is not scored","run_time":5.5e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"This control is not scored","resource_class":"Object","resource_params":"[]","resource_id":"This control is not scored"}]},{"id":"cis-gcp-4.1-vms","title":"[VMS] Ensure that instances are not configured to use the default compute engine service account with full access to all Cloud APIs","desc":"To support principle of least privileges and prevent potential privilege escalation it is recommended that instances are not assigned to default service account Compute Engine default service account","descriptions":[{"label":"default","data":"To support principle of least privileges and prevent potential privilege escalation it is recommended that instances are not assigned to default service account Compute Engine default service account"},{"label":"rationale","data":"The default Compute Engine service account has the Editor role on the project, which allows read and write access to most Google Cloud Services. To defend against privilege escalations if your VM is compromised and prevent an attacker from gaining access to all of your project, it is recommended to not use the default Compute Engine service account. Instead, you should create a new service account and assigning only the permissions needed by your instance."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/compute/docs/access/create-enable-service-accounts-for-instances","ref":"GCP Docs"},{"url":"https://cloud.google.com/compute/docs/access/service-accounts","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"4.1","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2","AC-6"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure that instances are not configured to use the default compute engine service account with full access to all Cloud APIs\"\n\n  desc 'To support principle of least privileges and prevent potential privilege escalation it is recommended that instances are not assigned to default service account Compute Engine default service account'\n  desc 'rationale', 'The default Compute Engine service account has the Editor role on the project, which allows read and write access to most Google Cloud Services. To defend against privilege escalations if your VM is compromised and prevent an attacker from gaining access to all of your project, it is recommended to not use the default Compute Engine service account. Instead, you should create a new service account and assigning only the permissions needed by your instance.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[AC-2 AC-6]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/access/create-enable-service-accounts-for-instances'\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/access/service-accounts'\n\n  project_number = google_project(project: gcp_project_id).project_number\n  gce_instances.each do |instance|\n    next if instance[:name] =~ /^gke-/\n    google_compute_instance(project: gcp_project_id, zone: instance[:zone], name: instance[:name]).service_accounts.each do |serviceaccount|\n      describe \"VM #{instance[:name]} should not include the default compute engine service account\" do\n        subject { serviceaccount.email }\n        it { should_not include(\"#{project_number}-compute@developer.gserviceaccount.com\") }\n      end\n    end\n  end\n\n  if gce_instances.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] No Google Compute Engine instances were found. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] No Google Compute Engine instances were found\"\n    end\n  end\nend\n","source_location":{"line":26,"ref":"./controls/4.01-vms.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] No Google Compute Engine instances were found. This test is Not Applicable.","run_time":4.458e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] No Google Compute Engine instances were found","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] No Google Compute Engine instances were found. This test is Not Applicable."}]},{"id":"cis-gcp-4.2-vms","title":"[VMS] Ensure that instances are not configured to use the default service account with full access to all Cloud APIs","desc":"To support principle of least privileges and prevent potential privilege escalation it is recommended that instances are not assigned to default service account Compute Engine default service account with Scope Allow full access to all Cloud APIs.","descriptions":[{"label":"default","data":"To support principle of least privileges and prevent potential privilege escalation it is recommended that instances are not assigned to default service account Compute Engine default service account with Scope Allow full access to all Cloud APIs."},{"label":"rationale","data":"Along with ability to optionally create, manage and use user managed custom service accounts, Google Compute Engine provides default service account Compute Engine default service account for an instances to access necessary cloud services. Project Editor role is assigned to Compute Engine default service account hence, This service account has almost all capabilities over all cloud services except billing. However, when Compute Engine default service account assigned to an instance it can operate in 3 scopes.\n\n1. Allow default access: Allows only minimum access required to run an Instance (Least Privileges)\n2. Allow full access to all Cloud APIs: Allow full access to all the cloud APIs/Services (Too much access)\n3. Set access for each API: Allows Instance administrator to choose only those APIs that are needed to perform specific business functionality expected by instance\n\nWhen an instance is configured with Compute Engine default service account with Scope Allow full access to all Cloud APIs, based on IAM roles assigned to the user(s) accessing Instance, it may allow user to perform cloud operations/API calls that user is not supposed to perform leading to successful privilege escalation."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/compute/docs/access/create-enable-service-accounts-for-instances","ref":"GCP Docs"},{"url":"https://cloud.google.com/compute/docs/access/service-accounts","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"4.2","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2","AC-6"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure that instances are not configured to use the default service account with full access to all Cloud APIs\"\n\n  desc 'To support principle of least privileges and prevent potential privilege escalation it is recommended that instances are not assigned to default service account Compute Engine default service account with Scope Allow full access to all Cloud APIs.'\n  desc 'rationale', \"Along with ability to optionally create, manage and use user managed custom service accounts, Google Compute Engine provides default service account Compute Engine default service account for an instances to access necessary cloud services. Project Editor role is assigned to Compute Engine default service account hence, This service account has almost all capabilities over all cloud services except billing. However, when Compute Engine default service account assigned to an instance it can operate in 3 scopes.\n\n1. Allow default access: Allows only minimum access required to run an Instance (Least Privileges)\n2. Allow full access to all Cloud APIs: Allow full access to all the cloud APIs/Services (Too much access)\n3. Set access for each API: Allows Instance administrator to choose only those APIs that are needed to perform specific business functionality expected by instance\n\nWhen an instance is configured with Compute Engine default service account with Scope Allow full access to all Cloud APIs, based on IAM roles assigned to the user(s) accessing Instance, it may allow user to perform cloud operations/API calls that user is not supposed to perform leading to successful privilege escalation.\"\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[AC-2 AC-6]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/access/create-enable-service-accounts-for-instances'\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/access/service-accounts'\n\n  project_number = google_project(project: gcp_project_id).project_number\n  gce_instances.each do |instance|\n    next if instance[:name] =~ /^gke-/\n    google_compute_instance(project: gcp_project_id, zone: instance[:zone], name: instance[:name]).service_accounts.each do |serviceaccount|\n      next if serviceaccount.email != \"#{project_number}-compute@developer.gserviceaccount.com\"\n      describe \"[#{gcp_project_id}] Instance #{instance[:zone]}/#{instance[:name]}\" do\n        subject { serviceaccount.scopes }\n        it { should_not include 'https://www.googleapis.com/auth/cloud-platform' }\n      end\n    end\n  end\n\n  if gce_instances.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] No Google Compute Engine instances were found. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] No Google Compute Engine instances were found\"\n    end\n  end\nend\n","source_location":{"line":26,"ref":"./controls/4.02-vms.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] No Google Compute Engine instances were found. This test is Not Applicable.","run_time":1.8917e-05,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] No Google Compute Engine instances were found","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] No Google Compute Engine instances were found. This test is Not Applicable."}]},{"id":"cis-gcp-4.3-vms","title":"[VMS] Ensure 'Block Project-wide SSH keys' enabled for VM instances","desc":"It is recommended to user Instance specific SSH key(s) instead of using common/shared project-wide SSH key(s) to access Instances.","descriptions":[{"label":"default","data":"It is recommended to user Instance specific SSH key(s) instead of using common/shared project-wide SSH key(s) to access Instances."},{"label":"rationale","data":"Project-wide SSH keys are stored in Compute/Project-meta-data. Project wide SSH keys can be used to login into all the instances within project. Using project-wide SSH keys eases the SSH key management but if compromised, poses the security risk which can impact all the instances within project. It is recommended to use Instance specific SSH keys which can limit the attack surface if the SSH keys are compromised."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/compute/docs/instances/adding-removing-ssh-keys","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"4.3","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure 'Block Project-wide SSH keys' enabled for VM instances\"\n\n  desc 'It is recommended to user Instance specific SSH key(s) instead of using common/shared project-wide SSH key(s) to access Instances.'\n  desc 'rationale', 'Project-wide SSH keys are stored in Compute/Project-meta-data. Project wide SSH keys can be used to login into all the instances within project. Using project-wide SSH keys eases the SSH key management but if compromised, poses the security risk which can impact all the instances within project. It is recommended to use Instance specific SSH keys which can limit the attack surface if the SSH keys are compromised.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-2']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/instances/adding-removing-ssh-keys'\n\n  gce_instances.each do |instance|\n    next if instance[:name] =~ /^gke-/\n    describe \"[#{gcp_project_id}] Instance #{instance[:zone]}/#{instance[:name]}\" do\n      subject { google_compute_instance(project: gcp_project_id, zone: instance[:zone], name: instance[:name]) }\n      its('block_project_ssh_keys') { should be true }\n    end\n  end\n\n  if gce_instances.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] No Google Compute Engine instances were found. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] No Google Compute Engine instances were found\"\n    end\n  end\nend\n","source_location":{"line":26,"ref":"./controls/4.03-vms.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] No Google Compute Engine instances were found. This test is Not Applicable.","run_time":4.542e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] No Google Compute Engine instances were found","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] No Google Compute Engine instances were found. This test is Not Applicable."}]},{"id":"cis-gcp-4.4-vms","title":"[VMS] Ensure oslogin is enabled for a Project","desc":"Enabling OS login binds SSH certificates to IAM users and facilitates effective SSH certificate management.","descriptions":[{"label":"default","data":"Enabling OS login binds SSH certificates to IAM users and facilitates effective SSH certificate management."},{"label":"rationale","data":"Enabling osLogin ensures that SSH keys used to connect to instances are mapped with IAM users. Revoking access to IAM user will revoke all the SSH keys associated with that particular user. It facilitates centralized and automated SSH key pair management which is useful in handling cases like response to compromised SSH key pairs and/or revocation of external/third-party/Vendor users."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/compute/docs/instances/managing-instance-access","ref":"GCP Docs"},{"url":"https://cloud.google.com/compute/docs/instances/managing-instance-access#enable_oslogin","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"4.4","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure oslogin is enabled for a Project\"\n\n  desc 'Enabling OS login binds SSH certificates to IAM users and facilitates effective SSH certificate management.'\n  desc 'rationale', 'Enabling osLogin ensures that SSH keys used to connect to instances are mapped with IAM users. Revoking access to IAM user will revoke all the SSH keys associated with that particular user. It facilitates centralized and automated SSH key pair management which is useful in handling cases like response to compromised SSH key pairs and/or revocation of external/third-party/Vendor users.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-2']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/instances/managing-instance-access'\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/instances/managing-instance-access#enable_oslogin'\n\n  describe \"[#{gcp_project_id}]\" do\n    subject { google_compute_project_info(project: gcp_project_id) }\n    it { should have_enabled_oslogin }\n  end\nend\n","source_location":{"line":23,"ref":"./controls/4.04-vms.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"[lab-prod-461912] is expected to have enabled oslogin","run_time":0.597660298,"start_time":"2025-06-06T12:19:57+00:00","message":"expected `ProjectInfo lab-prod-461912.has_enabled_oslogin?` to be truthy, got false","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912]"}]},{"id":"cis-gcp-4.5-vms","title":"[VMS] Ensure 'Enable connecting to serial ports' is not enabled for VM Instance","desc":"Interacting with a serial port is often referred to as the serial console, which is similar to using a terminal window, in that input and output is entirely in text mode and there is no graphical interface or mouse support.\n\nIf you enable the interactive serial console on an instance, clients can attempt to connect to that instance from any IP address. Therefore interactive serial console support should be disabled.","descriptions":[{"label":"default","data":"Interacting with a serial port is often referred to as the serial console, which is similar to using a terminal window, in that input and output is entirely in text mode and there is no graphical interface or mouse support.\n\nIf you enable the interactive serial console on an instance, clients can attempt to connect to that instance from any IP address. Therefore interactive serial console support should be disabled."},{"label":"rationale","data":"A virtual machine instance has four virtual serial ports. Interacting with a serial port is similar to using a terminal window, in that input and output is entirely in text mode and there is no graphical interface or mouse support. The instance's operating system, BIOS, and other system-level entities often write output to the serial ports, and can accept input such as commands or answers to prompts. Typically, these system-level entities use the first serial port (port 1) and serial port 1 is often referred to as the serial console.\n\nThe interactive serial console does not support IP-based access restrictions such as IP whitelists. If you enable the interactive serial console on an instance, clients can attempt to connect to that instance from any IP address. This allows anybody to connect to that instance if they know the correct SSH key, username, project ID, zone, and instance name.\n\nTherefore interactive serial console support should be disabled."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/compute/docs/instances/interacting-with-serial-console","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"4.5","cis_version":"4.0","project":"lab-prod-461912","nist":["CM-7"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure 'Enable connecting to serial ports' is not enabled for VM Instance\"\n\n  desc \"Interacting with a serial port is often referred to as the serial console, which is similar to using a terminal window, in that input and output is entirely in text mode and there is no graphical interface or mouse support.\n\nIf you enable the interactive serial console on an instance, clients can attempt to connect to that instance from any IP address. Therefore interactive serial console support should be disabled.\"\n  desc 'rationale', \"A virtual machine instance has four virtual serial ports. Interacting with a serial port is similar to using a terminal window, in that input and output is entirely in text mode and there is no graphical interface or mouse support. The instance's operating system, BIOS, and other system-level entities often write output to the serial ports, and can accept input such as commands or answers to prompts. Typically, these system-level entities use the first serial port (port 1) and serial port 1 is often referred to as the serial console.\n\nThe interactive serial console does not support IP-based access restrictions such as IP whitelists. If you enable the interactive serial console on an instance, clients can attempt to connect to that instance from any IP address. This allows anybody to connect to that instance if they know the correct SSH key, username, project ID, zone, and instance name.\n\nTherefore interactive serial console support should be disabled.\"\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['CM-7']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/instances/interacting-with-serial-console'\n\n  gce_instances.each do |instance|\n    describe \"[#{gcp_project_id}] Instance #{instance[:zone]}/#{instance[:name]}\" do\n      subject { google_compute_instance(project: gcp_project_id, zone: instance[:zone], name: instance[:name]) }\n      it { should have_serial_port_disabled }\n    end\n  end\n\n  if gce_instances.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] No Google Compute Engine instances were found. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] No Google Compute Engine instances were found\"\n    end\n  end\nend\n","source_location":{"line":26,"ref":"./controls/4.05-vms.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] No Google Compute Engine instances were found. This test is Not Applicable.","run_time":1.85e-05,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] No Google Compute Engine instances were found","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] No Google Compute Engine instances were found. This test is Not Applicable."}]},{"id":"cis-gcp-4.6-vms","title":"[VMS] Ensure that IP forwarding is not enabled on Instances","desc":"Compute Engine instance cannot forward a packet unless the source IP address of the packet matches the IP address of the instance. Similarly, GCP won't deliver a packet whose destination IP address is different than the IP address of the instance receiving the packet.  However, both capabilities are required if you want to use instances to help route packets.  Forwarding of data packets should be disabled to prevent data loss or information disclosure.","descriptions":[{"label":"default","data":"Compute Engine instance cannot forward a packet unless the source IP address of the packet matches the IP address of the instance. Similarly, GCP won't deliver a packet whose destination IP address is different than the IP address of the instance receiving the packet.  However, both capabilities are required if you want to use instances to help route packets.  Forwarding of data packets should be disabled to prevent data loss or information disclosure."},{"label":"rationale","data":"Compute Engine instance cannot forward a packet unless the source IP address of the packet matches the IP address of the instance. Similarly, GCP won't deliver a packet whose destination IP address is different than the IP address of the instance receiving the packet.  However, both capabilities are required if you want to use instances to help route packets.  To enable this source and destination IP check, disable the canIpForward field, which allows an instance to send and receive packets with non-matching destination or source IPs."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/compute/docs/networking#canipforward","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"4.6","cis_version":"4.0","project":"lab-prod-461912","nist":["CM-6","CM-8"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure that IP forwarding is not enabled on Instances\"\n\n  desc \"Compute Engine instance cannot forward a packet unless the source IP address of the packet matches the IP address of the instance. Similarly, GCP won't deliver a packet whose destination IP address is different than the IP address of the instance receiving the packet.  However, both capabilities are required if you want to use instances to help route packets.  Forwarding of data packets should be disabled to prevent data loss or information disclosure.\"\n  desc 'rationale', \"Compute Engine instance cannot forward a packet unless the source IP address of the packet matches the IP address of the instance. Similarly, GCP won't deliver a packet whose destination IP address is different than the IP address of the instance receiving the packet.  However, both capabilities are required if you want to use instances to help route packets.  To enable this source and destination IP check, disable the canIpForward field, which allows an instance to send and receive packets with non-matching destination or source IPs.\"\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[CM-6 CM-8]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/networking#canipforward'\n\n  gce_instances.each do |instance|\n    next if instance[:name] =~ /^gke-/\n    gce = google_compute_instance(project: gcp_project_id, zone: instance[:zone], name: instance[:name])\n    describe.one do\n      describe \"[#{gcp_project_id}] Instance #{instance[:zone]}/#{instance[:name]}\" do\n        subject { gce }\n        its('can_ip_forward') { should be false }\n      end\n      describe \"[#{gcp_project_id}] Instance #{instance[:zone]}/#{instance[:name]} ip-forwarding disabled\" do\n        subject { gce }\n        it { should exist }\n      end\n    end\n  end\n\n  if gce_instances.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] No Google Compute Engine instances were found. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] No Google Compute Engine instances were found\"\n    end\n  end\nend\n","source_location":{"line":26,"ref":"./controls/4.06-vms.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] No Google Compute Engine instances were found. This test is Not Applicable.","run_time":4.875e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] No Google Compute Engine instances were found","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] No Google Compute Engine instances were found. This test is Not Applicable."}]},{"id":"cis-gcp-4.7-vms","title":"[VMS] Ensure VM disks for critical VMs are encrypted with CustomerSupplied Encryption Keys (CSEK)","desc":"Customer-Supplied Encryption Keys (CSEK) are a feature in Google Cloud Storage and Google Compute Engine. If you supply your own encryption keys, Google uses your key to protect the Google-generated keys used to encrypt and decrypt your data. By default, Google Compute Engine encrypts all data at rest. Compute Engine handles and manages this encryption for you without any additional actions on your part. However, if you wanted to control and manage this encryption yourself, you can provide your own encryption keys.","descriptions":[{"label":"default","data":"Customer-Supplied Encryption Keys (CSEK) are a feature in Google Cloud Storage and Google Compute Engine. If you supply your own encryption keys, Google uses your key to protect the Google-generated keys used to encrypt and decrypt your data. By default, Google Compute Engine encrypts all data at rest. Compute Engine handles and manages this encryption for you without any additional actions on your part. However, if you wanted to control and manage this encryption yourself, you can provide your own encryption keys."},{"label":"rationale","data":"By default, Google Compute Engine encrypts all data at rest. Compute Engine handles and manages this encryption for you without any additional actions on your part. However, if you wanted to control and manage this encryption yourself, you can provide your own encryption keys.\n\nIf you provide your own encryption keys, Compute Engine uses your key to protect the Google-generated keys used to encrypt and decrypt your data. Only users who can provide the correct key can use resources protected by a customer-supplied encryption key.\n\nGoogle does not store your keys on its servers and cannot access your protected data unless you provide the key. This also means that if you forget or lose your key, there is no way for Google to recover the key or to recover any data encrypted with the lost key.\n\nAt least business critical VMs should have VM disks encrypted with CSEK."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/compute/docs/disks/customer-supplied-encryption#encrypt_a_new_persistent_disk_with_your_own_keys","ref":"GCP Docs"},{"url":"https://cloud.google.com/compute/docs/reference/rest/v1/disks/get","ref":"GCP Docs"},{"url":"https://cloud.google.com/compute/docs/disks/customer-supplied-encryption#key_file","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"4.7","cis_version":"4.0","project":"lab-prod-461912","nist":["SC-1"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure VM disks for critical VMs are encrypted with CustomerSupplied Encryption Keys (CSEK)\"\n\n  desc 'Customer-Supplied Encryption Keys (CSEK) are a feature in Google Cloud Storage and Google Compute Engine. If you supply your own encryption keys, Google uses your key to protect the Google-generated keys used to encrypt and decrypt your data. By default, Google Compute Engine encrypts all data at rest. Compute Engine handles and manages this encryption for you without any additional actions on your part. However, if you wanted to control and manage this encryption yourself, you can provide your own encryption keys.'\n  desc 'rationale', \"By default, Google Compute Engine encrypts all data at rest. Compute Engine handles and manages this encryption for you without any additional actions on your part. However, if you wanted to control and manage this encryption yourself, you can provide your own encryption keys.\n\nIf you provide your own encryption keys, Compute Engine uses your key to protect the Google-generated keys used to encrypt and decrypt your data. Only users who can provide the correct key can use resources protected by a customer-supplied encryption key.\n\nGoogle does not store your keys on its servers and cannot access your protected data unless you provide the key. This also means that if you forget or lose your key, there is no way for Google to recover the key or to recover any data encrypted with the lost key.\n\nAt least business critical VMs should have VM disks encrypted with CSEK.\"\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['SC-1']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/disks/customer-supplied-encryption#encrypt_a_new_persistent_disk_with_your_own_keys'\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/reference/rest/v1/disks/get'\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/disks/customer-supplied-encryption#key_file'\n\n  gce_instances.each do |instance|\n    next if instance[:name] =~ /^gke-/\n    describe \"[#{gcp_project_id}] Instance #{instance[:zone]}/#{instance[:name]}\" do\n      subject { google_compute_instance(project: gcp_project_id, zone: instance[:zone], name: instance[:name]) }\n      it { should have_disks_encrypted_with_csek }\n    end\n  end\n\n  if gce_instances.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] No Google Compute Engine instances were found. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] No Google Compute Engine instances were found\"\n    end\n  end\nend\n","source_location":{"line":26,"ref":"./controls/4.07-vms.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] No Google Compute Engine instances were found. This test is Not Applicable.","run_time":6.75e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] No Google Compute Engine instances were found","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] No Google Compute Engine instances were found. This test is Not Applicable."}]},{"id":"cis-gcp-4.8-vms","title":"[VMS] Ensure Compute instances are launched with Shielded VM enabled","desc":"To defend against against advanced threats and ensure that the boot loader and firmware\n  on your VMs are signed and untampered, it is recommended that Compute instances are\n  launched with Shielded VM enabled.","descriptions":[{"label":"default","data":"To defend against against advanced threats and ensure that the boot loader and firmware\n  on your VMs are signed and untampered, it is recommended that Compute instances are\n  launched with Shielded VM enabled."},{"label":"rationale","data":"Shielded VMs are virtual machines (VMs) on Google Cloud Platform hardened by a set of\n  security controls that help defend against rootkits and bootkits.\n  Shielded VM offers verifiable integrity of your Compute Engine VM instances, so you can be\n  confident your instances haven't been compromised by boot- or kernel-level malware or\n  rootkits. Shielded VM's verifiable integrity is achieved through the use of Secure Boot,\n  virtual trusted platform module (vTPM)-enabled Measured Boot, and integrity monitoring.\n  Shielded VM instances run firmware which is signed and verified using Google's Certificate\n  Authority, ensuring that the instance's firmware is unmodified and establishing the root of\n  trust for Secure Boot.\n  Integrity monitoring helps you understand and make decisions about the state of your VM\n  instances and the Shielded VM vTPM enables Measured Boot by performing the\n  measurements needed to create a known good boot baseline, called the integrity policy\n  baseline. The integrity policy baseline is used for comparison with measurements from\n  subsequent VM boots to determine if anything has changed.\n  Secure Boot helps ensure that the system only runs authentic software by verifying the\n  digital signature of all boot components, and halting the boot process if signature\n  verification fails."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/compute/docs/instances/modifying-shielded-vm","ref":"GCP Docs"},{"url":"https://cloud.google.com/shielded-vm","ref":"GCP Docs"},{"url":"https://cloud.google.com/security/shielded-cloud/shielded-vm#organization-policy-constraint","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"4.8","cis_version":"4.0","project":"lab-prod-461912","nist":["SC-1"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure Compute instances are launched with Shielded VM enabled\"\n\n  desc 'To defend against against advanced threats and ensure that the boot loader and firmware\n  on your VMs are signed and untampered, it is recommended that Compute instances are\n  launched with Shielded VM enabled.'\n  desc 'rationale', \"Shielded VMs are virtual machines (VMs) on Google Cloud Platform hardened by a set of\n  security controls that help defend against rootkits and bootkits.\n  Shielded VM offers verifiable integrity of your Compute Engine VM instances, so you can be\n  confident your instances haven't been compromised by boot- or kernel-level malware or\n  rootkits. Shielded VM's verifiable integrity is achieved through the use of Secure Boot,\n  virtual trusted platform module (vTPM)-enabled Measured Boot, and integrity monitoring.\n  Shielded VM instances run firmware which is signed and verified using Google's Certificate\n  Authority, ensuring that the instance's firmware is unmodified and establishing the root of\n  trust for Secure Boot.\n  Integrity monitoring helps you understand and make decisions about the state of your VM\n  instances and the Shielded VM vTPM enables Measured Boot by performing the\n  measurements needed to create a known good boot baseline, called the integrity policy\n  baseline. The integrity policy baseline is used for comparison with measurements from\n  subsequent VM boots to determine if anything has changed.\n  Secure Boot helps ensure that the system only runs authentic software by verifying the\n  digital signature of all boot components, and halting the boot process if signature\n  verification fails.\"\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['SC-1']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/instances/modifying-shielded-vm'\n  ref 'GCP Docs', url: 'https://cloud.google.com/shielded-vm'\n  ref 'GCP Docs', url: 'https://cloud.google.com/security/shielded-cloud/shielded-vm#organization-policy-constraint'\n\n  gce_instances.each do |instance|\n    instance_object = google_compute_instance(project: gcp_project_id, zone: instance[:zone], name: instance[:name])\n    describe \"[#{gcp_project_id}] Instance #{instance[:zone]}/#{instance[:name]}\" do\n      if instance_object.shielded_instance_config.nil?\n        it 'should have a shielded instance config' do\n          expect(false).to be true\n        end\n      else\n        it 'should have secure boot enabled' do\n          expect(instance_object.shielded_instance_config.enable_secure_boot).to be true\n        end\n        it 'should have integrity monitoring enabled' do\n          expect(instance_object.shielded_instance_config.enable_integrity_monitoring).to be true\n        end\n        it 'should have virtual trusted platform module (vTPM) enabled' do\n          expect(instance_object.shielded_instance_config.enable_vtpm).to be true\n        end\n      end\n    end\n  end\n\n  if gce_instances.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] No Google Compute Engine instances were found. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] No Google Compute Engine instances were found\"\n    end\n  end\nend\n","source_location":{"line":26,"ref":"./controls/4.08-vms.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] No Google Compute Engine instances were found. This test is Not Applicable.","run_time":5.459e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] No Google Compute Engine instances were found","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] No Google Compute Engine instances were found. This test is Not Applicable."}]},{"id":"cis-gcp-4.09-vms","title":"[VMS] Ensure That Compute Instances Do Not Have Public IP Addresses (Automated)","desc":"Compute instances should not be configured to have external IP addresses. Removing the external IP address from your Compute instance may cause some applications to stop working.","descriptions":[{"label":"default","data":"Compute instances should not be configured to have external IP addresses. Removing the external IP address from your Compute instance may cause some applications to stop working."},{"label":"rationale","data":"To reduce your attack surface, Compute instances should not have public IP addresses. Instead, instances should be configured behind load balancers, to minimize the instance's exposure to the internet."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/load-balancing/docs/backend-service#backends_and_external_ip_addresses","ref":"GCP Docs"},{"url":"https://cloud.google.com/compute/docs/instances/connecting-advanced#sshbetweeninstances","ref":"GCP Docs"},{"url":"https://cloud.google.com/compute/docs/instances/connecting-to-instance","ref":"GCP Docs"},{"url":"https://cloud.google.com/compute/docs/ip-addresses/reserve-static-external-ip-address#unassign_ip","ref":"GCP Docs"},{"url":"https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints","ref":"GCP Docs"},{"url":"https://console.cloud.google.com/orgpolicies/compute-vmExternalIpAccess","ref":"Organization Policy"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"4.09","cis_version":"4.0","project":"lab-prod-461912","nist":[]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure That Compute Instances Do Not Have Public IP Addresses (Automated)\"\n\n  desc 'Compute instances should not be configured to have external IP addresses. Removing the external IP address from your Compute instance may cause some applications to stop working.'\n  desc 'rationale', \"To reduce your attack surface, Compute instances should not have public IP addresses. Instead, instances should be configured behind load balancers, to minimize the instance's exposure to the internet.\"\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[] # Add relevant NIST controls if any in future\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/load-balancing/docs/backend-service#backends_and_external_ip_addresses'\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/instances/connecting-advanced#sshbetweeninstances'\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/instances/connecting-to-instance'\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/docs/ip-addresses/reserve-static-external-ip-address#unassign_ip'\n  ref 'GCP Docs', url: 'https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints'\n  ref 'Organization Policy', url: 'https://console.cloud.google.com/orgpolicies/compute-vmExternalIpAccess'\n\n  # control_id and control_abbrev are already defined above\n\n  instances_found = false\n  google_compute_zones(project: gcp_project_id).zone_names.each do |zone_name|\n    google_compute_instances(project: gcp_project_id, zone: zone_name).where { instance_name !~ /^gke-/ }.where(status: 'RUNNING').instance_names.each do |instance_name|\n      instances_found = true\n      describe \"[#{gcp_project_id}] Instance: #{instance_name} in Zone: #{zone_name}\" do\n        subject { google_compute_instance(project: gcp_project_id, zone: zone_name, name: instance_name) }\n        its('public_ip_configured?') { should be false }\n      end\n    end\n  end\n\n  unless instances_found\n    describe \"[#{control_abbrev.upcase}] #{control_id} - No Non-GKE Running Instances Found\" do\n      skip 'No non-GKE running compute instances were found in the project, this control is Not Applicable.'\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/4.09-vms.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[VMS] 4.09 - No Non-GKE Running Instances Found","run_time":5.458e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"No non-GKE running compute instances were found in the project, this control is Not Applicable.","resource_class":"Object","resource_params":"[]","resource_id":"[VMS] 4.09 - No Non-GKE Running Instances Found"}]},{"id":"cis-gcp-4.10-vms","title":"[VMS] Ensure That App Engine Applications Enforce HTTPS Connections (Manual)","desc":"In order to maintain the highest level of security all connections to an application should be secure by default.","descriptions":[{"label":"default","data":"In order to maintain the highest level of security all connections to an application should be secure by default."},{"label":"rationale","data":"Insecure HTTP connections maybe subject to eavesdropping which can expose sensitive data. All connections to appengine will automatically be redirected to the HTTPS endpoint ensuring that all connections are secured by TLS."}],"impact":0.1,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/appengine/docs/standard/python3/config/appref","ref":"GCP App Engine Docs"},{"url":"https://cloud.google.com/appengine/docs/flexible/nodejs/configuring-your-app-with-app-yaml","ref":"GCP App Engine Docs (Flexible)"}],"tags":{"cis_scored":false,"cis_level":2,"cis_gcp":"4.10","cis_version":"4.0","project":"lab-prod-461912","nist":[]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'low'\n\n  title \"[#{control_abbrev.upcase}] Ensure That App Engine Applications Enforce HTTPS Connections (Manual)\"\n\n  desc 'In order to maintain the highest level of security all connections to an application should be secure by default.'\n  desc 'rationale', 'Insecure HTTP connections maybe subject to eavesdropping which can expose sensitive data. All connections to appengine will automatically be redirected to the HTTPS endpoint ensuring that all connections are secured by TLS.'\n\n  tag cis_scored: false\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[] # Add relevant NIST controls if any in future\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP App Engine Docs', url: 'https://cloud.google.com/appengine/docs/standard/python3/config/appref'\n  ref 'GCP App Engine Docs (Flexible)', url: 'https://cloud.google.com/appengine/docs/flexible/nodejs/configuring-your-app-with-app-yaml'\n\n  describe 'This control is not scored' do\n    skip 'This control is not scored'\n  end\nend\n","source_location":{"line":23,"ref":"./controls/4.10-vms.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This control is not scored","run_time":5.417e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"This control is not scored","resource_class":"Object","resource_params":"[]","resource_id":"This control is not scored"}]},{"id":"cis-gcp-4.11-vms","title":"[VMS] Ensure That Compute Instances Have Confidential Computing Enabled (Automated)","desc":"Google Cloud encrypts data at-rest and in-transit, but customer data must be decrypted for processing. Confidential Computing is a breakthrough technology that encrypts data in-use while it is being processed. Confidential Computing environments keep data encrypted in memory and elsewhere outside the central processing unit (CPU). Confidential VMs leverage hardware-based memory encryption technologies... Customer data will stay encrypted while it is used, indexed, queried, or trained on. Encryption keys are generated by and reside solely in dedicated hardware and are not exportable, enhancing isolation and security. Built-in hardware optimizations ensure Confidential Computing workloads experience minimal to no significant performance penalties.","descriptions":[{"label":"default","data":"Google Cloud encrypts data at-rest and in-transit, but customer data must be decrypted for processing. Confidential Computing is a breakthrough technology that encrypts data in-use while it is being processed. Confidential Computing environments keep data encrypted in memory and elsewhere outside the central processing unit (CPU). Confidential VMs leverage hardware-based memory encryption technologies... Customer data will stay encrypted while it is used, indexed, queried, or trained on. Encryption keys are generated by and reside solely in dedicated hardware and are not exportable, enhancing isolation and security. Built-in hardware optimizations ensure Confidential Computing workloads experience minimal to no significant performance penalties."},{"label":"rationale","data":"Confidential Computing enables customers' sensitive code and other data encrypted in memory during processing. Google does not have access to the encryption keys. Confidential VM can help alleviate concerns about risk related to either dependency on Google infrastructure or Google insiders' access to customer data in the clear."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/compute/confidential-vm/docs/creating-cvm-instance","ref":"GCP Docs"},{"url":"https://cloud.google.com/compute/confidential-vm/docs/about-cvm","ref":"GCP Docs"},{"url":"https://cloud.google.com/confidential-computing","ref":"GCP Docs"},{"url":"https://cloud.google.com/blog/products/identity-security/introducing-google-cloud-confidential-computing-with-confidential-vms","ref":"Google Cloud Blog"},{"url":"https://cloud.google.com/confidential-computing/confidential-vm/docs/supported-configurations","ref":"Supported Configurations"},{"url":"https://cloud.google.com/compute/confidential-vm/pricing","ref":"Pricing"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"4.11","cis_version":"4.0","project":"lab-prod-461912","nist":[]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure That Compute Instances Have Confidential Computing Enabled (Automated)\"\n\n  desc 'Google Cloud encrypts data at-rest and in-transit, but customer data must be decrypted for processing. Confidential Computing is a breakthrough technology that encrypts data in-use while it is being processed. Confidential Computing environments keep data encrypted in memory and elsewhere outside the central processing unit (CPU). Confidential VMs leverage hardware-based memory encryption technologies... Customer data will stay encrypted while it is used, indexed, queried, or trained on. Encryption keys are generated by and reside solely in dedicated hardware and are not exportable, enhancing isolation and security. Built-in hardware optimizations ensure Confidential Computing workloads experience minimal to no significant performance penalties.'\n  desc 'rationale', \"Confidential Computing enables customers' sensitive code and other data encrypted in memory during processing. Google does not have access to the encryption keys. Confidential VM can help alleviate concerns about risk related to either dependency on Google infrastructure or Google insiders' access to customer data in the clear.\"\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[] # Add relevant NIST controls if any in future\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/confidential-vm/docs/creating-cvm-instance'\n  ref 'GCP Docs', url: 'https://cloud.google.com/compute/confidential-vm/docs/about-cvm'\n  ref 'GCP Docs', url: 'https://cloud.google.com/confidential-computing'\n  ref 'Google Cloud Blog', url: 'https://cloud.google.com/blog/products/identity-security/introducing-google-cloud-confidential-computing-with-confidential-vms'\n  ref 'Supported Configurations', url: 'https://cloud.google.com/confidential-computing/confidential-vm/docs/supported-configurations'\n  ref 'Pricing', url: 'https://cloud.google.com/compute/confidential-vm/pricing'\n\n  # control_id and control_abbrev are already defined above\n  # supported_confidential_vm_types is defined as an input above\n\n  instances_found = false\n  google_compute_zones(project: gcp_project_id).zone_names.each do |zone_name|\n    google_compute_instances(project: gcp_project_id, zone: zone_name)\n      .where(status: 'RUNNING')\n      .where { machine_type.match(supported_confidential_vm_types) } # Filter for machine types that *can* support it\n      .instance_names.each do |instance_name|\n      instances_found = true\n      describe \"[#{gcp_project_id}] Confidential VM: #{instance_name} in Zone: #{zone_name}\" do\n        subject { google_compute_instance(project: gcp_project_id, zone: zone_name, name: instance_name).confidential_instance_config }\n        its('enable_confidential_compute') { should be true }\n      end\n    end\n  end\n\n  unless instances_found\n    describe \"[#{control_abbrev.upcase}] #{control_id} - No Running Instances of Supported Machine Types Found\" do\n      skip 'No running compute instances of machine types supporting Confidential Computing (e.g., N2D, C2D, N3D) were found in the project. This control is Not Applicable or requires manual verification for instances not matching the filter.'\n    end\n  end\nend\n","source_location":{"line":24,"ref":"./controls/4.11-vms.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[VMS] 4.11 - No Running Instances of Supported Machine Types Found","run_time":5.083e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"No running compute instances of machine types supporting Confidential Computing (e.g., N2D, C2D, N3D) were found in the project. This control is Not Applicable or requires manual verification for instances not matching the filter.","resource_class":"Object","resource_params":"[]","resource_id":"[VMS] 4.11 - No Running Instances of Supported Machine Types Found"}]},{"id":"cis-gcp-4.12-vms","title":"[VMS] Ensure the Latest Operating System Updates Are Installed On Your Virtual Machines in All Projects (Manual)","desc":"Google Cloud Virtual Machines have the ability via an OS Config agent API to periodically (about every 10 minutes) report OS inventory data. A patch compliance API periodically reads this data, and cross references metadata to determine if the latest updates are installed. This is not the only Patch Management solution available to your organization and you should weigh your needs before committing to using this method. Most Operating Systems require a restart or changing critical resources to apply the updates. Using the Google Cloud VM manager for its OS Patch management will incur additional costs for each VM managed by it.","descriptions":[{"label":"default","data":"Google Cloud Virtual Machines have the ability via an OS Config agent API to periodically (about every 10 minutes) report OS inventory data. A patch compliance API periodically reads this data, and cross references metadata to determine if the latest updates are installed. This is not the only Patch Management solution available to your organization and you should weigh your needs before committing to using this method. Most Operating Systems require a restart or changing critical resources to apply the updates. Using the Google Cloud VM manager for its OS Patch management will incur additional costs for each VM managed by it."},{"label":"rationale","data":"Keeping virtual machine operating systems up to date is a security best practice. Using this service will simplify this process."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/compute/docs/manage-os","ref":"GCP Docs - Manage OS"},{"url":"https://cloud.google.com/compute/docs/os-patch-management","ref":"GCP Docs - OS Patch Management"},{"url":"https://cloud.google.com/compute/docs/vm-manager","ref":"GCP Docs - VM Manager"},{"url":"https://cloud.google.com/compute/docs/images/os-details#vm-manager","ref":"GCP Docs - OS Details VM Manager"},{"url":"https://cloud.google.com/compute/docs/vm-manager#pricing","ref":"GCP Docs - VM Manager Pricing"},{"url":"https://cloud.google.com/compute/docs/troubleshooting/vm-manager/verify-setup","ref":"GCP Docs - Verify Setup"},{"url":"https://cloud.google.com/compute/docs/instances/view-os-details#view-data-tools","ref":"GCP Docs - View OS Details"},{"url":"https://cloud.google.com/compute/docs/os-patch-management/create-patch-job","ref":"GCP Docs - Create Patch Job"},{"url":"https://cloud.google.com/nat/docs/set-up-network-address-translation","ref":"GCP Docs - Setup NAT"},{"url":"https://cloud.google.com/vpc/docs/configure-private-google-access","ref":"GCP Docs - Private Google Access"},{"url":"https://workbench.cisecurity.org/sections/811638/recommendations/1334335","ref":"CIS Workbench Ref"},{"url":"https://cloud.google.com/compute/docs/manage-os#agent-install","ref":"GCP Docs - OS Agent Install"},{"url":"https://cloud.google.com/compute/docs/troubleshooting/vm-manager/verify-setup#service-account-enabled","ref":"GCP Docs - Verify SA Enabled"},{"url":"https://cloud.google.com/compute/docs/os-patch-management#use-dashboard","ref":"GCP Docs - OS Patch Dashboard"},{"url":"https://cloud.google.com/compute/docs/troubleshooting/vm-manager/verify-setup#metadata-enabled","ref":"GCP Docs - Verify Metadata Enabled"}],"tags":{"cis_scored":false,"cis_level":2,"cis_gcp":"4.12","cis_version":"4.0","project":"lab-prod-461912","nist":[]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure the Latest Operating System Updates Are Installed On Your Virtual Machines in All Projects (Manual)\"\n\n  desc 'Google Cloud Virtual Machines have the ability via an OS Config agent API to periodically (about every 10 minutes) report OS inventory data. A patch compliance API periodically reads this data, and cross references metadata to determine if the latest updates are installed. This is not the only Patch Management solution available to your organization and you should weigh your needs before committing to using this method. Most Operating Systems require a restart or changing critical resources to apply the updates. Using the Google Cloud VM manager for its OS Patch management will incur additional costs for each VM managed by it.'\n  desc 'rationale', 'Keeping virtual machine operating systems up to date is a security best practice. Using this service will simplify this process.'\n\n  tag cis_scored: false\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[] # Add relevant NIST controls if any in future\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs - Manage OS', url: 'https://cloud.google.com/compute/docs/manage-os'\n  ref 'GCP Docs - OS Patch Management', url: 'https://cloud.google.com/compute/docs/os-patch-management'\n  ref 'GCP Docs - VM Manager', url: 'https://cloud.google.com/compute/docs/vm-manager'\n  ref 'GCP Docs - OS Details VM Manager', url: 'https://cloud.google.com/compute/docs/images/os-details#vm-manager'\n  ref 'GCP Docs - VM Manager Pricing', url: 'https://cloud.google.com/compute/docs/vm-manager#pricing'\n  ref 'GCP Docs - Verify Setup', url: 'https://cloud.google.com/compute/docs/troubleshooting/vm-manager/verify-setup'\n  ref 'GCP Docs - View OS Details', url: 'https://cloud.google.com/compute/docs/instances/view-os-details#view-data-tools'\n  ref 'GCP Docs - Create Patch Job', url: 'https://cloud.google.com/compute/docs/os-patch-management/create-patch-job'\n  ref 'GCP Docs - Setup NAT', url: 'https://cloud.google.com/nat/docs/set-up-network-address-translation'\n  ref 'GCP Docs - Private Google Access', url: 'https://cloud.google.com/vpc/docs/configure-private-google-access'\n  ref 'CIS Workbench Ref', url: 'https://workbench.cisecurity.org/sections/811638/recommendations/1334335'\n  ref 'GCP Docs - OS Agent Install', url: 'https://cloud.google.com/compute/docs/manage-os#agent-install'\n  ref 'GCP Docs - Verify SA Enabled', url: 'https://cloud.google.com/compute/docs/troubleshooting/vm-manager/verify-setup#service-account-enabled'\n  ref 'GCP Docs - OS Patch Dashboard', url: 'https://cloud.google.com/compute/docs/os-patch-management#use-dashboard'\n  ref 'GCP Docs - Verify Metadata Enabled', url: 'https://cloud.google.com/compute/docs/troubleshooting/vm-manager/verify-setup#metadata-enabled'\n\n  describe 'This control is not scored' do\n    skip 'This control is not scored'\n  end\nend\n","source_location":{"line":23,"ref":"./controls/4.12-vms.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This control is not scored","run_time":4.916e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"This control is not scored","resource_class":"Object","resource_params":"[]","resource_id":"This control is not scored"}]},{"id":"cis-gcp-5.1-storage","title":"[STORAGE] Ensure that Cloud Storage bucket is not anonymously or publicly accessible","desc":"It is recommended that IAM policy on Cloud Storage bucket does not allows anonymous or public access.","descriptions":[{"label":"default","data":"It is recommended that IAM policy on Cloud Storage bucket does not allows anonymous or public access."},{"label":"rationale","data":"Allowing anonymous or public access grants permissions to anyone to access bucket content. Such access might not be desired if you are storing any sensitive data. Hence, ensure that anonymous or public access to a bucket is not allowed."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/storage/docs/access-control/iam-reference","ref":"GCP Docs"},{"url":"https://cloud.google.com/storage/docs/access-control/making-data-public","ref":"GCP Docs"},{"url":"https://cloud.google.com/storage/docs/gsutil/commands/iam","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"5.1","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2","CA-3"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'high'\n\n  title \"[#{control_abbrev.upcase}] Ensure that Cloud Storage bucket is not anonymously or publicly accessible\"\n\n  desc 'It is recommended that IAM policy on Cloud Storage bucket does not allows anonymous or public access.'\n  desc 'rationale', 'Allowing anonymous or public access grants permissions to anyone to access bucket content. Such access might not be desired if you are storing any sensitive data. Hence, ensure that anonymous or public access to a bucket is not allowed.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[AC-2 CA-3]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/storage/docs/access-control/iam-reference'\n  ref 'GCP Docs', url: 'https://cloud.google.com/storage/docs/access-control/making-data-public'\n  ref 'GCP Docs', url: 'https://cloud.google.com/storage/docs/gsutil/commands/iam'\n\n  storage_buckets = google_storage_buckets(project: gcp_project_id).bucket_names\n\n  storage_buckets.each do |bucket|\n    google_storage_bucket_iam_bindings(bucket: bucket).iam_binding_roles.each do |role|\n      describe \"[#{gcp_project_id}] GCS Bucket #{bucket}, Role: #{role}\" do\n        subject { google_storage_bucket_iam_binding(bucket: bucket, role: role) }\n        its('members') { should_not include 'allUsers' }\n        its('members') { should_not include 'allAuthenticatedUsers' }\n      end\n    end\n  end\n\n  if storage_buckets.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] No Google Storage Buckets were found. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] No Google Storage Buckets were found\"\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/5.01-storage.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] No Google Storage Buckets were found. This test is Not Applicable.","run_time":5.791e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] No Google Storage Buckets were found","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] No Google Storage Buckets were found. This test is Not Applicable."}]},{"id":"cis-gcp-5.2-storage","title":"[STORAGE] Ensure that Cloud Storage buckets have uniform bucket-level access enabled","desc":"It is recommended that uniform bucket-level access is enabled on Cloud Storage buckets.","descriptions":[{"label":"default","data":"It is recommended that uniform bucket-level access is enabled on Cloud Storage buckets."},{"label":"rationale","data":"It is recommended to use uniform bucket-level access to unify and simplify\n  how you grant access to your Cloud Storage resources.\n\n  Cloud Storage offers two systems for granting users permission to access your buckets and objects:\n  Cloud Identity and Access Management (Cloud IAM) and Access Control Lists (ACLs).These systems act in parallel -\n  in order for a user to access a Cloud Storage resource, only one of the systems needs to grant the user permission.\n  Cloud IAM is used throughout Google Cloud and allows you to grant a variety of permissions at the bucket and project levels.\n  ACLs are used only by Cloud Storage and have limited permission options, but they allow you to grant permissions on a per-object basis.\n\n  In order to support a uniform permissioning system, Cloud Storage has uniform bucket-level access. Using this feature disables ACLs for\n  all Cloud Storage resources: access to Cloud Storage resources then is granted exclusively through Cloud IAM. Enabling uniform\n  bucket-level access guarantees that if a Storage bucket is not publicly accessible, no object in the bucket is publicly accessible either."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/storage/docs/uniform-bucket-level-access","ref":"GCP Docs"},{"url":"https://cloud.google.com/storage/docs/using-uniform-bucket-level-access","ref":"GCP Docs"},{"url":"https://cloud.google.com/storage/docs/setting-org-policies#uniform-bucket","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"5.2","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-3"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure that Cloud Storage buckets have uniform bucket-level access enabled\"\n\n  desc 'It is recommended that uniform bucket-level access is enabled on Cloud Storage buckets.'\n  desc 'rationale', \"It is recommended to use uniform bucket-level access to unify and simplify\n  how you grant access to your Cloud Storage resources.\n\n  Cloud Storage offers two systems for granting users permission to access your buckets and objects:\n  Cloud Identity and Access Management (Cloud IAM) and Access Control Lists (ACLs).These systems act in parallel -\n  in order for a user to access a Cloud Storage resource, only one of the systems needs to grant the user permission.\n  Cloud IAM is used throughout Google Cloud and allows you to grant a variety of permissions at the bucket and project levels.\n  ACLs are used only by Cloud Storage and have limited permission options, but they allow you to grant permissions on a per-object basis.\n\n  In order to support a uniform permissioning system, Cloud Storage has uniform bucket-level access. Using this feature disables ACLs for\n  all Cloud Storage resources: access to Cloud Storage resources then is granted exclusively through Cloud IAM. Enabling uniform\n  bucket-level access guarantees that if a Storage bucket is not publicly accessible, no object in the bucket is publicly accessible either.\"\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-3']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/storage/docs/uniform-bucket-level-access'\n  ref 'GCP Docs', url: 'https://cloud.google.com/storage/docs/using-uniform-bucket-level-access'\n  ref 'GCP Docs', url: 'https://cloud.google.com/storage/docs/setting-org-policies#uniform-bucket'\n\n  storage_buckets = google_storage_buckets(project: gcp_project_id).bucket_names\n\n  storage_buckets.each do |bucket|\n    uniform_bucket_level_access = google_storage_bucket(name: bucket).acl.nil?\n    describe \"[#{gcp_project_id}] GCS Bucket #{bucket}\" do\n      it 'should have uniform bucket-level access enabled' do\n        expect(uniform_bucket_level_access).to be true\n      end\n    end\n  end\n\n  if storage_buckets.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] No Google Storage Buckets were found. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] No Google Storage Buckets were found\"\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/5.02-storage.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] No Google Storage Buckets were found. This test is Not Applicable.","run_time":5.333e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] No Google Storage Buckets were found","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] No Google Storage Buckets were found. This test is Not Applicable."}]},{"id":"cis-gcp-6.1.1-db","title":"[DB] Ensure that MySql database instance does not allow anyone to connect with administrative privileges.","desc":"It is recommended to set a password for the administrative user (root by default) to prevent unauthorized access to the SQL database instances.\n        This recommendation is applicable only for MySQL Instances. PostgreSQL does not offer any setting for No Password from the cloud console.","descriptions":[{"label":"default","data":"It is recommended to set a password for the administrative user (root by default) to prevent unauthorized access to the SQL database instances.\n        This recommendation is applicable only for MySQL Instances. PostgreSQL does not offer any setting for No Password from the cloud console."},{"label":"rationale","data":"At the time of MySQL Instance creation, not providing an administrative password allows anyone to connect to the SQL database instance with administrative privileges. The root password should be set to ensure only authorized users have these privileges."}],"impact":0.7,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/mysql/create-manage-users","ref":"GCP Docs"},{"url":"https://cloud.google.com/sql/docs/mysql/create-instance","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.1.1","cis_version":"4.0","project":"lab-prod-461912","nist":["IA-5"]},"code":"control \"cis-gcp-#{sub_control_id}-#{control_abbrev}\" do\n  impact 'high'\n\n  title \"[#{control_abbrev.upcase}] Ensure that MySql database instance does not allow anyone to connect with administrative privileges.\"\n\n  desc \"It is recommended to set a password for the administrative user (root by default) to prevent unauthorized access to the SQL database instances.\n        This recommendation is applicable only for MySQL Instances. PostgreSQL does not offer any setting for No Password from the cloud console.\"\n  desc 'rationale', 'At the time of MySQL Instance creation, not providing an administrative password allows anyone to connect to the SQL database instance with administrative privileges. The root password should be set to ensure only authorized users have these privileges.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: sub_control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['IA-5']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/mysql/create-manage-users'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/mysql/create-instance'\n\n  describe 'This control is not scored' do\n    skip 'This control is not scored'\n  end\nend\n","source_location":{"line":30,"ref":"./controls/6.01-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This control is not scored","run_time":5.584e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"This control is not scored","resource_class":"Object","resource_params":"[]","resource_id":"This control is not scored"}]},{"id":"cis-gcp-6.1.2-db","title":"[DB] Ensure 'Skip_show_database database flag for cloud SQL MySQL instance is set to 'On","desc":"It is recommended to set skip_show_database database flag for Cloud SQL Mysql instance to on","descriptions":[{"label":"default","data":"It is recommended to set skip_show_database database flag for Cloud SQL Mysql instance to on"},{"label":"rationale","data":"skip_show_database database flag prevents people from using the SHOW DATABASES statement if they do not\n    have the SHOW DATABASES privilege. This can improve security if you have concerns about users being able to see databases\n    belonging to other users. Its effect depends on the SHOW DATABASES privilege: If the variable value is ON, the SHOW DATABASES\n    statement is permitted only to users who have the SHOW DATABASES privilege, and the statement displays all database names. If\n    the value is OFF, SHOW DATABASES is permitted to all users, but displays the names of only those databases for which the user\n    has the SHOW DATABASES or other privilege. This recommendation is applicable to Mysql database instances."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/mysql/flags","ref":"GCP Docs"},{"url":"https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_skip_show_database","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.1.2","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-3"]},"code":"control \"cis-gcp-#{sub_control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure 'Skip_show_database database flag for cloud SQL MySQL instance is set to 'On\"\n\n  desc 'It is recommended to set skip_show_database database flag for Cloud SQL Mysql instance to on'\n  desc 'rationale', \"skip_show_database database flag prevents people from using the SHOW DATABASES statement if they do not\n    have the SHOW DATABASES privilege. This can improve security if you have concerns about users being able to see databases\n    belonging to other users. Its effect depends on the SHOW DATABASES privilege: If the variable value is ON, the SHOW DATABASES\n    statement is permitted only to users who have the SHOW DATABASES privilege, and the statement displays all database names. If\n    the value is OFF, SHOW DATABASES is permitted to all users, but displays the names of only those databases for which the user\n    has the SHOW DATABASES or other privilege. This recommendation is applicable to Mysql database instances.\"\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: sub_control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-3']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/mysql/flags'\n  ref 'GCP Docs', url: 'https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_skip_show_database'\n\n  sql_instance_names.each do |db|\n    if sql_cache.instance_objects[db].database_version.include? 'MYSQL'\n      impact 'medium'\n      if sql_cache.instance_objects[db].settings.database_flags.nil?\n        describe \"[#{gcp_project_id} , #{db} ] does not any have database flags.\" do\n          subject { false }\n          it { should be true }\n        end\n      else\n        describe.one do\n          sql_cache.instance_objects[db].settings.database_flags.each do |flag|\n            next unless flag.name == 'skip_show_database'\n            describe flag do\n              its('name') { should cmp 'skip_show_database' }\n              its('value') { should cmp 'on' }\n            end\n          end\n        end\n      end\n    else\n      describe \"[#{gcp_project_id}] [#{db}] is not a MySQL database. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] [#{db}] is not a MySQL database\"\n      end\n    end\n  end\n\n  if sql_instance_names.empty?\n    describe 'There are no Cloud SQL Instances in this project. This test is Not Applicable.' do\n      skip 'There are no Cloud SQL Instances in this project'\n    end\n  end\nend\n","source_location":{"line":57,"ref":"./controls/6.01-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"There are no Cloud SQL Instances in this project. This test is Not Applicable.","run_time":6.167e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"There are no Cloud SQL Instances in this project","resource_class":"Object","resource_params":"[]","resource_id":"There are no Cloud SQL Instances in this project. This test is Not Applicable."}]},{"id":"cis-gcp-6.1.3-db","title":"[DB] Ensure that the 'Local_infile database flag for a cloud SQL MySQL instance is set to 'off","desc":"It is recommended to set the local_infile database flag for a Cloud SQL MySQL instance to off.","descriptions":[{"label":"default","data":"It is recommended to set the local_infile database flag for a Cloud SQL MySQL instance to off."},{"label":"rationale","data":"The local_infile flag controls the server-side LOCAL capability for LOAD DATA statements. Depending on the\n        local_infile setting, the server refuses or permits local data loading by clients that have LOCAL enabled on the client side.\n        To explicitly cause the server to refuse LOAD DATA LOCAL statements (regardless of how client programs and libraries are configured\n        at build time or runtime), start mysqld with local_infile disabled. local_infile can also be set at runtime.\n        Due to security issues associated with the local_infile flag, it is recommended to disable it. This recommendation is applicable to MySQL database instances."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/mysql/flags","ref":"GCP Docs"},{"url":"https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_local_infile","ref":"GCP Docs"},{"url":"https://dev.mysql.com/doc/refman/5.7/en/load-data-local.html","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.1.3","cis_version":"4.0","project":"lab-prod-461912","nist":["SC-1"]},"code":"control \"cis-gcp-#{sub_control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure that the 'Local_infile database flag for a cloud SQL MySQL instance is set to 'off\"\n\n  desc 'It is recommended to set the local_infile database flag for a Cloud SQL MySQL instance to off.'\n  desc 'rationale', \"The local_infile flag controls the server-side LOCAL capability for LOAD DATA statements. Depending on the\n        local_infile setting, the server refuses or permits local data loading by clients that have LOCAL enabled on the client side.\n        To explicitly cause the server to refuse LOAD DATA LOCAL statements (regardless of how client programs and libraries are configured\n        at build time or runtime), start mysqld with local_infile disabled. local_infile can also be set at runtime.\n        Due to security issues associated with the local_infile flag, it is recommended to disable it. This recommendation is applicable to MySQL database instances.\"\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: sub_control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['SC-1']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/mysql/flags'\n  ref 'GCP Docs', url: 'https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_local_infile'\n  ref 'GCP Docs', url: 'https://dev.mysql.com/doc/refman/5.7/en/load-data-local.html'\n\n  sql_instance_names.each do |db|\n    if sql_cache.instance_objects[db].database_version.include? 'MYSQL'\n      impact 'medium'\n      if sql_cache.instance_objects[db].settings.database_flags.nil?\n        describe \"[#{gcp_project_id} , #{db} ] does not any have database flags.\" do\n          subject { false }\n          it { should be true }\n        end\n      else\n        describe.one do\n          sql_cache.instance_objects[db].settings.database_flags.each do |flag|\n            next unless flag.name == 'local_infile'\n            describe flag do\n              its('name') { should cmp 'local_infile' }\n              its('value') { should cmp 'off' }\n            end\n          end\n        end\n      end\n    else\n      describe \"[#{gcp_project_id}] [#{db}] is not a MySQL database. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] [#{db}] is not a MySQL database\"\n      end\n    end\n  end\n\n  if sql_instance_names.empty?\n    describe \"[#{gcp_project_id}] does not have CloudSQL instances. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have CloudSQL instances.\"\n    end\n  end\nend\n","source_location":{"line":116,"ref":"./controls/6.01-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable.","run_time":6.916e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] does not have CloudSQL instances.","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable."}]},{"id":"cis-gcp-6.2.1-db","title":"[DB] Ensure 'Log_error_verbosity Database Flag for Cloud SQL PostgreSQL Instance Is Set to 'DEFAULT or Stricter","desc":"The log_error_verbosity flag controls the verbosity/details of messages logged. Valid values are:\n         TERSE\n         DEFAULT\n         VERBOSE\n        TERSE excludes the logging of DETAIL, HINT, QUERY, and CONTEXT error information.\n        VERBOSE output includes the SQLSTATE error code, source code file name, function name, and line number that generated the error.\n        Ensure an appropriate value is set to 'DEFAULT' or stricter.","descriptions":[{"label":"default","data":"The log_error_verbosity flag controls the verbosity/details of messages logged. Valid values are:\n         TERSE\n         DEFAULT\n         VERBOSE\n        TERSE excludes the logging of DETAIL, HINT, QUERY, and CONTEXT error information.\n        VERBOSE output includes the SQLSTATE error code, source code file name, function name, and line number that generated the error.\n        Ensure an appropriate value is set to 'DEFAULT' or stricter."},{"label":"rationale","data":"Auditing helps in troubleshooting operational problems and also permits forensic analysis. If log_error_verbosity is not\n        set to the correct value, too many details or too few details may be logged. This flag should be configured with a value of 'DEFAULT'\n        or stricter.\n        This recommendation is applicable to PostgreSQL database instances."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/postgres/flags","ref":"GCP Docs"},{"url":"https://www.postgresql.org/docs/current/runtime-config-logging.html#GUC-LOG-ERROR-VERBOSITY","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"6.2.1","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-3"]},"code":"control \"cis-gcp-#{sub_control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure 'Log_error_verbosity Database Flag for Cloud SQL PostgreSQL Instance Is Set to 'DEFAULT or Stricter\"\n\n  desc 'The log_error_verbosity flag controls the verbosity/details of messages logged. Valid values are:\n         TERSE\n         DEFAULT\n         VERBOSE\n        TERSE excludes the logging of DETAIL, HINT, QUERY, and CONTEXT error information.\n        VERBOSE output includes the SQLSTATE error code, source code file name, function name, and line number that generated the error.\n        Ensure an appropriate value is set to \\'DEFAULT\\' or stricter.'\n\n  desc 'rationale', 'Auditing helps in troubleshooting operational problems and also permits forensic analysis. If log_error_verbosity is not\n        set to the correct value, too many details or too few details may be logged. This flag should be configured with a value of \\'DEFAULT\\'\n        or stricter.\n        This recommendation is applicable to PostgreSQL database instances.'\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: sub_control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AU-3']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/postgres/flags'\n  ref 'GCP Docs', url: 'https://www.postgresql.org/docs/current/runtime-config-logging.html#GUC-LOG-ERROR-VERBOSITY'\n\n  sql_instance_names.each do |db|\n    if sql_cache.instance_objects[db].database_version.include? 'POSTGRES'\n      impact 'medium'\n      if sql_cache.instance_objects[db].settings.database_flags.nil?\n        describe \"[#{gcp_project_id} , #{db} ] does not any have database flags.\" do\n          subject { false }\n          it { should be true }\n        end\n      else\n        describe.one do\n          sql_cache.instance_objects[db].settings.database_flags.each do |flag|\n            next unless flag.name == 'log_error_verbosity'\n            describe \"[#{gcp_project_id} , #{db} ] should have a database flag 'log_error_verbosity' set to #{log_error_verbosity} \" do\n              subject { flag }\n              its('name') { should cmp 'log_error_verbosity' }\n              its('value') { should cmp log_error_verbosity }\n            end\n          end\n        end\n      end\n    else\n      describe \"[#{gcp_project_id}] [#{db}] is not a PostgreSQL database. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] [#{db}] is not a PostgreSQL database\"\n      end\n    end\n  end\n\n  if sql_instance_names.empty?\n    describe \"[#{gcp_project_id}] does not have CloudSQL instances. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have CloudSQL instances.\"\n    end\n  end\nend\n","source_location":{"line":32,"ref":"./controls/6.02-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable.","run_time":6.375e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] does not have CloudSQL instances.","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable."}]},{"id":"cis-gcp-6.2.2-db","title":"[DB] Ensure that the 'Log_connections database flag for cloud SQL PostgreSQL instance is set to 'on","desc":"Enabling the log_connections setting causes each attempted connection to the server to be logged, along with successful completion\n        of client authentication. This parameter cannot be changed after the session starts.","descriptions":[{"label":"default","data":"Enabling the log_connections setting causes each attempted connection to the server to be logged, along with successful completion\n        of client authentication. This parameter cannot be changed after the session starts."},{"label":"rationale","data":"PostgreSQL does not log attempted connections by default. Enabling the log_connections setting will create log entries\n        for each attempted connection as well as successful completion of client authentication which can be useful in troubleshooting issues\n        and to determine any unusual connection attempts to the server. This recommendation is applicable to PostgreSQL database instances."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/postgres/flags","ref":"GCP Docs"},{"url":"https://www.postgresql.org/docs/current/runtime-config-logging.html#GUC-LOG-CONNECTIONS","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.2.2","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-3"]},"code":"control \"cis-gcp-#{sub_control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure that the 'Log_connections database flag for cloud SQL PostgreSQL instance is set to 'on\"\n\n  desc 'Enabling the log_connections setting causes each attempted connection to the server to be logged, along with successful completion\n        of client authentication. This parameter cannot be changed after the session starts.'\n  desc 'rationale', \"PostgreSQL does not log attempted connections by default. Enabling the log_connections setting will create log entries\n        for each attempted connection as well as successful completion of client authentication which can be useful in troubleshooting issues\n        and to determine any unusual connection attempts to the server. This recommendation is applicable to PostgreSQL database instances.\"\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: sub_control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AU-3']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/postgres/flags'\n  ref 'GCP Docs', url: 'https://www.postgresql.org/docs/current/runtime-config-logging.html#GUC-LOG-CONNECTIONS'\n\n  sql_instance_names.each do |db|\n    if sql_cache.instance_objects[db].database_version.include? 'POSTGRES'\n      impact 'medium'\n      if sql_cache.instance_objects[db].settings.database_flags.nil?\n        describe \"[#{gcp_project_id} , #{db} ] does not any have database flags.\" do\n          subject { false }\n          it { should be true }\n        end\n      else\n        describe.one do\n          sql_cache.instance_objects[db].settings.database_flags.each do |flag|\n            next unless flag.name == 'log_connections'\n            describe \"[#{gcp_project_id} , #{db} ] should have a database flag 'log_connections' set to 'on' \" do\n              subject { flag }\n              its('name') { should cmp 'log_connections' }\n              its('value') { should cmp 'on' }\n            end\n          end\n        end\n      end\n    else\n      describe \"[#{gcp_project_id}] [#{db}] is not a PostgreSQL database. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] [#{db}] is not a PostgreSQL database\"\n      end\n    end\n  end\n\n  if sql_instance_names.empty?\n    describe \"[#{gcp_project_id}] does not have CloudSQL instances. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have CloudSQL instances.\"\n    end\n  end\nend\n","source_location":{"line":97,"ref":"./controls/6.02-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable.","run_time":6.584e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] does not have CloudSQL instances.","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable."}]},{"id":"cis-gcp-6.2.3-db","title":"[DB] Ensure that the 'Log_disconnections database flag for cloud SQL PostgreSQL instance is set to 'on","desc":"Enabling the log_disconnections setting logs the end of each session, including the session duration.","descriptions":[{"label":"default","data":"Enabling the log_disconnections setting logs the end of each session, including the session duration."},{"label":"rationale","data":"PostgreSQL does not log session details such as duration and session end by default. Enabling the log_disconnections\n        setting will create log entries at the end of each session which can be useful in troubleshooting issues and determine any unusual\n        activity across a time period. The log_disconnections and log_connections work hand in hand and generally, the pair would be enabled/disabled\n        together. This recommendation is applicable to PostgreSQL database instances."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/postgres/flags","ref":"GCP Docs"},{"url":"https://www.postgresql.org/docs/current/runtime-config-logging.html#GUC-LOG-DISCONNECTIONS","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.2.3","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-3"]},"code":"control \"cis-gcp-#{sub_control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure that the 'Log_disconnections database flag for cloud SQL PostgreSQL instance is set to 'on\"\n\n  desc 'Enabling the log_disconnections setting logs the end of each session, including the session duration.'\n  desc 'rationale', \"PostgreSQL does not log session details such as duration and session end by default. Enabling the log_disconnections\n        setting will create log entries at the end of each session which can be useful in troubleshooting issues and determine any unusual\n        activity across a time period. The log_disconnections and log_connections work hand in hand and generally, the pair would be enabled/disabled\n        together. This recommendation is applicable to PostgreSQL database instances.\"\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: sub_control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AU-3']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/postgres/flags'\n  ref 'GCP Docs', url: 'https://www.postgresql.org/docs/current/runtime-config-logging.html#GUC-LOG-DISCONNECTIONS'\n\n  sql_instance_names.each do |db|\n    if sql_cache.instance_objects[db].database_version.include? 'POSTGRES'\n      impact 'medium'\n      if sql_cache.instance_objects[db].settings.database_flags.nil?\n        describe \"[#{gcp_project_id} , #{db} ] does not any have database flags.\" do\n          subject { false }\n          it { should be true }\n        end\n      else\n        describe.one do\n          sql_cache.instance_objects[db].settings.database_flags.each do |flag|\n            next unless flag.name == 'log_disconnections'\n            describe \"[#{gcp_project_id} , #{db} ] should have a database flag 'log_disconnections' set to 'on' \" do\n              subject { flag }\n              its('name') { should cmp 'log_disconnections' }\n              its('value') { should cmp 'on' }\n            end\n          end\n        end\n      end\n    else\n      describe \"[#{gcp_project_id}] [#{db}] is not a PostgreSQL database. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] [#{db}] is not a PostgreSQL database\"\n      end\n    end\n  end\n\n  if sql_instance_names.empty?\n    describe \"[#{gcp_project_id}] does not have CloudSQL instances. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have CloudSQL instances.\"\n    end\n  end\nend\n","source_location":{"line":155,"ref":"./controls/6.02-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable.","run_time":5.25e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] does not have CloudSQL instances.","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable."}]},{"id":"cis-gcp-6.2.4-db","title":"[DB] Ensure 'log_statement' database flag for Cloud SQL PostgreSQL instance is set appropriately","desc":"The value of log_statement flag determined the SQL statements that are logged. Valid\n        values are:\n        - none\n        - ddl\n        - mod\n        - all\n        The value ddl logs all data definition statements. The value mod logs all ddl statements, plus\n        data-modifying statements.\n        The statements are logged after a basic parsing is done and statement type is determined,\n        thus this does not logs statements with errors. When using extended query protocol,\n        logging occurs after an Execute message is received and values of the Bind parameters are\n        included.\n        A value of 'ddl' is recommended unless otherwise directed by your organization's logging\n        policy.","descriptions":[{"label":"default","data":"The value of log_statement flag determined the SQL statements that are logged. Valid\n        values are:\n        - none\n        - ddl\n        - mod\n        - all\n        The value ddl logs all data definition statements. The value mod logs all ddl statements, plus\n        data-modifying statements.\n        The statements are logged after a basic parsing is done and statement type is determined,\n        thus this does not logs statements with errors. When using extended query protocol,\n        logging occurs after an Execute message is received and values of the Bind parameters are\n        included.\n        A value of 'ddl' is recommended unless otherwise directed by your organization's logging\n        policy."},{"label":"rationale","data":"Auditing helps in troubleshooting operational problems and also permits forensic analysis.\n        If log_statement is not set to the correct value, too many statements may be logged leading\n        to issues in finding the relevant information from the logs, or too few statements may be\n        logged with relevant information missing from the logs. Setting log_statement to align with\n        your organization's security and logging policies facilitates later auditing and review of\n        database activities. This recommendation is applicable to PostgreSQL database instances."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/postgres/flags","ref":"GCP Docs"},{"url":"https://www.postgresql.org/docs/current/runtime-config-logging.html#GUC-LOG-STATEMENT","ref":"GCP Docs"},{"ref":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/postgres/flags","ref":"GCP Docs"},{"url":"https://www.postgresql.org/docs/current/runtime-config-logging.html#RUNTIME-CONFIG-LOGGING-WHAT","ref":"GCP Docs"}]}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.2.4","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-3"]},"code":"control \"cis-gcp-#{sub_control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure 'Log_statement database flag for cloud SQL PostgreSQL instance is set appropriately\"\n\n  desc \"The value of log_statement flag determined the SQL statements that are logged. Valid values are:\n         none\n         ddl\n         mod\n         all\n      The value ddl logs all data definition statements. The value mod logs all ddl statements, plus data-modifying statements.\n      The statements are logged after a basic parsing is done and statement type is determined, thus this does not logs statements\n      with errors. When using extended query protocol, logging occurs after an Execute message is received and values of the Bind parameters are included.\n      A value of 'ddl' is recommended unless otherwise directed by your organizations logging policy.\"\n  desc 'rationale', \"Auditing helps in forensic analysis. If log_statement is not set to the correct value, too many statements may be\n      logged leading to issues in finding the relevant information from the logs, or too few statements may be logged with relevant information\n      missing from the logs. Setting log_statement to align with your organizations security and logging policies facilitates later auditing and\n      review of database activities. This recommendation is applicable to PostgreSQL database instances.\"\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: sub_control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AU-3']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/postgres/flags'\n  ref 'GCP Docs', url: 'https://www.postgresql.org/docs/current/runtime-config-logging.html#GUC-LOG-STATEMENT'\n\n  sql_instance_names.each do |db|\n    if sql_cache.instance_objects[db].database_version.include? 'POSTGRES'\n      impact 'medium'\n      if sql_cache.instance_objects[db].settings.database_flags.nil?\n        describe \"[#{gcp_project_id} , #{db} ] does not any have database flags.\" do\n          subject { false }\n          it { should be true }\n        end\n      else\n        describe.one do\n          sql_cache.instance_objects[db].settings.database_flags.each do |flag|\n            next unless flag.name == 'log_duration'\n            describe \"[#{gcp_project_id} , #{db} ] should have a database flag 'log_duration' set to 'on' \" do\n              subject { flag }\n              its('name') { should cmp 'log_duration' }\n              its('value') { should cmp 'on' }\n            end\n          end\n        end\n      end\n    else\n      describe \"[#{gcp_project_id}] [#{db}] is not a PostgreSQL database. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] [#{db}] is not a PostgreSQL database\"\n      end\n    end\n  end\n\n  if sql_instance_names.empty?\n    describe \"[#{gcp_project_id}] does not have CloudSQL instances. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have CloudSQL instances.\"\n    end\n  end\nend\n","source_location":{"line":213,"ref":"./controls/6.02-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable.","run_time":5.875e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] does not have CloudSQL instances.","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable."}]},{"id":"cis-gcp-6.2.5-db","title":"[DB] Ensure that the 'Log_min_messages flag for a cloud SQL PostgreSQL instance is set at minimum to 'warning'","desc":"The log_min_messages flag defines the minimum message severity level that is considered as an error statement. Messages for error statements\n        are logged with the SQL statement. Valid values include (from lowest to highest severity) DEBUG5, DEBUG4, DEBUG3, DEBUG2, DEBUG1, INFO, NOTICE,\n        WARNING, ERROR, LOG, FATAL, and PANIC. Each severity level includes the subsequent levels mentioned above. ERROR is considered the best practice\n        setting. Changes should only be made in accordance with the organizations logging policy","descriptions":[{"label":"default","data":"The log_min_messages flag defines the minimum message severity level that is considered as an error statement. Messages for error statements\n        are logged with the SQL statement. Valid values include (from lowest to highest severity) DEBUG5, DEBUG4, DEBUG3, DEBUG2, DEBUG1, INFO, NOTICE,\n        WARNING, ERROR, LOG, FATAL, and PANIC. Each severity level includes the subsequent levels mentioned above. ERROR is considered the best practice\n        setting. Changes should only be made in accordance with the organizations logging policy"},{"label":"rationale","data":"Auditing helps in troubleshooting operational problems and also permits forensic analysis. If log_min_messages is not set to the\n        correct value, messages may not be classified as error messages appropriately. Setting the threshold to 'Warning' will log messages for\n        the most needed error messages.\n        This recommendation is applicable to PostgreSQL database instances."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/postgres/flags","ref":"GCP Docs"},{"url":"https://www.postgresql.org/docs/current/runtime-config-logging.html#GUC-LOG-MIN-MESSAGES","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.2.5","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-3"]},"code":"control \"cis-gcp-#{sub_control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure that the 'Log_min_messages flag for a cloud SQL PostgreSQL instance is set at minimum to 'warning'\"\n\n  desc 'The log_min_messages flag defines the minimum message severity level that is considered as an error statement. Messages for error statements\n        are logged with the SQL statement. Valid values include (from lowest to highest severity) DEBUG5, DEBUG4, DEBUG3, DEBUG2, DEBUG1, INFO, NOTICE,\n        WARNING, ERROR, LOG, FATAL, and PANIC. Each severity level includes the subsequent levels mentioned above. ERROR is considered the best practice\n        setting. Changes should only be made in accordance with the organizations logging policy'\n  desc 'rationale', \"Auditing helps in troubleshooting operational problems and also permits forensic analysis. If log_min_messages is not set to the\n        correct value, messages may not be classified as error messages appropriately. Setting the threshold to 'Warning' will log messages for\n        the most needed error messages.\n        This recommendation is applicable to PostgreSQL database instances.\"\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: sub_control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AU-3']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/postgres/flags'\n  ref 'GCP Docs', url: 'https://www.postgresql.org/docs/current/runtime-config-logging.html#GUC-LOG-MIN-MESSAGES'\n\n  sql_instance_names.each do |db|\n    if sql_cache.instance_objects[db].database_version.include? 'POSTGRES'\n      impact 'medium'\n      if sql_cache.instance_objects[db].settings.database_flags.nil?\n        describe \"[#{gcp_project_id} , #{db} ] does not any have database flags.\" do\n          subject { false }\n          it { should be true }\n        end\n      else\n        describe.one do\n          sql_cache.instance_objects[db].settings.database_flags.each do |flag|\n            next unless flag.name == 'log_min_messages'\n            describe \"[#{gcp_project_id} , #{db} ] should have a database flag 'log_min_messages' set to #{log_min_messages}\" do\n              subject { flag }\n              its('name') { should cmp 'log_min_messages' }\n              its('value') { should cmp log_min_messages }\n            end\n          end\n        end\n      end\n    else\n      describe \"[#{gcp_project_id}] [#{db}] is not a PostgreSQL database. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] [#{db}] is not a PostgreSQL database\"\n      end\n    end\n  end\n\n  if sql_instance_names.empty?\n    describe \"[#{gcp_project_id}] does not have CloudSQL instances. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have CloudSQL instances.\"\n    end\n  end\nend\n","source_location":{"line":351,"ref":"./controls/6.02-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable.","run_time":6.625e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] does not have CloudSQL instances.","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable."}]},{"id":"cis-gcp-6.2.6-db","title":"[DB] Ensure 'Log_min_error_statement database flag for cloud SQL PostgreSQL instance\n  is set to 'Error or stricter","desc":"The log_min_error_statement flag defines the minimum message severity level that are considered as an error statement.\n        Messages for error statements are logged with the SQL statement. Valid values include (from lowest to highest severity) DEBUG5,\n        DEBUG4, DEBUG3, DEBUG2, DEBUG1, INFO, NOTICE, WARNING, ERROR, LOG, FATAL, and PANIC. Each severity level includes the subsequent\n        levels mentioned above. Ensure a value of ERROR or stricter is set.","descriptions":[{"label":"default","data":"The log_min_error_statement flag defines the minimum message severity level that are considered as an error statement.\n        Messages for error statements are logged with the SQL statement. Valid values include (from lowest to highest severity) DEBUG5,\n        DEBUG4, DEBUG3, DEBUG2, DEBUG1, INFO, NOTICE, WARNING, ERROR, LOG, FATAL, and PANIC. Each severity level includes the subsequent\n        levels mentioned above. Ensure a value of ERROR or stricter is set."},{"label":"rationale","data":"Auditing helps in troubleshooting operational problems and also permits forensic analysis. If log_min_error_statement is\n        not set to the correct value, messages may not be classified as error messages appropriately. Considering general log messages as error\n        messages would make is difficult to find actual errors and considering only stricter severity levels as error messages may skip actual\n        errors to log their SQL statements. The log_min_error_statement flag should be set to ERROR or stricter.\n        This recommendation is applicable to PostgreSQL database instances."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/postgres/flags","ref":"GCP Docs"},{"url":"https://www.postgresql.org/docs/current/runtime-config-logging.html#GUC-LOG-MIN-ERROR-STATEMENT","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.2.6","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-3"]},"code":"control \"cis-gcp-#{sub_control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure 'Log_min_error_statement database flag for cloud SQL PostgreSQL instance\n  is set to 'Error or stricter\"\n\n  desc 'The log_min_error_statement flag defines the minimum message severity level that are considered as an error statement.\n        Messages for error statements are logged with the SQL statement. Valid values include (from lowest to highest severity) DEBUG5,\n        DEBUG4, DEBUG3, DEBUG2, DEBUG1, INFO, NOTICE, WARNING, ERROR, LOG, FATAL, and PANIC. Each severity level includes the subsequent\n        levels mentioned above. Ensure a value of ERROR or stricter is set.'\n  desc 'rationale', 'Auditing helps in troubleshooting operational problems and also permits forensic analysis. If log_min_error_statement is\n        not set to the correct value, messages may not be classified as error messages appropriately. Considering general log messages as error\n        messages would make is difficult to find actual errors and considering only stricter severity levels as error messages may skip actual\n        errors to log their SQL statements. The log_min_error_statement flag should be set to ERROR or stricter.\n        This recommendation is applicable to PostgreSQL database instances.'\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: sub_control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AU-3']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/postgres/flags'\n  ref 'GCP Docs', url: 'https://www.postgresql.org/docs/current/runtime-config-logging.html#GUC-LOG-MIN-ERROR-STATEMENT'\n\n  sql_instance_names.each do |db|\n    if sql_cache.instance_objects[db].database_version.include? 'POSTGRES'\n      impact 'medium'\n      if sql_cache.instance_objects[db].settings.database_flags.nil?\n        describe \"[#{gcp_project_id} , #{db} ] does not any have database flags.\" do\n          subject { false }\n          it { should be true }\n        end\n      else\n        describe.one do\n          sql_cache.instance_objects[db].settings.database_flags.each do |flag|\n            next unless flag.name == 'log_min_error_statement'\n            describe \"[#{gcp_project_id} , #{db} ] should have a database flag 'log_min_error_statement' set to #{log_min_error_statement}\" do\n              subject { flag }\n              its('name') { should cmp 'log_min_error_statement' }\n              its('value') { should cmp log_min_error_statement }\n            end\n          end\n        end\n      end\n    else\n      describe \"[#{gcp_project_id}] [#{db}] is not a PostgreSQL database. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] [#{db}] is not a PostgreSQL database\"\n      end\n    end\n  end\n\n  if sql_instance_names.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] does not have CloudSQL instances. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have CloudSQL instances.\"\n    end\n  end\nend\n","source_location":{"line":411,"ref":"./controls/6.02-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable.","run_time":6.375e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] does not have CloudSQL instances.","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable."}]},{"id":"cis-gcp-6.2.7-db","title":"[DB] Ensure That the 'Log_min_duration_statement Database Flag for Cloud SQL PostgreSQL\n  Instance Is Set to '-1' (Disabled)","desc":"The log_min_duration_statement flag defines the minimum amount of execution time of a statement in milliseconds\n        where the total duration of the statement is logged. Ensure that log_min_duration_statement is disabled, i.e., a\n        value of -1 is set.","descriptions":[{"label":"default","data":"The log_min_duration_statement flag defines the minimum amount of execution time of a statement in milliseconds\n        where the total duration of the statement is logged. Ensure that log_min_duration_statement is disabled, i.e., a\n        value of -1 is set."},{"label":"rationale","data":"Logging SQL statements may include sensitive information that should not be recorded in logs. This\n        recommendation is applicable to PostgreSQL database instances."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/postgres/flags","ref":"GCP Docs"},{"url":"https://www.postgresql.org/docs/current/runtime-config-logging.html#GUC-LOG-MIN-DURATION-STATEMENT","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.2.7","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-3"]},"code":"control \"cis-gcp-#{sub_control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure That the 'Log_min_duration_statement Database Flag for Cloud SQL PostgreSQL\n  Instance Is Set to '-1' (Disabled)\"\n\n  desc 'The log_min_duration_statement flag defines the minimum amount of execution time of a statement in milliseconds\n        where the total duration of the statement is logged. Ensure that log_min_duration_statement is disabled, i.e., a\n        value of -1 is set.'\n  desc 'rationale', 'Logging SQL statements may include sensitive information that should not be recorded in logs. This\n        recommendation is applicable to PostgreSQL database instances.'\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: sub_control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AU-3']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/postgres/flags'\n  ref 'GCP Docs', url: 'https://www.postgresql.org/docs/current/runtime-config-logging.html#GUC-LOG-MIN-DURATION-STATEMENT'\n\n  sql_instance_names.each do |db|\n    if sql_cache.instance_objects[db].database_version.include? 'POSTGRES'\n      impact 'medium'\n      if sql_cache.instance_objects[db].settings.database_flags.nil?\n        describe \"[#{gcp_project_id} , #{db} ] does not any have database flags.\" do\n          subject { false }\n          it { should be true }\n        end\n      else\n        describe.one do\n          sql_cache.instance_objects[db].settings.database_flags.each do |flag|\n            next unless flag.name == 'log_min_duration_statement'\n            describe \"[#{gcp_project_id} , #{db} ] should have a database flag 'log_min_duration_statement' set to '-1' \" do\n              subject { flag }\n              its('name') { should cmp 'log_min_duration_statement' }\n              its('value') { should cmp '-1' }\n            end\n          end\n        end\n      end\n    else\n      describe \"[#{gcp_project_id}] [#{db}] is not a PostgreSQL database. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] [#{db}] is not a PostgreSQL database\"\n      end\n    end\n  end\n\n  if sql_instance_names.empty?\n    describe \"[#{gcp_project_id}] does not have CloudSQL instances. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have CloudSQL instances.\"\n    end\n  end\nend\n","source_location":{"line":474,"ref":"./controls/6.02-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable.","run_time":1.0333e-05,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] does not have CloudSQL instances.","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable."}]},{"id":"cis-gcp-6.2.8-db","title":"[DB] Ensure That 'cloudsql.enable_pgaudit' Database Flag for each Cloud Sql Postgresql\n  Instance Is Set to 'on' For Centralized Logging","desc":"Ensure cloudsql.enable_pgaudit database flag for Cloud SQL PostgreSQL instance is set to on to allow for centralized logging.","descriptions":[{"label":"default","data":"Ensure cloudsql.enable_pgaudit database flag for Cloud SQL PostgreSQL instance is set to on to allow for centralized logging."},{"label":"rationale","data":"As numerous other recommendations in this section consist of turning on flags for logging purposes, your organization\n        will need a way to manage these logs. You may have a solution already in place. If you do not, consider installing and enabling the\n        open source pgaudit extension within PostgreSQL and enabling its corresponding flag of cloudsql.enable_pgaudit. This flag and\n        installing the extension enables database auditing in PostgreSQL through the open-source pgAudit extension. This extension provides\n        detailed session and object logging to comply with government, financial, & ISO standards and provides auditing capabilities to\n        mitigate threats by monitoring security events on the instance. Enabling the flag and settings later in this recommendation will send\n        these logs to Google Logs Explorer so that you can access them in a central location. to This recommendation is applicable only to\n        PostgreSQL database instances."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/postgres/flags#list-flags-postgres","ref":"GCP Docs"},{"url":"https://cloud.google.com/sql/docs/postgres/pg-audit#enable-auditing-flag","ref":"GCP Docs"},{"url":"https://cloud.google.com/sql/docs/postgres/pg-audit#customizing-database-audit-logging","ref":"GCP Docs"},{"url":"https://cloud.google.com/logging/docs/audit/configure-data-access#config-console-enable","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.2.8","cis_version":"4.0","project":"lab-prod-461912","nist":["AU-3"]},"code":"control \"cis-gcp-#{sub_control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure That 'cloudsql.enable_pgaudit' Database Flag for each Cloud Sql Postgresql\n  Instance Is Set to 'on' For Centralized Logging\"\n\n  desc 'Ensure cloudsql.enable_pgaudit database flag for Cloud SQL PostgreSQL instance is set to on to allow for centralized logging.'\n  desc 'rationale', 'As numerous other recommendations in this section consist of turning on flags for logging purposes, your organization\n        will need a way to manage these logs. You may have a solution already in place. If you do not, consider installing and enabling the\n        open source pgaudit extension within PostgreSQL and enabling its corresponding flag of cloudsql.enable_pgaudit. This flag and\n        installing the extension enables database auditing in PostgreSQL through the open-source pgAudit extension. This extension provides\n        detailed session and object logging to comply with government, financial, & ISO standards and provides auditing capabilities to\n        mitigate threats by monitoring security events on the instance. Enabling the flag and settings later in this recommendation will send\n        these logs to Google Logs Explorer so that you can access them in a central location. to This recommendation is applicable only to\n        PostgreSQL database instances.'\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: sub_control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AU-3']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/postgres/flags#list-flags-postgres'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/postgres/pg-audit#enable-auditing-flag'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/postgres/pg-audit#customizing-database-audit-logging'\n  ref 'GCP Docs', url: 'https://cloud.google.com/logging/docs/audit/configure-data-access#config-console-enable'\n\n  sql_instance_names.each do |db|\n    if sql_cache.instance_objects[db].database_version.include? 'POSTGRES'\n      impact 'medium'\n      if sql_cache.instance_objects[db].settings.database_flags.nil?\n        describe \"[#{gcp_project_id} , #{db} ] does not any have database flags.\" do\n          subject { false }\n          it { should be true }\n        end\n      else\n        describe.one do\n          sql_cache.instance_objects[db].settings.database_flags.each do |flag|\n            next unless flag.name == 'enable_pgaudit'\n            describe \"[#{gcp_project_id} , #{db} ] should have a database flag 'enable_pgaudit' set to 'on'\" do\n              subject { flag }\n              its('name') { should cmp 'enable_pgaudit' }\n              its('value') { should cmp 'on' }\n            end\n          end\n        end\n      end\n    else\n      describe \"[#{gcp_project_id}] [#{db}] is not a PostgreSQL database. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] [#{db}] is not a PostgreSQL database\"\n      end\n    end\n  end\n\n  if sql_instance_names.empty?\n    describe \"[#{gcp_project_id}] does not have CloudSQL instances. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have CloudSQL instances.\"\n    end\n  end\nend\n","source_location":{"line":532,"ref":"./controls/6.02-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable.","run_time":6.334e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] does not have CloudSQL instances.","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable."}]},{"id":"cis-gcp-6.3.1-db","title":"[DB] Ensure 'external scripts enabled' Database Flag for Cloud SQL SQL Server Instance Is Set to 'off'","desc":"It is recommended to set external scripts enabled database flag for Cloud SQL SQL Server instance to off","descriptions":[{"label":"default","data":"It is recommended to set external scripts enabled database flag for Cloud SQL SQL Server instance to off"},{"label":"rationale","data":"external scripts enabled enable the execution of scripts with certain remote language extensions. This property is\n        OFF by default. When Advanced Analytics Services is installed, setup can optionally set this property to true. As the External Scripts\n        Enabled feature allows scripts external to SQL such as files located in an R library to be executed, which could adversely affect the\n        security of the system, hence this should be disabled. This recommendation is applicable to SQL Server database instances."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/external-scripts-enabled-server-configuration-option?view=sql-server-ver15","ref":"GCP Docs"},{"url":"https://cloud.google.com/sql/docs/sqlserver/flags","ref":"GCP Docs"},{"url":"https://docs.microsoft.com/en-us/sql/advanced-analytics/concepts/security?view=sql-server-ver15","ref":"GCP Docs"},{"url":"https://www.stigviewer.com/stig/ms_sql_server_2016_instance/2018-03-09/finding/V-79347","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.3.1","cis_version":"4.0","project":"lab-prod-461912","nist":["CM-7"]},"code":"control \"cis-gcp-#{sub_control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure 'external scripts enabled' Database Flag for Cloud SQL SQL Server Instance Is Set to 'off'\"\n\n  desc 'It is recommended to set external scripts enabled database flag for Cloud SQL SQL Server instance to off'\n  desc 'rationale', 'external scripts enabled enable the execution of scripts with certain remote language extensions. This property is\n        OFF by default. When Advanced Analytics Services is installed, setup can optionally set this property to true. As the External Scripts\n        Enabled feature allows scripts external to SQL such as files located in an R library to be executed, which could adversely affect the\n        security of the system, hence this should be disabled. This recommendation is applicable to SQL Server database instances.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: sub_control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['CM-7']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/external-scripts-enabled-server-configuration-option?view=sql-server-ver15'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/sqlserver/flags'\n  ref 'GCP Docs', url: 'https://docs.microsoft.com/en-us/sql/advanced-analytics/concepts/security?view=sql-server-ver15'\n  ref 'GCP Docs', url: 'https://www.stigviewer.com/stig/ms_sql_server_2016_instance/2018-03-09/finding/V-79347'\n\n  sql_instance_names.each do |db|\n    if sql_cache.instance_objects[db].database_version.include? 'SQLSERVER'\n      impact 'medium'\n      if sql_cache.instance_objects[db].settings.database_flags.nil?\n        describe \"[#{gcp_project_id} , #{db} ] does not any have database flags.\" do\n          subject { false }\n          it { should be true }\n        end\n      else\n        describe.one do\n          sql_cache.instance_objects[db].settings.database_flags.each do |flag|\n            next unless flag.name == 'external scripts enabled'\n            describe \"[#{gcp_project_id} , #{db} ] should have a database flag 'external scripts enabled' set to 'off' \" do\n              subject { flag }\n              its('name') { should cmp 'external scripts enabled' }\n              its('value') { should cmp 'off' }\n            end\n          end\n        end\n      end\n    else\n      describe \"[#{gcp_project_id}] [#{db}] is not a SQL Server database. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] [#{db}] is not a SQL Server database\"\n      end\n    end\n  end\n\n  if sql_instance_names.empty?\n    describe 'There are no Cloud SQL Instances in this project. This test is Not Applicable.' do\n      skip 'There are no Cloud SQL Instances in this project'\n    end\n  end\nend\n","source_location":{"line":28,"ref":"./controls/6.03-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"There are no Cloud SQL Instances in this project. This test is Not Applicable.","run_time":7.042e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"There are no Cloud SQL Instances in this project","resource_class":"Object","resource_params":"[]","resource_id":"There are no Cloud SQL Instances in this project. This test is Not Applicable."}]},{"id":"cis-gcp-6.3.2-db","title":"[DB] Ensure 'cross db ownership chaining' Database Flag for Cloud SQL SQL Server Instance Is Set to 'off'","desc":"It is recommended to set cross db ownership chaining database flag for Cloud SQL SQL Server instance to off.\n        This flag is deprecated for all SQL Server versions in CGP. Going forward, you cant set its value to on. However, if you have this\n        flag enabled, we strongly recommend that you either remove the flag from your database or set it to off. For cross-database access,\n        use the Microsoft tutorial for signing stored procedures with a certificate.","descriptions":[{"label":"default","data":"It is recommended to set cross db ownership chaining database flag for Cloud SQL SQL Server instance to off.\n        This flag is deprecated for all SQL Server versions in CGP. Going forward, you cant set its value to on. However, if you have this\n        flag enabled, we strongly recommend that you either remove the flag from your database or set it to off. For cross-database access,\n        use the Microsoft tutorial for signing stored procedures with a certificate."},{"label":"rationale","data":"Use the cross db ownership for chaining option to configure cross-database ownership chaining for an instance of Microsoft\n        SQL Server. This server option allows you to control cross-database ownership chaining at the database level or to allow cross-database\n        ownership chaining for all databases. Enabling cross db ownership is not recommended unless all of the databases hosted by the instance\n        of SQL Server must participate in cross-database ownership chaining and you are aware of the security implications of this setting. This\n        recommendation is applicable to SQL Server database instances."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/sqlserver/flags","ref":"GCP Docs"},{"url":"https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option?view=sql-server-ver15","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.3.2","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-3"]},"code":"control \"cis-gcp-#{sub_control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure 'cross db ownership chaining' Database Flag for Cloud SQL SQL Server Instance Is Set to 'off'\"\n\n  desc 'It is recommended to set cross db ownership chaining database flag for Cloud SQL SQL Server instance to off.\n        This flag is deprecated for all SQL Server versions in CGP. Going forward, you cant set its value to on. However, if you have this\n        flag enabled, we strongly recommend that you either remove the flag from your database or set it to off. For cross-database access,\n        use the Microsoft tutorial for signing stored procedures with a certificate.'\n  desc 'rationale', 'Use the cross db ownership for chaining option to configure cross-database ownership chaining for an instance of Microsoft\n        SQL Server. This server option allows you to control cross-database ownership chaining at the database level or to allow cross-database\n        ownership chaining for all databases. Enabling cross db ownership is not recommended unless all of the databases hosted by the instance\n        of SQL Server must participate in cross-database ownership chaining and you are aware of the security implications of this setting. This\n        recommendation is applicable to SQL Server database instances.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: sub_control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-3']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/sqlserver/flags'\n  ref 'GCP Docs', url: 'https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option?view=sql-server-ver15'\n\n  sql_instance_names.each do |db|\n    if sql_cache.instance_objects[db].database_version.include? 'SQLSERVER'\n      impact 'medium'\n      if sql_cache.instance_objects[db].settings.database_flags.nil?\n        describe \"[#{gcp_project_id} , #{db} ] does not any have database flags.\" do\n          subject { false }\n          it { should be true }\n        end\n      else\n        describe.one do\n          sql_cache.instance_objects[db].settings.database_flags.each do |flag|\n            next unless flag.name == 'cross db ownership chaining'\n            describe \"[#{gcp_project_id} , #{db} ] should have a database flag 'cross db ownership chaining' set to 'off' \" do\n              subject { flag }\n              its('name') { should cmp 'cross db ownership chaining' }\n              its('value') { should cmp 'off' }\n            end\n          end\n        end\n      end\n    else\n      describe \"[#{gcp_project_id}] [#{db}] is not a SQL Server database. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] [#{db}] is not a SQL Server database\"\n      end\n    end\n  end\n\n  if sql_instance_names.empty?\n    impact 'none'\n    describe 'There are no Cloud SQL Instances in this project. This test is Not Applicable.' do\n      skip 'There are no Cloud SQL Instances in this project'\n    end\n  end\nend\n","source_location":{"line":88,"ref":"./controls/6.03-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"There are no Cloud SQL Instances in this project. This test is Not Applicable.","run_time":6.958e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"There are no Cloud SQL Instances in this project","resource_class":"Object","resource_params":"[]","resource_id":"There are no Cloud SQL Instances in this project. This test is Not Applicable."}]},{"id":"cis-gcp-6.3.3-db","title":"[DB] Ensure 'user Connections' Database Flag for Cloud SQL SQL Server Instance Is Set to a Non-limiting Value","desc":"It is recommended to check the user connections for a Cloud SQL SQL Server instance to ensure that it is not artificially limiting connections.","descriptions":[{"label":"default","data":"It is recommended to check the user connections for a Cloud SQL SQL Server instance to ensure that it is not artificially limiting connections."},{"label":"rationale","data":"The user connections option specifies the maximum number of simultaneous user connections that are allowed on an instance of SQL\n        Server. The actual number of user connections allowed also depends on the version of SQL Server that you are using, and also the limits of your\n        application or applications and hardware. SQL Server allows a maximum of 32,767 user connections. Because user connections is by default a\n        self-configuring value, with SQL Server adjusting the maximum number of user connections automatically as needed, up to the maximum value\n        allowable. For example, if only 10 users are logged in, 10 user connection objects are allocated. In most cases, you do not have to change the\n        value for this option. The default is 0, which means that the maximum (32,767) user connections are allowed. However if there is a number defined\n        here that limits connections, SQL Server will not allow anymore above this limit. If the connections are at the limit, any new requests will be\n        dropped, potentially causing lost data or outages for those using the database."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/sqlserver/flags","ref":"GCP Docs"},{"url":"https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/configure-the-user-connections-server-configuration-option?view=sql-server-ver15","ref":"GCP Docs"},{"url":"https://www.stigviewer.com/stig/ms_sql_server_2016_instance/2018-03-09/finding/V-79119","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.3.3","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2"]},"code":"control \"cis-gcp-#{sub_control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure 'user Connections' Database Flag for Cloud SQL SQL Server Instance Is Set to a Non-limiting Value\"\n\n  desc 'It is recommended to check the user connections for a Cloud SQL SQL Server instance to ensure that it is not artificially limiting connections.'\n  desc 'rationale', 'The user connections option specifies the maximum number of simultaneous user connections that are allowed on an instance of SQL\n        Server. The actual number of user connections allowed also depends on the version of SQL Server that you are using, and also the limits of your\n        application or applications and hardware. SQL Server allows a maximum of 32,767 user connections. Because user connections is by default a\n        self-configuring value, with SQL Server adjusting the maximum number of user connections automatically as needed, up to the maximum value\n        allowable. For example, if only 10 users are logged in, 10 user connection objects are allocated. In most cases, you do not have to change the\n        value for this option. The default is 0, which means that the maximum (32,767) user connections are allowed. However if there is a number defined\n        here that limits connections, SQL Server will not allow anymore above this limit. If the connections are at the limit, any new requests will be\n        dropped, potentially causing lost data or outages for those using the database.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: sub_control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-2']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/sqlserver/flags'\n  ref 'GCP Docs', url: 'https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/configure-the-user-connections-server-configuration-option?view=sql-server-ver15'\n  ref 'GCP Docs', url: 'https://www.stigviewer.com/stig/ms_sql_server_2016_instance/2018-03-09/finding/V-79119'\n\n  sql_instance_names.each do |db|\n    if sql_cache.instance_objects[db].database_version.include? 'SQLSERVER'\n      impact 'medium'\n      if sql_cache.instance_objects[db].settings.database_flags.nil?\n        describe \"[#{gcp_project_id} , #{db} ] does not any have database flags.\" do\n          subject { false }\n          it { should be true }\n        end\n      else\n        describe.one do\n          sql_cache.instance_objects[db].settings.database_flags.each do |flag|\n            next unless flag.name == 'user connections'\n            describe \"[#{gcp_project_id} , #{db} ] should have a database flag 'user connections' set to #{user_connections} \" do\n              subject { flag }\n              its('name') { should cmp 'user connections' }\n              its('value') { should cmp user_connections }\n            end\n          end\n        end\n      end\n    else\n      describe \"[#{gcp_project_id}] [#{db}] is not a SQL Server database. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] [#{db}] is not a SQL Server database\"\n      end\n    end\n  end\n\n  if sql_instance_names.empty?\n    describe 'There are no Cloud SQL Instances in this project. This test is Not Applicable.' do\n      skip 'There are no Cloud SQL Instances in this project'\n    end\n  end\nend\n","source_location":{"line":151,"ref":"./controls/6.03-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"There are no Cloud SQL Instances in this project. This test is Not Applicable.","run_time":6.667e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"There are no Cloud SQL Instances in this project","resource_class":"Object","resource_params":"[]","resource_id":"There are no Cloud SQL Instances in this project. This test is Not Applicable."}]},{"id":"cis-gcp-6.3.4-db","title":"[DB] Ensure 'user options' Database Flag for Cloud SQL SQL Server Instance Is Not Configured","desc":"The user options option specifies global defaults for all users. A list of default query processing options is established\n        for the duration of a users work session. The user options option allows you to change the default values of the SET options (if the\n        servers default settings are not appropriate).\n        A user can override these defaults by using the SET statement. You can configure user options dynamically for new logins. After you\n        change the setting of user options, new login sessions use the new setting; current login sessions are not affected. This recommendation\n        is applicable to SQL Server database instances.","descriptions":[{"label":"default","data":"The user options option specifies global defaults for all users. A list of default query processing options is established\n        for the duration of a users work session. The user options option allows you to change the default values of the SET options (if the\n        servers default settings are not appropriate).\n        A user can override these defaults by using the SET statement. You can configure user options dynamically for new logins. After you\n        change the setting of user options, new login sessions use the new setting; current login sessions are not affected. This recommendation\n        is applicable to SQL Server database instances."},{"label":"rationale","data":"It is recommended that, user options database flag for Cloud SQL SQL Server instance should not be configured.\n        A user can override these defaults set with user options by using the SET statement. Some of these features/options could adversely\n        affect the security of the system if enabled."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/sqlserver/flags","ref":"GCP Docs"},{"url":"https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/configure-the-user-options-server-configuration-option?view=sql-server-ver15","ref":"GCP Docs"},{"url":"https://www.stigviewer.com/stig/ms_sql_server_2016_instance/2018-03-09/finding/V-79335","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.3.4","cis_version":"4.0","project":"lab-prod-461912","nist":["CM-6"]},"code":"control \"cis-gcp-#{sub_control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure 'user options' Database Flag for Cloud SQL SQL Server Instance Is Not Configured\"\n\n  desc 'The user options option specifies global defaults for all users. A list of default query processing options is established\n        for the duration of a users work session. The user options option allows you to change the default values of the SET options (if the\n        servers default settings are not appropriate).\n        A user can override these defaults by using the SET statement. You can configure user options dynamically for new logins. After you\n        change the setting of user options, new login sessions use the new setting; current login sessions are not affected. This recommendation\n        is applicable to SQL Server database instances.'\n  desc 'rationale', 'It is recommended that, user options database flag for Cloud SQL SQL Server instance should not be configured.\n        A user can override these defaults set with user options by using the SET statement. Some of these features/options could adversely\n        affect the security of the system if enabled.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: sub_control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['CM-6']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/sqlserver/flags'\n  ref 'GCP Docs', url: 'https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/configure-the-user-options-server-configuration-option?view=sql-server-ver15'\n  ref 'GCP Docs', url: 'https://www.stigviewer.com/stig/ms_sql_server_2016_instance/2018-03-09/finding/V-79335'\n\n  sql_instance_names.each do |db|\n    if sql_cache.instance_objects[db].database_version.include? 'SQLSERVER'\n      impact 'medium'\n      if sql_cache.instance_objects[db].settings.database_flags.nil?\n        describe \"[#{gcp_project_id} , #{db} ] does not any have database flags.\" do\n          subject { false }\n          it { should be true }\n        end\n      else\n        describe.one do\n          sql_cache.instance_objects[db].settings.database_flags.each do |flag|\n            next unless flag.name == 'user options'\n            describe \"[#{gcp_project_id} , #{db} ] should not have database flag 'user options' configured\" do\n              subject { false }\n              it { should be true }\n            end\n          end\n        end\n      end\n    else\n      describe \"[#{gcp_project_id}] [#{db}] is not a SQL Server database. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] [#{db}] is not a SQL Server database\"\n      end\n    end\n  end\n\n  if sql_instance_names.empty?\n    describe 'There are no Cloud SQL Instances in this project. This test is Not Applicable.' do\n      skip 'There are no Cloud SQL Instances in this project'\n    end\n  end\nend\n","source_location":{"line":214,"ref":"./controls/6.03-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"There are no Cloud SQL Instances in this project. This test is Not Applicable.","run_time":5.083e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"There are no Cloud SQL Instances in this project","resource_class":"Object","resource_params":"[]","resource_id":"There are no Cloud SQL Instances in this project. This test is Not Applicable."}]},{"id":"cis-gcp-6.3.5-db","title":"[DB] Ensure 'remote access' Database Flag for Cloud SQL SQL Server Instance Is Set to 'off'","desc":"It is recommended to set remote access database flag for Cloud SQL SQL Server instance to off.","descriptions":[{"label":"default","data":"It is recommended to set remote access database flag for Cloud SQL SQL Server instance to off."},{"label":"rationale","data":"The remote access option controls the execution of stored procedures from local or remote servers on\n        which instances of SQL Server are running. This default value for this option is 1. This grants permission to run local\n        stored procedures from remote servers or remote stored procedures from the local server. To prevent local stored procedures\n        from being run from a remote server or remote stored procedures from being run on the local server, this must be disabled.\n        The Remote Access option controls the execution of local stored procedures on remote servers or remote stored procedures on\n        local server. Remote access functionality can be abused to launch a Denial-of-Service (DoS) attack on remote servers by\n        off-loading query processing to a target, hence this should be disabled. This recommendation is applicable to SQL Server database instances."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/sqlserver/flags","ref":"GCP Docs"},{"url":"https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/configure-the-remote-access-server-configuration-option?view=sql-server-ver15","ref":"GCP Docs"},{"url":"https://www.stigviewer.com/stig/ms_sql_server_2016_instance/2018-03-09/finding/V-79337","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.3.5","cis_version":"4.0","project":"lab-prod-461912","nist":["CM-7"]},"code":"control \"cis-gcp-#{sub_control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure 'remote access' Database Flag for Cloud SQL SQL Server Instance Is Set to 'off'\"\n\n  desc 'It is recommended to set remote access database flag for Cloud SQL SQL Server instance to off.'\n  desc 'rationale', 'The remote access option controls the execution of stored procedures from local or remote servers on\n        which instances of SQL Server are running. This default value for this option is 1. This grants permission to run local\n        stored procedures from remote servers or remote stored procedures from the local server. To prevent local stored procedures\n        from being run from a remote server or remote stored procedures from being run on the local server, this must be disabled.\n        The Remote Access option controls the execution of local stored procedures on remote servers or remote stored procedures on\n        local server. Remote access functionality can be abused to launch a Denial-of-Service (DoS) attack on remote servers by\n        off-loading query processing to a target, hence this should be disabled. This recommendation is applicable to SQL Server database instances.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: sub_control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['CM-7']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/sqlserver/flags'\n  ref 'GCP Docs', url: 'https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/configure-the-remote-access-server-configuration-option?view=sql-server-ver15'\n  ref 'GCP Docs', url: 'https://www.stigviewer.com/stig/ms_sql_server_2016_instance/2018-03-09/finding/V-79337'\n\n  sql_instance_names.each do |db|\n    if sql_cache.instance_objects[db].database_version.include? 'SQLSERVER'\n      impact 'medium'\n      if sql_cache.instance_objects[db].settings.database_flags.nil?\n        describe \"[#{gcp_project_id} , #{db} ] does not any have database flags.\" do\n          subject { false }\n          it { should be true }\n        end\n      else\n        describe.one do\n          sql_cache.instance_objects[db].settings.database_flags.each do |flag|\n            next unless flag.name == 'remote access'\n            describe \"[#{gcp_project_id} , #{db} ] should have a database flag 'remote access' set to 'off' \" do\n              subject { flag }\n              its('name') { should cmp 'remote access' }\n              its('value') { should cmp 'off' }\n            end\n          end\n        end\n      end\n    else\n      describe \"[#{gcp_project_id}] [#{db}] is not a SQL Server database. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] [#{db}] is not a SQL Server database\"\n      end\n    end\n  end\n\n  if sql_instance_names.empty?\n    describe 'There are no Cloud SQL Instances in this project. This test is Not Applicable.' do\n      skip 'There are no Cloud SQL Instances in this project'\n    end\n  end\nend\n","source_location":{"line":276,"ref":"./controls/6.03-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"There are no Cloud SQL Instances in this project. This test is Not Applicable.","run_time":6.458e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"There are no Cloud SQL Instances in this project","resource_class":"Object","resource_params":"[]","resource_id":"There are no Cloud SQL Instances in this project. This test is Not Applicable."}]},{"id":"cis-gcp-6.3.6-db","title":"[DB] Ensure '3625 (trace flag)' Database Flag for all Cloud SQL SQL Server Instances Is Set to 'on'","desc":"It is recommended to set 3625 (trace flag) database flag for Cloud SQL SQL Server instance to on.","descriptions":[{"label":"default","data":"It is recommended to set 3625 (trace flag) database flag for Cloud SQL SQL Server instance to on."},{"label":"rationale","data":"Microsoft SQL Trace Flags are frequently used to diagnose performance issues or to debug stored procedures or\n        complex computer systems, but they may also be recommended by Microsoft Support to address behavior that is negatively impacting a\n        specific workload. All documented trace flags and those recommended by Microsoft Support are fully supported in a production\n        environment when used as directed. 3625(trace log) Limits the amount of information returned to users who are not members of the\n        sysadmin fixed server role, by masking the parameters of some error messages using '******'. Setting this in a Google Cloud flag for\n        the instance allows for security through obscurity and prevents the disclosure of sensitive information, hence this is recommended to\n        set this flag globally to on to prevent the flag having been left off, or changed by bad actors. This recommendation is applicable to\n        SQL Server database instances."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/sqlserver/flags","ref":"GCP Docs"},{"url":"https://docs.microsoft.com/en-us/sql/t-sql/database-console-commands/dbcc-traceon-trace-flags-transact-sql?view=sql-server-ver15#trace-flags","ref":"GCP Docs"},{"url":"https://github.com/ktaranov/sqlserver-kit/blob/master/SQL%20Server%20Trace%20Flag.md","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.3.6","cis_version":"4.0","project":"lab-prod-461912","nist":["SC-1"]},"code":"control \"cis-gcp-#{sub_control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure '3625 (trace flag)' Database Flag for all Cloud SQL SQL Server Instances Is Set to 'on'\"\n\n  desc 'It is recommended to set 3625 (trace flag) database flag for Cloud SQL SQL Server instance to on.'\n  desc 'rationale', 'Microsoft SQL Trace Flags are frequently used to diagnose performance issues or to debug stored procedures or\n        complex computer systems, but they may also be recommended by Microsoft Support to address behavior that is negatively impacting a\n        specific workload. All documented trace flags and those recommended by Microsoft Support are fully supported in a production\n        environment when used as directed. 3625(trace log) Limits the amount of information returned to users who are not members of the\n        sysadmin fixed server role, by masking the parameters of some error messages using \\'******\\'. Setting this in a Google Cloud flag for\n        the instance allows for security through obscurity and prevents the disclosure of sensitive information, hence this is recommended to\n        set this flag globally to on to prevent the flag having been left off, or changed by bad actors. This recommendation is applicable to\n        SQL Server database instances.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: sub_control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['SC-1']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/sqlserver/flags'\n  ref 'GCP Docs', url: 'https://docs.microsoft.com/en-us/sql/t-sql/database-console-commands/dbcc-traceon-trace-flags-transact-sql?view=sql-server-ver15#trace-flags'\n  ref 'GCP Docs', url: 'https://github.com/ktaranov/sqlserver-kit/blob/master/SQL%20Server%20Trace%20Flag.md'\n\n  sql_instance_names.each do |db|\n    if sql_cache.instance_objects[db].database_version.include? 'SQLSERVER'\n      impact 'medium'\n      if sql_cache.instance_objects[db].settings.database_flags.nil?\n        describe \"[#{gcp_project_id} , #{db} ] does not any have database flags.\" do\n          subject { false }\n          it { should be true }\n        end\n      else\n        describe.one do\n          sql_cache.instance_objects[db].settings.database_flags.each do |flag|\n            next unless flag.name == '3625'\n            describe \"[#{gcp_project_id} , #{db} ] should have a database flag '3625' set to 'off' \" do\n              subject { flag }\n              its('name') { should cmp '3625' }\n              its('value') { should cmp 'off' }\n            end\n          end\n        end\n      end\n    else\n      impact 'none'\n      describe \"[#{gcp_project_id}] [#{db}] is not a SQL Server database. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] [#{db}] is not a SQL Server database\"\n      end\n    end\n  end\n\n  if sql_instance_names.empty?\n    describe 'There are no Cloud SQL Instances in this project. This test is Not Applicable.' do\n      skip 'There are no Cloud SQL Instances in this project'\n    end\n  end\nend\n","source_location":{"line":338,"ref":"./controls/6.03-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"There are no Cloud SQL Instances in this project. This test is Not Applicable.","run_time":5.75e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"There are no Cloud SQL Instances in this project","resource_class":"Object","resource_params":"[]","resource_id":"There are no Cloud SQL Instances in this project. This test is Not Applicable."}]},{"id":"cis-gcp-6.3.7-db","title":"[DB] Ensure 'contained database authentication' Database Flag for Cloud SQL SQL Server Instance Is Set to 'off'","desc":"A contained database includes all database settings and metadata required to define the database and has no configuration dependencies\n        on the instance of the Database Engine where the database is installed. Users can connect to the database without authenticating a login\n        at the Database Engine level. Isolating the database from the Database Engine makes it possible to easily move the database to another\n        instance of SQL Server. Contained databases have some unique threats that should be understood and mitigated by SQL Server Database Engine\n        administrators. Most of the threats are related to the USER WITH PASSWORD authentication process, which moves the authentication boundary\n        from the Database Engine level to the database level, hence this is recommended not to enable this flag. This recommendation is applicable\n        to SQL Server database instances.","descriptions":[{"label":"default","data":"A contained database includes all database settings and metadata required to define the database and has no configuration dependencies\n        on the instance of the Database Engine where the database is installed. Users can connect to the database without authenticating a login\n        at the Database Engine level. Isolating the database from the Database Engine makes it possible to easily move the database to another\n        instance of SQL Server. Contained databases have some unique threats that should be understood and mitigated by SQL Server Database Engine\n        administrators. Most of the threats are related to the USER WITH PASSWORD authentication process, which moves the authentication boundary\n        from the Database Engine level to the database level, hence this is recommended not to enable this flag. This recommendation is applicable\n        to SQL Server database instances."},{"label":"rationale","data":"When contained databases are enabled, database users with the ALTER ANY USER permission, such as members of the db_owner and\n        db_accessadmin database roles, can grant access to databases and by doing so, grant access to the instance of SQL Server. This means that\n        control over access to the server is no longer limited to members of the sysadmin and securityadmin fixed server role, and logins with the\n        server level CONTROL SERVER and ALTER ANY LOGIN permission.\n        It is recommended to set contained database authentication database flag for Cloud SQL on the SQL Server instance to off."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/sqlserver/flags","ref":"GCP Docs"},{"url":"https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/contained-database-authentication-server-configuration-option?view=sql-server-ver15","ref":"GCP Docs"},{"url":"https://docs.microsoft.com/en-us/sql/relational-databases/databases/security-best-practices-with-contained-databases?view=sql-server-ver15","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.3.7","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-3"]},"code":"control \"cis-gcp-#{sub_control_id}-#{control_abbrev}\" do\n  impact 'none'\n\n  title \"[#{control_abbrev.upcase}] Ensure 'contained database authentication' Database Flag for Cloud SQL SQL Server Instance Is Set to 'off'\"\n\n  desc 'A contained database includes all database settings and metadata required to define the database and has no configuration dependencies\n        on the instance of the Database Engine where the database is installed. Users can connect to the database without authenticating a login\n        at the Database Engine level. Isolating the database from the Database Engine makes it possible to easily move the database to another\n        instance of SQL Server. Contained databases have some unique threats that should be understood and mitigated by SQL Server Database Engine\n        administrators. Most of the threats are related to the USER WITH PASSWORD authentication process, which moves the authentication boundary\n        from the Database Engine level to the database level, hence this is recommended not to enable this flag. This recommendation is applicable\n        to SQL Server database instances.'\n  desc 'rationale', 'When contained databases are enabled, database users with the ALTER ANY USER permission, such as members of the db_owner and\n        db_accessadmin database roles, can grant access to databases and by doing so, grant access to the instance of SQL Server. This means that\n        control over access to the server is no longer limited to members of the sysadmin and securityadmin fixed server role, and logins with the\n        server level CONTROL SERVER and ALTER ANY LOGIN permission.\n        It is recommended to set contained database authentication database flag for Cloud SQL on the SQL Server instance to off.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: sub_control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-3']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/sqlserver/flags'\n  ref 'GCP Docs', url: 'https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/contained-database-authentication-server-configuration-option?view=sql-server-ver15'\n  ref 'GCP Docs', url: 'https://docs.microsoft.com/en-us/sql/relational-databases/databases/security-best-practices-with-contained-databases?view=sql-server-ver15'\n\n  sql_instance_names.each do |db|\n    if sql_cache.instance_objects[db].database_version.include? 'SQLSERVER'\n      impact 'medium'\n      if sql_cache.instance_objects[db].settings.database_flags.nil?\n        describe \"[#{gcp_project_id} , #{db} ] does not any have database flags.\" do\n          subject { false }\n          it { should be true }\n        end\n      else\n        describe.one do\n          sql_cache.instance_objects[db].settings.database_flags.each do |flag|\n            next unless flag.name == 'contained database authentication'\n            describe \"[#{gcp_project_id} , #{db} ] should have a database flag 'contained database authentication' set to 'off' \" do\n              subject { flag }\n              its('name') { should cmp 'contained database authentication' }\n              its('value') { should cmp 'off' }\n            end\n          end\n        end\n      end\n    else\n      describe \"[#{gcp_project_id}] [#{db}] is not a SQL Server database. This test is Not Applicable.\" do\n        skip \"[#{gcp_project_id}] [#{db}] is not a SQL Server database\"\n      end\n    end\n  end\n\n  if sql_instance_names.empty?\n    describe \"[#{gcp_project_id}] does not have CloudSQL instances. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have CloudSQL instances.\"\n    end\n  end\nend\n","source_location":{"line":402,"ref":"./controls/6.03-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable.","run_time":5.791e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] does not have CloudSQL instances.","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable."}]},{"id":"cis-gcp-6.4-db","title":"[DB] Ensure That the Cloud SQL Database Instance Requires All Incoming Connections To Use SSL","desc":"It is recommended to enforce all incoming connections to SQL database instance to use SSL.","descriptions":[{"label":"default","data":"It is recommended to enforce all incoming connections to SQL database instance to use SSL."},{"label":"rationale","data":"SQL database connections if successfully trapped (MITM); can reveal sensitive data like credentials, database queries, query outputs etc. For security, it is recommended to always use SSL encryption when connecting to your instance. This recommendation is applicable for Postgresql, MySql generation 1, MySql generation 2 and SQL Server 2017 instances."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/postgres/configure-ssl-instance/","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.4","cis_version":"4.0","project":"lab-prod-461912","nist":["SC-1","SC-8"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'high'\n\n  title \"[#{control_abbrev.upcase}] Ensure That the Cloud SQL Database Instance Requires All Incoming Connections To Use SSL\"\n\n  desc 'It is recommended to enforce all incoming connections to SQL database instance to use SSL.'\n  desc 'rationale', 'SQL database connections if successfully trapped (MITM); can reveal sensitive data like credentials, database queries, query outputs etc. For security, it is recommended to always use SSL encryption when connecting to your instance. This recommendation is applicable for Postgresql, MySql generation 1, MySql generation 2 and SQL Server 2017 instances.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[SC-1 SC-8]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/postgres/configure-ssl-instance/'\n\n  if sql_instance_names.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] does not have CloudSQL instances. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have CloudSQL instances.\"\n    end\n  else\n    sql_instance_names.each do |db|\n      describe \"[#{gcp_project_id}] CloudSQL #{db}\" do\n        subject { sql_cache.instance_objects[db] }\n        it { should have_ip_configuration_require_ssl }\n      end\n    end\n  end\nend\n","source_location":{"line":26,"ref":"./controls/6.04-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable.","run_time":5.666e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] does not have CloudSQL instances.","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable."}]},{"id":"cis-gcp-6.5-db","title":"[DB] Ensure That Cloud SQL Database Instances Do Not Implicitly Whitelist All Public IP Addresses","desc":"Database Server should accept connections only from trusted Network(s)/IP(s) and restrict access from public IP addresses.","descriptions":[{"label":"default","data":"Database Server should accept connections only from trusted Network(s)/IP(s) and restrict access from public IP addresses."},{"label":"rationale","data":"To minimize attack surface on a Database server instance, only trusted/known and required IP(s) should be\n        white-listed to connect to it. An authorized network should not have IPs/networks configured to '0.0.0.0/0' which will allow\n        access to the instance from anywhere in the world. Note that authorized networks apply only to instances with public IPs."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/mysql/configure-ip","ref":"GCP Docs"},{"url":"https://console.cloud.google.com/iam-admin/orgpolicies/sql-restrictAuthorizedNetworks","ref":"GCP Docs"},{"url":"https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints","ref":"GCP Docs"},{"url":"https://cloud.google.com/sql/docs/mysql/connection-org-policy","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.5","cis_version":"4.0","project":"lab-prod-461912","nist":["SC-1","AC-3"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure That Cloud SQL Database Instances Do Not Implicitly Whitelist All Public IP Addresses\"\n\n  desc 'Database Server should accept connections only from trusted Network(s)/IP(s) and restrict access from public IP addresses.'\n  desc 'rationale', 'To minimize attack surface on a Database server instance, only trusted/known and required IP(s) should be\n        white-listed to connect to it. An authorized network should not have IPs/networks configured to \\'0.0.0.0/0\\' which will allow\n        access to the instance from anywhere in the world. Note that authorized networks apply only to instances with public IPs.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: %w[SC-1 AC-3]\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/mysql/configure-ip'\n  ref 'GCP Docs', url: 'https://console.cloud.google.com/iam-admin/orgpolicies/sql-restrictAuthorizedNetworks'\n  ref 'GCP Docs', url: 'https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/mysql/connection-org-policy'\n\n  if sql_instance_names.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] does not have CloudSQL instances. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have CloudSQL instances.\"\n    end\n  else\n    sql_instance_names.each do |db|\n      describe \"[#{gcp_project_id}] CloudSQL #{db}\" do\n        subject { sql_cache.instance_objects[db].settings.ip_configuration.authorized_networks }\n        it { should_not include('0.0.0.0/0') }\n      end\n    end\n  end\nend\n","source_location":{"line":26,"ref":"./controls/6.05-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable.","run_time":5.583e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] does not have CloudSQL instances.","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable."}]},{"id":"cis-gcp-6.6-db","title":"[DB] Ensure That Cloud SQL Database Instances Do Not Have Public IPs","desc":"It is recommended to configure Second Generation Sql instance to use private IPs instead of public IPs.","descriptions":[{"label":"default","data":"It is recommended to configure Second Generation Sql instance to use private IPs instead of public IPs."},{"label":"rationale","data":"To lower the organization's attack surface, Cloud SQL databases should not have public IPs.\n        Private IPs provide improved network security and lower latency for your application."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/mysql/configure-private-ip","ref":"GCP Docs"},{"url":"https://cloud.google.com/sql/docs/mysql/private-ip","ref":"GCP Docs"},{"url":"https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints","ref":"GCP Docs"},{"url":"https://console.cloud.google.com/iam-admin/orgpolicies/sql-restrictPublicIp","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"6.6","cis_version":"4.0","project":"lab-prod-461912","nist":["SC-1"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'high'\n\n  title \"[#{control_abbrev.upcase}] Ensure That Cloud SQL Database Instances Do Not Have Public IPs\"\n\n  desc 'It is recommended to configure Second Generation Sql instance to use private IPs instead of public IPs.'\n  desc 'rationale', \"To lower the organization's attack surface, Cloud SQL databases should not have public IPs.\n        Private IPs provide improved network security and lower latency for your application.\"\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['SC-1']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/mysql/configure-private-ip'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/mysql/private-ip'\n  ref 'GCP Docs', url: 'https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints'\n  ref 'GCP Docs', url: 'https://console.cloud.google.com/iam-admin/orgpolicies/sql-restrictPublicIp'\n\n  if sql_cache.instance_names.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] does not have CloudSQL instances. This test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have CloudSQL instances.\"\n    end\n  else\n    sql_cache.instance_names.each do |db|\n      sql_cache.instance_objects[db].ip_addresses.each do |ip_address|\n        describe \"[#{gcp_project_id}] CloudSQL #{db}\" do\n          subject { ip_address }\n          its('type') { should_not include('PRIMARY') }\n        end\n      end\n    end\n  end\nend\n","source_location":{"line":25,"ref":"./controls/6.06-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable.","run_time":6.125e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] does not have CloudSQL instances.","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have CloudSQL instances. This test is Not Applicable."}]},{"id":"cis-gcp-6.7-db","title":"[DB] Ensure That Cloud SQL Database Instances Are Configured With Automated Backups","desc":"It is recommended to have all SQL database instances set to enable automated backups.","descriptions":[{"label":"default","data":"It is recommended to have all SQL database instances set to enable automated backups."},{"label":"rationale","data":"Backups provide a way to restore a Cloud SQL instance to recover lost data or recover from a\n        problem with that instance. Automated backups need to be set for any instance that contains data that should be\n        protected from loss or damage. This recommendation is applicable for SQL Server, PostgreSql, MySql generation 1\n        and MySql generation 2 instances."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/sql/docs/mysql/backup-recovery/backups","ref":"GCP Docs"},{"url":"https://cloud.google.com/sql/docs/postgres/backup-recovery/backups","ref":"GCP Docs"},{"url":"https://cloud.google.com/sql/docs/sqlserver/backup-recovery/backups","ref":"GCP Docs"},{"url":"https://cloud.google.com/sql/docs/mysql/backup-recovery/backing-up","ref":"GCP Docs"},{"url":"https://cloud.google.com/sql/docs/postgres/backup-recovery/backing-up","ref":"GCP Docs"},{"url":"https://cloud.google.com/sql/docs/sqlserver/backup-recovery/backing-up","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"6.7","cis_version":"4.0","project":"lab-prod-461912","nist":["CP-9"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n\n  title \"[#{control_abbrev.upcase}] Ensure That Cloud SQL Database Instances Are Configured With Automated Backups\"\n\n  desc 'It is recommended to have all SQL database instances set to enable automated backups.'\n  desc 'rationale', 'Backups provide a way to restore a Cloud SQL instance to recover lost data or recover from a\n        problem with that instance. Automated backups need to be set for any instance that contains data that should be\n        protected from loss or damage. This recommendation is applicable for SQL Server, PostgreSql, MySql generation 1\n        and MySql generation 2 instances.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['CP-9']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/mysql/backup-recovery/backups'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/postgres/backup-recovery/backups'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/sqlserver/backup-recovery/backups'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/mysql/backup-recovery/backing-up'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/postgres/backup-recovery/backing-up'\n  ref 'GCP Docs', url: 'https://cloud.google.com/sql/docs/sqlserver/backup-recovery/backing-up'\n\n  if sql_cache.instance_names.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] does not have any CloudSQL instances, this test is Not Applicable\" do\n      skip \"[#{gcp_project_id}] does not have any CloudSQL instances\"\n    end\n  else\n    sql_cache.instance_names.each do |db|\n      describe \"[#{gcp_project_id}] CloudSQL #{db} should have automated backups enabled and have a start time\" do\n        subject { sql_cache.instance_objects[db].settings.backup_configuration }\n        its('enabled') { should cmp true }\n        its('start_time') { should_not eq '' }\n      end\n    end\n  end\nend\n","source_location":{"line":25,"ref":"./controls/6.07-db.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have any CloudSQL instances, this test is Not Applicable","run_time":5.25e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] does not have any CloudSQL instances","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have any CloudSQL instances, this test is Not Applicable"}]},{"id":"cis-gcp-7.1-storage","title":"[STORAGE] Ensure That BigQuery datasets are not anonymously or publicly accessible","desc":"It is recommended that the IAM policy on BigQuery datasets does not allow anonymous and/or public access.","descriptions":[{"label":"default","data":"It is recommended that the IAM policy on BigQuery datasets does not allow anonymous and/or public access."},{"label":"rationale","data":"Granting permissions to allUsers or allAuthenticatedUsers allows anyone to access the dataset. Such access might not be desirable if sensitive data is being stored in the dataset. Therefore, ensure that anonymous and/or public access to a dataset is not allowed."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/bigquery/docs/dataset-access-controls","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":1,"cis_gcp":"7.1","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-3"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'high'\n\n  title \"[#{control_abbrev.upcase}] Ensure That BigQuery datasets are not anonymously or publicly accessible\"\n\n  desc 'It is recommended that the IAM policy on BigQuery datasets does not allow anonymous and/or public access.'\n  desc 'rationale', 'Granting permissions to allUsers or allAuthenticatedUsers allows anyone to access the dataset. Such access might not be desirable if sensitive data is being stored in the dataset. Therefore, ensure that anonymous and/or public access to a dataset is not allowed.'\n\n  tag cis_scored: true\n  tag cis_level: 1\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-3']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/bigquery/docs/dataset-access-controls'\n\n  if google_bigquery_datasets(project: gcp_project_id).ids.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] does not have BigQuery Datasets, this test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have BigQuery Datasets\"\n    end\n  else\n    google_bigquery_datasets(project: gcp_project_id).ids.each do |name|\n      google_bigquery_dataset(project: gcp_project_id, name: name.split(':').last).access.each do |access|\n        describe \"[#{gcp_project_id}] BigQuery Dataset #{name} should not be anonymously or publicly accessible,\" do\n          subject { access }\n          its('iam_member') { should_not cmp 'allUsers' }\n          its('special_group') { should_not cmp 'allAuthenticatedUsers' }\n        end\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/7.01-bq.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have BigQuery Datasets, this test is Not Applicable.","run_time":6.0e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] does not have BigQuery Datasets","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have BigQuery Datasets, this test is Not Applicable."}]},{"id":"cis-gcp-7.2-storage","title":"[STORAGE] Ensure that all BigQuery tables are encrypted with customer-managed encryption key (CMEK)","desc":"BigQuery by default encrypts the data as rest by employing Envelope Encryption using Google managed cryptographic keys.\n  The data is encrypted using the data encryption keys and data encryption keys themselves are further encrypted using key\n  encryption keys. This is seamless and do not require any additional input from the user. However, if you want to have greater\n  control, Customer-managed encryption keys (CMEK) can be used as encryption key management solution for BigQuery Data Sets.\n  If CMEK is used, the CMEK is used to encrypt the data encryption keys instead of using google-managed encryption keys.","descriptions":[{"label":"default","data":"BigQuery by default encrypts the data as rest by employing Envelope Encryption using Google managed cryptographic keys.\n  The data is encrypted using the data encryption keys and data encryption keys themselves are further encrypted using key\n  encryption keys. This is seamless and do not require any additional input from the user. However, if you want to have greater\n  control, Customer-managed encryption keys (CMEK) can be used as encryption key management solution for BigQuery Data Sets.\n  If CMEK is used, the CMEK is used to encrypt the data encryption keys instead of using google-managed encryption keys."},{"label":"rationale","data":"BigQuery by default encrypts the data as rest by employing Envelope Encryption using Google managed\n  cryptographic keys. This is seamless and does not require any additional input from the user. For greater control over\n  the encryption, customer-managed encryption keys (CMEK) can be used as encryption key management solution for BigQuery tables.\n  The CMEK is used to encrypt the data encryption keys instead of using google-managed encryption keys. BigQuery stores the\n  table and CMEK association and the encryption/decryption is done automatically. Applying the Default Customer-managed keys on\n  BigQuery data sets ensures that all the new tables created in the future will be encrypted using CMEK but existing tables need\n  to be updated to use CMEK individually."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/bigquery/docs/customer-managed-encryption","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"7.2","cis_version":"4.0","project":"lab-prod-461912","nist":["SC-1"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'high'\n\n  title \"[#{control_abbrev.upcase}] Ensure that all BigQuery tables are encrypted with customer-managed encryption key (CMEK)\"\n\n  desc 'BigQuery by default encrypts the data as rest by employing Envelope Encryption using Google managed cryptographic keys.\n  The data is encrypted using the data encryption keys and data encryption keys themselves are further encrypted using key\n  encryption keys. This is seamless and do not require any additional input from the user. However, if you want to have greater\n  control, Customer-managed encryption keys (CMEK) can be used as encryption key management solution for BigQuery Data Sets.\n  If CMEK is used, the CMEK is used to encrypt the data encryption keys instead of using google-managed encryption keys.'\n  desc 'rationale', 'BigQuery by default encrypts the data as rest by employing Envelope Encryption using Google managed\n  cryptographic keys. This is seamless and does not require any additional input from the user. For greater control over\n  the encryption, customer-managed encryption keys (CMEK) can be used as encryption key management solution for BigQuery tables.\n  The CMEK is used to encrypt the data encryption keys instead of using google-managed encryption keys. BigQuery stores the\n  table and CMEK association and the encryption/decryption is done automatically. Applying the Default Customer-managed keys on\n  BigQuery data sets ensures that all the new tables created in the future will be encrypted using CMEK but existing tables need\n  to be updated to use CMEK individually.'\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['SC-1']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/bigquery/docs/customer-managed-encryption'\n\n  if google_bigquery_datasets(project: gcp_project_id).ids.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] does not have BigQuery Datasets, this test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have BigQuery Datasets\"\n    end\n  else\n    google_bigquery_datasets(project: gcp_project_id).ids.each do |dataset_name|\n      google_bigquery_tables(project: gcp_project_id, dataset: dataset_name.split(':').last).table_references.each do |table_reference|\n        describe \"[#{gcp_project_id}] BigQuery Table #{table_reference.table_id} should use customer-managed encryption keys (CMEK)\" do\n          subject { google_bigquery_table(project: gcp_project_id, dataset: dataset_name.split(':').last, name: table_reference.table_id).encryption_configuration }\n          its('kms_key_name') { should_not eq nil }\n        end\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/7.02-bq.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have BigQuery Datasets, this test is Not Applicable.","run_time":5.125e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] does not have BigQuery Datasets","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have BigQuery Datasets, this test is Not Applicable."}]},{"id":"cis-gcp-7.3-storage","title":"[STORAGE] Ensure that a default customer-managed encryption key (CMEK) is specified for all BigQuery data sets","desc":"BigQuery by default encrypts the data as rest by employing Envelope Encryption using Google managed cryptographic keys. The data\n  is encrypted using the data encryption keys and data encryption keys themselves are further encrypted using key encryption keys. This is\n  seamless and do not require any additional input from the user. However, if you want to have greater control, Customer-managed encryption\n  keys (CMEK) can be used as encryption key management solution for BigQuery Data Sets.","descriptions":[{"label":"default","data":"BigQuery by default encrypts the data as rest by employing Envelope Encryption using Google managed cryptographic keys. The data\n  is encrypted using the data encryption keys and data encryption keys themselves are further encrypted using key encryption keys. This is\n  seamless and do not require any additional input from the user. However, if you want to have greater control, Customer-managed encryption\n  keys (CMEK) can be used as encryption key management solution for BigQuery Data Sets."},{"label":"rationale","data":"BigQuery by default encrypts the data as rest by employing Envelope Encryption using Google managed cryptographic keys.\n  This is seamless and does not require any additional input from the user.\n  For greater control over the encryption, customer-managed encryption keys (CMEK) can be used as encryption key management solution for\n  BigQuery Data Sets. Setting a Default Customer-managed encryption key (CMEK) for a data set ensure any tables created in future will use\n  the specified CMEK if none other is provided."}],"impact":0.0,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/bigquery/docs/customer-managed-encryption","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"7.3","cis_version":"4.0","project":"lab-prod-461912","nist":["SC-1"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'high'\n\n  title \"[#{control_abbrev.upcase}] Ensure that a default customer-managed encryption key (CMEK) is specified for all BigQuery data sets\"\n\n  desc 'BigQuery by default encrypts the data as rest by employing Envelope Encryption using Google managed cryptographic keys. The data\n  is encrypted using the data encryption keys and data encryption keys themselves are further encrypted using key encryption keys. This is\n  seamless and do not require any additional input from the user. However, if you want to have greater control, Customer-managed encryption\n  keys (CMEK) can be used as encryption key management solution for BigQuery Data Sets.'\n  desc 'rationale', 'BigQuery by default encrypts the data as rest by employing Envelope Encryption using Google managed cryptographic keys.\n  This is seamless and does not require any additional input from the user.\n  For greater control over the encryption, customer-managed encryption keys (CMEK) can be used as encryption key management solution for\n  BigQuery Data Sets. Setting a Default Customer-managed encryption key (CMEK) for a data set ensure any tables created in future will use\n  the specified CMEK if none other is provided.'\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['SC-1']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/bigquery/docs/customer-managed-encryption'\n\n  if google_bigquery_datasets(project: gcp_project_id).ids.empty?\n    impact 'none'\n    describe \"[#{gcp_project_id}] does not have BigQuery Datasets, this test is Not Applicable.\" do\n      skip \"[#{gcp_project_id}] does not have BigQuery Datasets\"\n    end\n  else\n    google_bigquery_datasets(project: gcp_project_id).ids.each do |name|\n      describe \"[#{gcp_project_id}] BigQuery Dataset #{name} should use customer-managed encryption keys (CMEK)\" do\n        subject { google_bigquery_dataset(project: gcp_project_id, name: name.split(':').last).default_encryption_configuration }\n        its('kms_key_name') { should_not eq nil }\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/7.03-bq.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"[lab-prod-461912] does not have BigQuery Datasets, this test is Not Applicable.","run_time":4.75e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"[lab-prod-461912] does not have BigQuery Datasets","resource_class":"Object","resource_params":"[]","resource_id":"[lab-prod-461912] does not have BigQuery Datasets, this test is Not Applicable."}]},{"id":"cis-gcp-7.4-storage","title":"[STORAGE] Ensure all data in BigQuery has been classified","desc":"BigQuery tables can contain sensitive data that for security purposes should be discovered, monitored,\n  classified, and protected. Google Clouds Sensitive Data Protection tools can automatically provide data classification\n  of all BigQuery data across an organization.","descriptions":[{"label":"default","data":"BigQuery tables can contain sensitive data that for security purposes should be discovered, monitored,\n  classified, and protected. Google Clouds Sensitive Data Protection tools can automatically provide data classification\n  of all BigQuery data across an organization."},{"label":"rationale","data":"Using a cloud service or 3rd party software to continuously monitor and automate the process of data\n  discovery and classification for BigQuery tables is an important part of protecting the data.\n  Sensitive Data Protection is a fully managed data protection and data privacy platform that uses machine learning and pattern\n  matching to discover and classify sensitive data in Google Cloud."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/dlp/docs/data-profiles","ref":"GCP Docs"},{"url":"https://cloud.google.com/dlp/docs/analyze-data-profiles","ref":"GCP Docs"},{"url":"https://cloud.google.com/dlp/docs/data-profiles-remediation","ref":"GCP Docs"},{"url":"https://cloud.google.com/dlp/docs/send-profiles-to-scc","ref":"GCP Docs"},{"url":"https://cloud.google.com/dlp/docs/profile-org-folder#chronicle","ref":"GCP Docs"},{"url":"https://cloud.google.com/dlp/docs/profile-org-folder#publish-pubsub","ref":"GCP Docs"}],"tags":{"cis_scored":false,"cis_level":2,"cis_gcp":"7.4","cis_version":"4.0","project":"lab-prod-461912","nist":["AC-2"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n  title \"[#{control_abbrev.upcase}] Ensure all data in BigQuery has been classified\"\n  desc 'BigQuery tables can contain sensitive data that for security purposes should be discovered, monitored,\n  classified, and protected. Google Clouds Sensitive Data Protection tools can automatically provide data classification\n  of all BigQuery data across an organization.'\n  desc 'rationale', 'Using a cloud service or 3rd party software to continuously monitor and automate the process of data\n  discovery and classification for BigQuery tables is an important part of protecting the data.\n  Sensitive Data Protection is a fully managed data protection and data privacy platform that uses machine learning and pattern\n  matching to discover and classify sensitive data in Google Cloud.'\n\n  tag cis_scored: false\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['AC-2']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n\n  ref 'GCP Docs', url: 'https://cloud.google.com/dlp/docs/data-profiles'\n  ref 'GCP Docs', url: 'https://cloud.google.com/dlp/docs/analyze-data-profiles'\n  ref 'GCP Docs', url: 'https://cloud.google.com/dlp/docs/data-profiles-remediation'\n  ref 'GCP Docs', url: 'https://cloud.google.com/dlp/docs/send-profiles-to-scc'\n  ref 'GCP Docs', url: 'https://cloud.google.com/dlp/docs/profile-org-folder#chronicle'\n  ref 'GCP Docs', url: 'https://cloud.google.com/dlp/docs/profile-org-folder#publish-pubsub'\n\n  describe 'This control is not scored' do\n    skip 'This control is not scored'\n  end\nend\n","source_location":{"line":23,"ref":"./controls/7.04-bq.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This control is not scored","run_time":5.625e-06,"start_time":"2025-06-06T12:19:57+00:00","resource":"","skip_message":"This control is not scored","resource_class":"Object","resource_params":"[]","resource_id":"This control is not scored"}]},{"id":"cis-gcp-8.1-dataproc","title":"[DATAPROC] Ensure that Dataproc Cluster is encrypted using Customer-Managed Encryption Key","desc":"When you use Dataproc, cluster and job data is stored on Persistent Disks (PDs) associated with the Compute Engine VMs in your cluster\n        and in a Cloud Storage staging bucket. This PD and bucket data is encrypted using a Google-generated data encryption key (DEK) and key\n        encryption key (KEK). The CMEK feature allows you to create, use, and revoke the key encryption key (KEK). Google still controls the data\n        encryption key (DEK).","descriptions":[{"label":"default","data":"When you use Dataproc, cluster and job data is stored on Persistent Disks (PDs) associated with the Compute Engine VMs in your cluster\n        and in a Cloud Storage staging bucket. This PD and bucket data is encrypted using a Google-generated data encryption key (DEK) and key\n        encryption key (KEK). The CMEK feature allows you to create, use, and revoke the key encryption key (KEK). Google still controls the data\n        encryption key (DEK)."},{"label":"rationale","data":"Cloud services offer the ability to protect data related to those services using encryption keys managed by the customer within\n        Cloud KMS. These encryption keys are called customer-managed encryption keys (CMEK). When you protect data in Google Cloud services with CMEK,\n        the CMEK key is within your control."}],"impact":0.4,"refs":[{"url":"https://www.cisecurity.org/benchmark/google_cloud_computing_platform/","ref":"CIS Benchmark"},{"url":"https://cloud.google.com/docs/security/encryption/default-encryption","ref":"GCP Docs"}],"tags":{"cis_scored":true,"cis_level":2,"cis_gcp":"8.1","cis_version":"4.0","project":"lab-prod-461912","nist":["SC-28"]},"code":"control \"cis-gcp-#{control_id}-#{control_abbrev}\" do\n  impact 'medium'\n  title \"[#{control_abbrev.upcase}] Ensure that Dataproc Cluster is encrypted using Customer-Managed Encryption Key\"\n  desc 'When you use Dataproc, cluster and job data is stored on Persistent Disks (PDs) associated with the Compute Engine VMs in your cluster\n        and in a Cloud Storage staging bucket. This PD and bucket data is encrypted using a Google-generated data encryption key (DEK) and key\n        encryption key (KEK). The CMEK feature allows you to create, use, and revoke the key encryption key (KEK). Google still controls the data\n        encryption key (DEK).'\n  desc 'rationale', 'Cloud services offer the ability to protect data related to those services using encryption keys managed by the customer within\n        Cloud KMS. These encryption keys are called customer-managed encryption keys (CMEK). When you protect data in Google Cloud services with CMEK,\n        the CMEK key is within your control.'\n\n  tag cis_scored: true\n  tag cis_level: 2\n  tag cis_gcp: control_id.to_s\n  tag cis_version: cis_version.to_s\n  tag project: gcp_project_id.to_s\n  tag nist: ['SC-28']\n\n  ref 'CIS Benchmark', url: cis_url.to_s\n  ref 'GCP Docs', url: 'https://cloud.google.com/docs/security/encryption/default-encryption'\n\n  # Fetch all available compute regions\n  # This uses a helper method or a direct gcloud command execution\n  # You might need to add a helper function in your libraries or execute a shell command\n  # For simplicity, let's assume you have a way to get all regions.\n  # A common way is to use a custom InSpec resource or shell out to gcloud.\n\n  # Example using a placeholder for dynamic region discovery (you'd implement this)\n  # In a real scenario, you might use `command('gcloud compute regions list --format=\"value(name)\"').stdout.strip.split(\"\\n\")`\n  # but directly executing `gcloud` within an InSpec resource's `initialize` or `filter`\n  # methods can be tricky due to execution context and dependencies.\n  # A better approach is to define a custom InSpec resource that wraps these gcloud calls.\n  # For now, let's manually list some common regions, or pass them as an input if fixed.\n\n  # If you need to make this fully dynamic without hardcoding, you would likely need a\n  # custom InSpec resource that uses the Google Cloud SDK for Ruby to list regions.\n  # For demonstration, let's use a hardcoded list of common regions.\n  # In a real-world, dynamic scenario, you'd integrate a resource like `google_compute_regions`\n  # or run a `gcloud` command to get the list.\n\n  all_gcp_regions = google_compute_regions(project: gcp_project_id).region_names\n\n  found_clusters = []\n\n  all_gcp_regions.each do |region|\n    clusters_in_region = google_dataproc_clusters(project: gcp_project_id, region: region)\n    found_clusters.concat(clusters_in_region.cluster_names.map { |name| { name: name, region: region } }) if clusters_in_region.cluster_names.any?\n  rescue Inspec::Exceptions::ResourceFailed => e\n    # This will catch errors if the Dataproc API isn't enabled in a region,\n    # or if there are other region-specific issues.\n    # You can log this for debugging if needed:\n    # puts \"Could not list clusters in region #{region}: #{e.message}\"\n  end\n\n  if found_clusters.empty?\n    describe \"No Dataproc clusters found in project '#{gcp_project_id}' across all common regions.\" do\n      subject { found_clusters }\n      it { should be_empty }\n    end\n  else\n    found_clusters.each do |cluster_info|\n      cluster_name = cluster_info[:name]\n      cluster_region = cluster_info[:region]\n      cluster = google_dataproc_cluster(project: gcp_project_id, name: cluster_name, region: cluster_region)\n\n      describe \"[#{gcp_project_id}] Dataproc Cluster: #{cluster_name} in region #{cluster_region}\" do\n        subject { cluster }\n        its('encryption_config.gce_pd_kms_key_name') { should_not be_nil }\n        its('encryption_config.gce_pd_kms_key_name') { should_not be_empty }\n      end\n    end\n  end\nend\n","source_location":{"line":23,"ref":"./controls/8.01-dp.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"No Dataproc clusters found in project 'lab-prod-461912' across all common regions. is expected to be empty","run_time":0.005020072,"start_time":"2025-06-06T12:19:57+00:00","resource_class":"Object","resource_params":"[]","resource_id":"No Dataproc clusters found in project 'lab-prod-461912' across all common regions."}]}],"status":"loaded","status_message":""},{"name":"inspec-gcp-helpers","version":"1.0.9","sha256":"b1c6f2c7ed6422ad89f949c7eb6eed3bd642b350ae0d7bda4f44ff2a3c182177","title":"GCP CIS PCI Helper Resource Pack","summary":"This resource pack provides helpers for the Google Cloud Platform Inspec profiles.","license":"Apache-2.0","copyright":"Google","copyright_email":"copyright@google.com","supports":[{"platform":"gcp"}],"attributes":[{"name":"gcp_project_id","options":{"value":"lab-prod-461912"}}],"parent_profile":"inspec-gcp-cis-benchmark","depends":[{"name":"inspec-gcp","url":"https://github.com/inspec/inspec-gcp/archive/v1.8.1.tar.gz","status":"loaded"}],"groups":[],"controls":[],"status":"loaded","status_message":""},{"name":"inspec-gcp","version":"1.8.1","sha256":"0a81e12583941bde8b83ef43f94f4c0b54a036b1a9306cebedb92ede0c928f91","title":"Google Cloud Platform Resource Pack","maintainer":"spaterson@chef.io,russell.seymour@turtlesystems.co.uk","summary":"This resource pack provides compliance resources_old_ignore for Google Cloud Platform","license":"Apache-2.0","copyright":"spaterson@chef.io,russell.seymour@turtlesystems.co.uk","copyright_email":"spaterson@chef.io,russell.seymour@turtlesystems.co.uk","supports":[{"platform":"gcp"}],"attributes":[{"name":"gcp_project_id","options":{"value":"lab-prod-461912"}}],"parent_profile":"inspec-gcp-helpers","groups":[],"controls":[],"status":"loaded","status_message":""}],"statistics":{"duration":8.848546535},"version":"6.8.24"}